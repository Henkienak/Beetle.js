(function(n){"use strict";var t=function(){return{assertPrm:function(n,t){return new u(n,t)},combine:function(n,i){var r,e,f;if(n==i)return n;if(r={},n!=null)for(e in n)r[e]=n[e];if(i!=null)for(f in i){var s=r[f],o=i[f],h=u.isTypeOf(s,"object")&&u.isTypeOf(o,"object")?t.combine(s,o):o;r[f]=h}return r},extend:function(n,t){if(n!=null&&t!=null)for(var i in t)n.hasOwnProperty(i)||(n[i]=t[i])},objEquals:function(n,i){var f,e,r,o;if(n==i)return!0;if(n==null||i==null)return!1;if(u.isObject(n)&&u.isObject(i)){f=0;e=0;for(r in n){if(!i.hasOwnProperty(r)||t.getValue(n,r)!=t.getValue(i,r))return!1;f++}for(o in i)e++;return f==e}return!1},isCaseSensitive:function(n){var t=n&&n.isCaseSensitive;return t==null?s.isCaseSensitive:t},ignoreWhiteSpaces:function(n){var t=n&&n.ignoreWhiteSpaces;return t==null?s.ignoreWhiteSpaces:t},handleStrOptions:function(n,i){return n==null?n:(t.isCaseSensitive(i)||(n=n.toLowerCase()),t.ignoreWhiteSpaces(i)&&(n=n.trim()),n)},equals:function(n,i,r,u){return typeof n=="string"&&typeof i=="string"&&(n=t.handleStrOptions(n,u),i=t.handleStrOptions(i,u)),n!=null&&i!=null&&e.dataTypes.date.isValid(n)&&e.dataTypes.date.isValid(i)&&(n=n.valueOf(),i=i.valueOf()),r?n===i:n==i},formatString:function(n){var t=arguments,i=RegExp("%([0-"+(arguments.length-1)+"])","g"),r=RegExp("{([0-"+(arguments.length-2)+"])}","g");return n.replace(i,function(n,i){return t[Number(i)+1]||""}).replace(r,function(n,i){return t[Number(i)+1]||""})},tryFreeze:function(n,t){var r,i;if(!n||!Object.freeze)return n;if(Object.freeze(n),t===!0)for(r in n)i=n[r],u.isArray(i)?this.tryFreezeArray(i,t):u.isObject(i)&&this.tryFreeze(i,t);return n},tryFreezeArray:function(n,t){if(n&&Object.freeze)for(var i=0;i<n.length;i++)this.tryFreeze(n[i],t)},indexOf:function(n,t,i){for(var r=i||0;r<n.length;r++)if(n[r]===t)return r;return-1},forEach:function(n,t){for(var r,i=0;i<n.length;i++)r=n[i],t.call(null,r,i)},forEachProperty:function(n,t){var i,r;for(i in n)i[0]!="$"&&((r=n[i],u.isFunction(r))||t(i,r))},findInArray:function(n,t,i){for(var r=0;r<n.length;r++)if(i){if(n[r][i]===t)return n[r]}else if(n[r]===t)return t;return null},filterArray:function(n,t){for(var r,u=[],i=0;i<n.length;i++)r=n[i],t(r)===!0&&u.push(r);return u},removeFromArray:function(n,t,i){var r=[],u;for(this.forEach(n,function(n,u){i?n[i]===t&&r.push(u):n===t&&r.push(u)}),u=r.length-1;u>=0;u--)n.splice(r[u],1);return r.length},mapArray:function(n,t){for(var r,u=[],i=0;i<n.length;i++)r=n[i],u.push(t.call(r,r,i));return u},createGuid:function(){function n(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()},funcToLambda:function(n){var e,r,u,o,f;t.assertPrm(n,"func").isFunction().check();var i=n.toString().replace(/function(.*?){/g,"$1=>").replace(/{|}|;|return /g,"").trim(),s=i.indexOf("=>"),h=i.substr(0,s).trim();for(i=i.substr(s+2).trim(),e=i.split(","),r=[],u=0;u<e.length;u++)o=e[u],f=o.split(":"),f.length>1?r.push(f[1].trim()+" as "+f[0].trim()):r.push(o.trim());return i=r.join(", "),h?h+" => "+i:i},getFuncName:function(n){var t=/function (.{1,})\(/.exec(n.toString());return t[1]},inherit:function(n,t){var i=new Function;i.prototype=t.prototype;n.prototype=new i;n.prototype.constructor=n;n.baseClass=t.prototype},getValue:function(n,t){function e(n,t){var i=n.$tracker;return i?i.getValue(t):u.isObservable(n,t)?u.getValue(n,t):n[t]}var r;if(n==null)return undefined;var u=s.getObservableProvider(),f=t.trim().split("."),i=n;for(r=0;r<f.length;r++)if(i=e(i,f[r]),i==null)break;return i},getResourceValue:function(n,t){var i=s.getLocalizeFunction();return i&&n&&i(n)||t},createValidationError:function(n,t,i,r,u){var f={message:r,entity:n,validator:u,value:t,property:i};return this.tryFreeze(f)},createError:function(n,i,r){var f=null,e=r,o,s;if(u.isArray(i)?f=i:u.isObject(i)&&(e=i),f&&f.length>0&&(f.splice(0,0,n),n=t.formatString.apply(null,f)),o=new Error(n),e)for(s in e)o[s]=e[s];return a.error.notify(o),o},runSelectExp:function(n,i,r){if(n.length==0)return n;i=h.jsep(i);var u=i.type=="Compound"?i.body:[i],f=t.jsepToProjector(u,r);return t.mapArray(n,f)},setForeignKeys:function(n,i,r){for(var f,e,o,s,h,u=0;u<i.foreignKeyNames.length;u++)f=i.foreignKeyNames[u],e=n.$tracker,r?(o=r.$tracker.entityType.keys[u],s=r.$tracker.getValue(o.name),e.setValue(f,s)):(h=t.findInArray(e.entityType.dataProperties,f,"name"),e.setValue(f,h.getDefaultValue()))},createTrackableArray:function(n,i,r,f){function h(n,i){var o=i.object,r=i.property,f;r&&(o.$tracker&&o.$tracker.manager&&(f=o.$tracker.manager.handleUnmappedProperties),f==null&&(f=s.handleUnmappedProperties),u.isInstanceOf(r,l.NavigationProperty)?t.forEach(n,function(n){r.checkAssign(n)}):u.isInstanceOf(r,l.DataProperty)?t.forEach(n,function(t,i){n[i]=r.handle(t)}):f===!0&&t.forEach(n,function(t,i){n[i]=e.dataTypes.handle(t)}))}var o=n||[];return o.object=i,o.property=r,o.after=f,o.changing=new e.Event(r+"ArrayChanging",o),o.changed=new e.Event(r+"ArrayChanged",o),o.pop=function(){var n=[this[this.length-1]],t;return this.changing.notify({added:[],removed:n}),t=Array.prototype.pop.call(this),this.after(this.object,this.property,this,n,null),this.changed.notify({added:[],removed:n}),t},o.push=function(){this.changing.notify({added:arguments,removed:[]});h(arguments,this);var n=Array.prototype.push.apply(this,arguments);return this.after(this.object,this.property,this,null,arguments),this.changed.notify({added:arguments,removed:[]}),n},o.unshift=function(){this.changing.notify({added:arguments,removed:[]});h(arguments,this);var n=Array.prototype.unshift.apply(this,arguments);return this.after(this.object,this.property,this,null,arguments),this.changed.notify({added:arguments,removed:[]}),n},o.shift=function(){var n=[this[0]],t;return this.changing.notify({added:[],removed:n}),t=Array.prototype.shift.call(this),this.after(this.object,this.property,this,n,null),this.changed.notify({added:[],removed:n}),t},o.splice=function(n,t){var i,r,u;return t=t||this.length,i=null,arguments.length>2&&(i=Array.prototype.slice.call(arguments).slice(2)),r=this.slice(n,n+t),this.changing.notify({added:i,removed:r}),i&&h(i,this),u=Array.prototype.splice.apply(this,arguments),this.after(this.object,this.property,this,r,i),this.changed.notify({added:i,removed:r}),u},o.remove=function(){var n=[],i;return this.changing.notify({added:[],removed:arguments}),i=this,t.forEach(arguments,function(r){var u=t.indexOf(i,r);u>=0&&(Array.prototype.splice.call(i,u,1),n.push(r))}),this.after(this.object,this.property,this,n,null),this.changed.notify({added:[],removed:n}),n},o.load=function(n,t,i,r,u){return this.object.$tracker.loadNavigationProperty(this.propertyName,n,t,i,r,u)},o},jsepToODataQuery:function(n,i,u){var ft,d,g,nt,v,h,a,w,ut,b,k,ot;if(u=u||n,i?i.aliases||(i.aliases=[]):i={aliases:[]},n.type=="LogicalExpression"||n.type=="BinaryExpression"){if(n.operator=="=>"){if(n!=u)throw t.createError(r.odataDoesNotSupportAlias);return i.aliases.push({alias:n.left.name,value:null}),ft=t.jsepToODataQuery(n.right,i,u),n!=u&&i.aliases.pop(),ft}if(d=f.langOperators.find(n.operator).oData,!d)throw t.createError(r.operatorNotSupportedForOData,[n.operator],{expression:n});return"("+t.jsepToODataQuery(n.left,i,u)+" "+d+" "+t.jsepToODataQuery(n.right,i,u)+")"}if(n.type=="UnaryExpression")return n.operator+t.jsepToODataQuery(n.argument,i,u);if(n.type=="Identifier"){var s=n.name,y=undefined,et=!1;if(s[0]=="@"&&(et=!0,s=s.slice(1)),i.expVarContext&&i.expVarContext[s]!==undefined?y=i.expVarContext[s]:i.varContext&&i.varContext[s]!==undefined&&(y=i.varContext[s]),y!==undefined)return e.dataTypes.toODataValue(y);if(et)throw t.createError(r.unknownParameter,[s],{expression:n,queryContext:i});return(g=t.findInArray(i.aliases,s,"alias"),g)?g.value:s}if(n.type=="Literal")return e.dataTypes.toODataValue(n.value);if(n.type=="MemberExpression")return i.currentAlias&&n.object.name==i.currentAlias.alias?n.property.name:(nt=t.findInArray(i.aliases,n.object.name,"alias"),v=nt?nt.value:t.jsepToODataQuery(n.object,i,u),v[n.property.name]!==undefined)?e.dataTypes.toODataValue(v[n.property.name]):v?v+"/"+n.property.name:n.property.name;if(n.type=="Compound"){for(h=[],a=0;a<n.body.length;a++){var tt=n.body[a],it=t.jsepToODataQuery(tt,i),rt=it.toLowerCase();if(rt=="desc"||rt=="asc"){if(h.length==0)throw t.createError(r.invalidStatement,{expression:n,statement:tt});h[h.length-1]+=" "+it}else if(rt=="as"){if(h.length==0||n.body.length<a+1)throw t.createError(r.invalidStatement,{expression:n,statement:tt});h[h.length-1]+=" as "+n.body[a+1].name;a++}else h.push(it)}return h.join(", ")}if(n.type=="CallExpression"){var c=n.arguments,p=[],l=null;for(c.length==1&&c[0]&&c[0].type=="BinaryExpression"&&c[0].operator=="=>"&&(l={alias:c[0].left.name},l.value=l.alias,c=[c[0].right]),l&&(i.currentAlias=l,i.aliases.push(l)),w=0;w<c.length;w++)ut=c[w],ut!=null&&p.push(t.jsepToODataQuery(ut,i,u));if(n.callee.type=="MemberExpression"?(p.splice(0,0,t.jsepToODataQuery(n.callee.object,i,u)),b=n.callee.property.name):b=n.callee.name,k=o.queryFuncs.getFunc(b),k.needsAlias==!0)if(l)p.splice(0,0,l);else throw t.createError(r.functionNeedsAlias,[b],{expression:n});return ot=k.toODataFunction.apply(k,p),l&&(i.currentAlias=null,i.aliases.pop()),ot}throw t.createError(r.unknownExpression,{expression:n});},jsepToBeetleQuery:function(n,i,u){var ut,ft,w,b,y,h,l,p,tt,it,rt,ot;if(u=u||n,i?i.aliases||(i.aliases=[]):i={aliases:[]},n.type=="LogicalExpression"||n.type=="BinaryExpression")return n.operator=="=>"?(i.aliases.push({alias:n.left.name,value:"it"}),ut=t.jsepToBeetleQuery(n.right,i,u),n!=u&&i.aliases.pop(),ut):(ft=f.langOperators.find(n.operator).code,"("+t.jsepToBeetleQuery(n.left,i,u)+" "+ft+" "+t.jsepToBeetleQuery(n.right,i,u)+")");if(n.type=="UnaryExpression")return n.operator+t.jsepToBeetleQuery(n.argument,i,u);if(n.type=="Identifier"){var s=n.name,v=undefined,et=!1;if(s[0]=="@"&&(et=!0,s=s.slice(1)),i.expVarContext&&i.expVarContext[s]!==undefined?v=i.expVarContext[s]:i.varContext&&i.varContext[s]!==undefined&&(v=i.varContext[s]),v!==undefined)return e.dataTypes.toBeetleValue(v);if(et)throw t.createError(r.unknownParameter,[s],{expression:n,queryContext:i});return(w=t.findInArray(i.aliases,s,"alias"),w)?w.value:s}if(n.type=="Literal")return e.dataTypes.toBeetleValue(n.value);if(n.type=="MemberExpression")return i.currentAlias&&n.object.name==i.currentAlias.alias?n.property.name:(b=t.findInArray(i.aliases,n.object.name,"alias"),y=b?b.value:t.jsepToBeetleQuery(n.object,i,u),y[n.property.name]!==undefined)?e.dataTypes.toBeetleValue(y[n.property.name]):y+"."+n.property.name;if(n.type=="Compound"){for(h=[],l=0;l<n.body.length;l++){var k=n.body[l],d=t.jsepToBeetleQuery(k,i),g=d.toLowerCase();if(g=="desc"||g=="asc"){if(h.length==0)throw t.createError(r.invalidStatement,{expression:n,statement:k});h[h.length-1]+=" "+d}else if(g=="as"){if(h.length==0||n.body.length<l+1)throw t.createError(r.invalidStatement,{expression:n,statement:k});h[h.length-1]+=" as "+n.body[l+1].name;l++}else h.push(d)}return h.join(", ")}if(n.type=="CallExpression"){var c=n.arguments,nt=[],a=null;for(c.length==1&&c[0]&&c[0].type=="BinaryExpression"&&c[0].operator=="=>"&&(a={alias:c[0].left.name},a.value=a.alias,c=[c[0].right]),a&&(i.currentAlias=a,i.aliases.push(a)),p=0;p<c.length;p++)tt=c[p],tt!=null&&nt.push(t.jsepToBeetleQuery(tt,i,u));return n.callee.type=="MemberExpression"?(nt.splice(0,0,t.jsepToBeetleQuery(n.callee.object,i,u)),it=n.callee.property.name):it=n.callee.name,rt=o.queryFuncs.getFunc(it),ot=rt.toBeetleFunction.apply(rt,nt),a&&(i.currentAlias=null,i.aliases.pop()),ot}throw t.createError(r.unknownExpression,{expression:n});},jsepToFunction:function(n,i){return function(u){var nt,it,rt,e,v,y,b,k,d,l,g,c,a,w;if(i?i.aliases||(i.aliases=[]):i={aliases:[]},i.currentAlias&&(i.currentAlias.value=u),n.type===undefined)return u;if(n.type=="LogicalExpression"||n.type=="BinaryExpression"){if(n.operator=="=>")return i.currentAlias&&i.aliases.push(i.currentAlias),i.currentAlias={alias:n.left.name},nt=t.jsepToFunction(n.right,i)(u),i.currentAlias=i.aliases.pop(),nt;var ut=f.langOperators.find(n.operator),tt=i.varContext,ft=function(){return t.jsepToFunction(n.left,i)(u)},et=function(){return t.jsepToFunction(n.right,i)(u)};return ut.asFunc.call(tt,ft,et)}if(n.type=="UnaryExpression")return it=function(){return t.jsepToFunction(n.argument,i)(u)},rt=f.langOperators.find(n.operator),rt.asFunc.call(tt,it);if(n.type=="Identifier"){if(e=n.name,e=="null")return null;if(e=="true")return!0;if(e=="false")return!1;if(e[0]=="@"){if(v=undefined,y=e.slice(1),i.expVarContext&&i.expVarContext[y]!==undefined?v=i.expVarContext[y]:i.varContext&&(v=i.varContext[y]),v===undefined)throw t.createError(r.unknownParameter,[e],{expression:n,queryContext:i});return v}return i.currentAlias&&i.currentAlias.alias==e?u:(b=t.findInArray(i.aliases,e,"alias"),b)?b.value:(k=t.getValue(u,e),k===undefined)?window[e]:k}if(n.type=="Literal")return n.value;if(n.type=="MemberExpression"){if(n.object.name){if(i.currentAlias&&n.object.name==i.currentAlias.alias)return t.getValue(u,n.property.name);if(d=t.findInArray(i.aliases,n.object.name,"alias"),d)return t.getValue(d.value,n.property.name)}return t.getValue(t.jsepToFunction(n.object,i)(u),n.property.name)}if(n.type=="CallExpression"){var s=n.arguments,h=[],p=null;if(s.length==1&&s[0]&&s[0].type=="BinaryExpression"&&s[0].operator=="=>"&&(p=s[0].left.name,s=[s[0].right]),p&&(i.currentAlias&&i.aliases.push(i.currentAlias),i.currentAlias={alias:p}),t.forEach(s,function(n){n!=null&&h.push(t.jsepToFunction(n,i))}),l=n.callee.type=="MemberExpression"?n.callee.property.name:n.callee.name,c=o.queryFuncs.getFunc(l,!1),c)n.callee.type=="MemberExpression"&&h.splice(0,0,t.jsepToFunction(n.callee.object,i)),h.splice(0,0,u),g=c.impl.apply(i,h);else{if(l[0]=="@")if(a=l.slice(1),i.expVarContext&&i.expVarContext[a])c=i.expVarContext[a];else if(i.varContext&&i.varContext[a])c=i.varContext[a];else throw t.createError(r.unknownParameter,[a],{expression:n,queryContext:i});else if(w=n.callee.type=="MemberExpression"?t.jsepToFunction(n.callee.object,i)(u):window,w==null||(c=w[l])==null)throw t.createError(r.unknownFunction,[l]);h=t.mapArray(h,function(){return this(u)});g=c.apply(w,h)}return p&&(i.currentAlias=i.aliases.pop()),g}throw t.createError(r.unknownExpression,{expression:n});}},jsepToProjector:function(n,i){var h=[],f,e,o,s;for(u.isArray(n)||(n=[n]),f=0;f<n.length;f++){e=null;o=n[f];switch(o.type){case"Identifier":e=o.name;break;case"MemberExpression":e=o.property.name}if(n.length>f+2&&n[f+1].name&&n[f+1].name.toLowerCase()=="as"){if(f=f+2,s=n[f],s.type!="Identifier")throw t.createError(r.invalidPropertyAlias,{expressions:n,aliasExpression:s});e=s.name}if(n.length>1&&!e)throw t.createError(r.projectionsMustHaveAlias,{expressions:n,expression:o});h.push({p:e,func:t.jsepToFunction(o,i)})}return function(t){for(var r,u,f={},i=0;i<h.length;i++){if(r=h[i],u=r.func(t),n.length==1)return u;f[r.p]=u}return f}}}}(),u=function(){var n=function(n,i){this.value=n;this.name=i;this.errors=[];t.tryFreeze(this)},i=n.prototype;return i.hasValue=function(){return n.hasValue(this.value,this.errors,this.name),this},i.isObject=function(){return n.isObject(this.value,this.errors,this.name),this},i.isFunction=function(){return n.isFunction(this.value,this.errors,this.name),this},i.isNotEmptyString=function(){return n.isNotEmptyString(this.value,this.errors,this.name),this},i.isTypeOf=function(t){return n.isTypeOf(this.value,t,this.errors,this.name),this},i.isArray=function(){return n.isArray(this.value,this.errors,this.name),this},i.isEnum=function(t){return n.isEnum(this.value,t,this.errors,this.name),this},i.isInstanceOf=function(t){return n.isInstanceOf(this.value,t,this.errors,this.name),this},i.check=function(){if(this.errors.length>0)throw t.createError(this.errors.join("\n"),{name:this.name,value:this.value});},n.hasValue=function(n,i,u){return n==null?(i&&i.push(t.formatString(r.valueCannotBeNull,u)),!1):!0},n.isObject=function(n,i,u){return n==null||!e.dataTypes.object.isValid(n)?(i&&i.push(t.formatString(r.typeError,u,"object")),!1):!0},n.isFunction=function(n,i,u){return n==null||!e.dataTypes.func.isValid(n)?(i&&i.push(t.formatString(r.typeError,u,"function")),!1):!0},n.isNotEmptyString=function(i,u,f){return i==null||i===""||!n.isTypeOf(i,"string",u)?(u&&u.push(t.formatString(r.cannotBeEmptyString,f)),!1):!0},n.isTypeOf=function(i,u,f,o){if(!n.hasValue(i))return!1;var s=e.dataTypes.byName(u);return s.isValid(i)?!0:(f&&f.push(t.formatString(r.typeMismatch,o,u,s,i)),!1)},n.isArray=function(n,i,u){return n==null||!e.dataTypes.array.isValid(n)?(i&&i.push(t.formatString(r.typeError,u,"array")),!1):!0},n.isEnum=function(n,i,u){return i.contains(n)?!0:(u&&u.push(t.formatString(r.invalidEnumValue,i,n)),!1)},n.isInstanceOf=function(n,i,u,f){return n==null?(u&&u.push(r.cannotCheckInstanceOnNull),!1):(n instanceof i)?!0:(u&&u.push(t.formatString(r.instanceError,f,i)),!1)},n}(),h=function(){var i={};return i.Enum=function(){function r(n,t){for(var i in t)n[i]=t[i];return n}function n(n,i){this.name=n;i&&r(this,i);t.tryFreeze(this)}n.prototype={};n.prototype.constructor=n;n.prototype.toString=function(){return this.name};t.tryFreeze(n.prototype);var i=function(i){var u=this,r;if(arguments.length===1&&i!==null&&typeof i=="object")for(r in i)u[r]=new n(r,i[r]);else t.forEach(arguments,function(t){u[t]=new n(t)});t.tryFreeze(this)};return i.prototype.symbols=function(){var t=[],i,n;for(i in this)(n=this[i],u.isFunction(n))||t.push(n);return t},i.prototype.contains=function(t){return(t instanceof n)?this[t.name]===t:!1},i}(),i.jsep=function(t){var a="Compound",k="Identifier",v="MemberExpression",h="Literal",d="ThisExpression",g="CallExpression",nt="UnaryExpression",tt="BinaryExpression",it="LogicalExpression",u=!0,f={"-":u,"!":u,"~":u,"+":u},r={"=>":0,"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},s=function(n){var t=0,i;for(var r in n)(i=r.length)>t&&n.hasOwnProperty(r)&&(t=i);return t},c=s(f),e=s(r),y={"true":!0,"false":!1,"null":null},rt="this",p=function(n){return r[n]||0},w=function(n,t,i){var r=n==="||"||n==="&&"?it:tt;return{type:r,operator:n,left:t,right:i}},o=function(n){return n>=48&&n<=57},l=function(n){return n===36||n===95||n===64||n>=65&&n<=90||n>=97&&n<=122},ut=function(n){return n===36||n===95||n>=65&&n<=90||n>=97&&n<=122||n>=48&&n<=57},i=function(n){for(var t=0,ct=n.charAt,lt=n.charCodeAt,i=function(t){return ct.call(n,t)},u=function(t){return lt.call(n,t)},b=n.length,s=function(){for(var n=u(t);n===32||n===9;)n=u(++t)},ot=function(){s();for(var i=n.substr(t,e),u=i.length;u>0;){if(r.hasOwnProperty(i))return t+=u,i;i=i.substr(0,--u)}return!1},tt=function(){var r,i,o,n,s,f,e,u;if(f=it(),i=ot(),!i)return f;if(s={value:i,prec:p(i)},e=it(),!e)throw new Error("Expected expression after "+i+" at character "+t);for(n=[f,s,e];i=ot();){if(o=p(i),o===0)break;for(s={value:i,prec:o};n.length>2&&o<=n[n.length-2].prec;)e=n.pop(),i=n.pop().value,f=n.pop(),r=w(i,f,e),n.push(r);if(r=it(),!r)throw new Error("Expected expression after "+i+" at character "+t);n.push(s);n.push(r)}for(u=n.length-1,r=n[u];u>1;)r=w(n[u-1].value,n[u-2],r),u-=2;return r},it=function(){var i,r,e;if(s(),i=u(t),o(i)||i===46)return at();if(i===39||i===34)return vt();if(l(i))return pt();if(i===40)return wt();for(r=n.substr(t,c),e=r.length;e>0;){if(f.hasOwnProperty(r))return t+=e,{type:nt,operator:r,argument:it(),prefix:!0};r=r.substr(0,--e)}return!1},at=function(){for(var n="";o(u(t));)n+=i(t++);if(i(t)===".")for(n+=i(t++);o(u(t));)n+=i(t++);if(i(t)==="e"||i(t)==="E"){for(n+=i(t++),(i(t)==="+"||i(t)==="-")&&(n+=i(t++));o(u(t));)n+=i(t++);if(!o(u(t-1)))throw new Error("Expected exponent ("+n+i(t)+") at character "+t);}if(l(u(t)))throw new Error("Variable names cannot start with a number ("+n+i(t)+") at character "+t);return{type:h,value:parseFloat(n),raw:n}},vt=function(){for(var n="",u=i(t++),f=!1,r;t<b;)if(r=i(t++),r===u){f=!0;break}else if(r==="\\"){r=i(t++);switch(r){case"n":n+="\n";break;case"r":n+="\r";break;case"t":n+="\t";break;case"b":n+="\b";break;case"f":n+="\f";break;case"v":n+="\x0b"}}else n+=r;if(!f)throw new Error('Unclosed quote after "'+n+'"');return{type:h,value:n,raw:u+n+u}},st=function(){var f=u(t),e=t,r;if(l(f))t++;else throw new Error("Unexpected "+i(t)+"at character "+t);while(t<b)if(f=u(t),ut(f))t++;else break;return r=n.slice(e,t),y.hasOwnProperty(r)?{type:h,value:y[r],raw:r}:r===rt?{type:d}:{type:k,name:r}},yt=function(){for(var r,u=[],n;t<b;)if(s(),r=i(t),r===")"){t++;break}else if(r===",")t++;else{if(n=tt(),!n||n.type===a)throw new Error("Expected comma at character "+t);u.push(n)}return u},pt=function(){var n,r,u;for(r=st(),s(),n=i(t);n==="."||n==="["||n==="(";){if(n===".")t++,s(),r={type:v,computed:!1,object:r,property:st()};else if(n==="["){if(u=t,t++,r={type:v,computed:!0,object:r,property:tt()},s(),n=i(t),n!=="]")throw new Error("Unclosed [ at character "+t);t++;s()}else n==="("&&(t++,r={type:g,arguments:yt(),callee:r});s();n=i(t)}return r},wt=function(){t++;var n=tt();if(s(),i(t)===")")return t++,n;throw new Error("Unclosed ( at character "+t);},ft=[],et,ht;t<b;)if(et=i(t),et===";"||et===",")t++;else if(ht=tt())ft.push(ht);else if(t<b)throw new Error("Unexpected '"+i(t)+"' at character "+t);return ft.length===1?ft[0]:{type:a,body:ft}},b;return i.version="0.2.8",i.toString=function(){return"JavaScript Expression Parser (JSEP) v"+i.version},i.addUnaryOp=function(n){return f[n]=u,this},i.addBinaryOp=function(n,t){return e=Math.max(n.length,e),r[n]=t,this},i.removeUnaryOp=function(n){return delete f[n],n.length===c&&(c=s(f)),this},i.removeBinaryOp=function(n){return delete r[n],n.length===e&&(e=s(r)),this},typeof n=="undefined"?(b=t.jsep,t.jsep=i,i.noConflict=function(){return t.jsep===i&&(t.jsep=b),i}):typeof module!="undefined"&&module.exports?n=module.exports=i:n.parse=i,i}(n),i}(),i=function(){return{DateConverterBase:function(){var i=function(n){this.name=n},n=i.prototype;return n.toString=function(){return this.name},n.parse=function(){throw t.createError(r.notImplemented,["DateConverterBase","parse"]);},n.toISOString=function(){throw t.createError(r.notImplemented,["DateConverterBase","toISOString"]);},i}(),DataTypeBase:function(){var i=function(n){this.name=n||"DataTypeBase";this.isComplex=!1},n=i.prototype;return n.toString=function(){return this.name},n.getRawValue=function(n){return n},n.isValid=function(n){return typeof n===this.name},n.toODataValue=function(n){return n.toString()},n.toBeetleValue=function(n){return n.toString()},n.defaultValue=function(){throw t.createError(r.notImplemented,[this.name,"defaultValue"]);},n.autoValue=function(){throw t.createError(r.notImplemented,[this.name,"autoValue"]);},n.handle=function(){throw t.createError(r.notImplemented,[this.name,"handle"]);},i}(),ExpressionBase:function(){var i=function(n,t,i,r){this.name=n||"ExpressionBase";this.order=t;this.onlyBeetle=i;this.isProjection=r},n=i.prototype;return n.toString=function(){return this.toBeetleQuery({})},n.toODataQuery=function(n){if(this.onlyBeetle===!0)return this.toBeetleQuery(n);var i=u.isFunction(this.exp)?t.funcToLambda(this.exp):this.exp;return t.jsepToODataQuery(h.jsep(i),n)},n.toBeetleQuery=function(n){if(!this.exp)return"";var i=u.isFunction(this.exp)?t.funcToLambda(this.exp):this.exp;return t.jsepToBeetleQuery(h.jsep(i),n)},n.clone=function(){throw t.createError(r.notImplemented,[this.name,"clone"]);},n.execute=function(){throw t.createError(r.notImplemented,[this.name,"execute"]);},i}(),QueryFuncBase:function(){var i=function(n,t,i){this.name=n;this.beetleName=t;this.argCount=i},n=i.prototype;return n.toODataFunction=function(){for(var t=[],n=0;n<arguments.length;n++)t.push(arguments[n]);return this.name+"("+t.join(", ")+")"},n.toBeetleFunction=function(){var i="",n=0,t;for(arguments.length==this.argCount&&(i=arguments[0]+".",++n),t=[],n;n<arguments.length;n++)t.push(arguments[n]);return i+this.beetleName+"("+t.join(", ")+")"},n.impl=function(){throw t.createError(r.notImplemented,[this.name,"impl"]);},i}(),QueryBase:function(){var f=function(){this.expressions=[];this.inlineCountEnabled=!1;this.lastExpOrder=0;this.isMultiTyped=!1;this.lastProjection=0;this.isClosed=!1;this.hasBeetlePrm=!1;this.options=null},n=f.prototype;return n.executeAfterExecuter=!1,n.toString=function(){var n=[],i;return t.forEach(this.parameters,function(t){n.push(t.name+": "+(t.value==null?"":t.value))}),this.inlineCountEnabled===!0&&n.push("inlinecount: allpages"),i={},t.forEach(this.expressions,function(t){i.expVarContext=t.varContext;n.push(t.name+": "+t.toBeetleQuery(i));i.expVarContext=undefined}),n.join(", ")},n.addExpression=function(n){if(this.isClosed)throw t.createError(r.queryClosed,null,{query:this});if(t.assertPrm(n,"expression").isInstanceOf(i.ExpressionBase).check(),this.expressions.push(n),n.isExecuter===!0){var u=this.options&&this.options.executeAfterExecuter;if(u==null&&(u=this.executeAfterExecuter),u)return this.execute();this.isClosed=!0}return(n.order<this.lastExpOrder||this.hasBeetlePrm&&!n.onlyBeetle)&&(this.isMultiTyped=!0),n.isProjection===!0&&(this.lastProjection=this.expressions.length-1),n.onlyBeetle&&(this.hasBeetlePrm=!0),this},n.inlineCount=function(n){var t=this.clone();return t.inlineCountEnabled=n!==!1,t},n.ofType=function(n){var t=this.clone();return t.addExpression(new o.expressions.OfTypeExp(n))},n.where=function(n,t){var i=this.clone();return i.addExpression(new o.expressions.WhereExp(n,t))},n.orderBy=function(n,t){var i=this.clone();return i.addExpression(new o.expressions.OrderByExp(n,t))},n.orderByDesc=function(n){return this.orderBy(n,!0)},n.select=function(n){var i=this.clone(),t;return arguments.length==1?(t=arguments[0],u.isArray(t)&&(n=t.join(", "))):n=Array.prototype.slice.call(arguments).join(", "),i.addExpression(new o.expressions.SelectExp(n))},n.skip=function(n){var t=this.clone();return t.addExpression(new o.expressions.SkipExp(n))},n.take=function(n){return this.top(n)},n.top=function(n){var t=this.clone();return t.addExpression(new o.expressions.TopExp(n))},n.groupBy=function(n,t){var i=this.clone();return u.isArray(n)&&(n=n.join(", ")),u.isArray(t)&&(t=t.join(", ")),i.addExpression(new o.expressions.GroupByExp(n,t))},n.distinct=function(n){var t=this.clone();return u.isArray(n)&&(n=n.join(", ")),t.addExpression(new o.expressions.DistinctExp(n))},n.reverse=function(){var n=this.clone();return n.addExpression(new o.expressions.ReverseExp)},n.selectMany=function(n){var t=this.clone();return t.addExpression(new o.expressions.SelectManyExp(n))},n.skipWhile=function(n,t){var i=this.clone();return i.addExpression(new o.expressions.SkipWhileExp(n,t))},n.takeWhile=function(n,t){var i=this.clone();return i.addExpression(new o.expressions.TakeWhileExp(n,t))},n.all=function(n,t){var i=this.clone();return i.addExpression(new o.expressions.AllExp(n,t))},n.any=function(n,t){var i=this.clone();return i.addExpression(new o.expressions.AnyExp(n,t))},n.avg=function(n){var t=this.clone();return t.addExpression(new o.expressions.AvgExp(n))},n.max=function(n){var t=this.clone();return t.addExpression(new o.expressions.MaxExp(n))},n.min=function(n){var t=this.clone();return t.addExpression(new o.expressions.MinExp(n))},n.sum=function(n){var t=this.clone();return t.addExpression(new o.expressions.SumExp(n))},n.count=function(n,t){var i=this.clone();return i.addExpression(new o.expressions.CountExp(n,t))},n.first=function(n,t){var i=this.clone();return i.addExpression(new o.expressions.FirstExp(n,t))},n.firstOrDefault=function(n,t){var i=this.clone();return i.addExpression(new o.expressions.FirstOrDefaultExp(n,t))},n.single=function(n,t){var i=this.clone();return i.addExpression(new o.expressions.SingleExp(n,t))},n.singleOrDefault=function(n,t){var i=this.clone();return i.addExpression(new o.expressions.SingleOrDefaultExp(n,t))},n.last=function(n,t){var i=this.clone();return i.addExpression(new o.expressions.LastExp(n,t))},n.lastOrDefault=function(n,t){var i=this.clone();return i.addExpression(new o.expressions.LastOrDefaultExp(n,t))},n.withOptions=function(n){var i=this.clone();return i.options=t.combine(this.options,n),i},n.execute=function(){throw t.createError(r.notImplemented,["Query","execute"]);},n.x=function(){return this.execute.apply(this,arguments)},n.toFunction=function(){var n=this;return function(i,r){var f={varContext:r};return f.aliases=[],n.inlineCountEnabled&&(f.inlineCount=i.length),t.forEach(n.expressions,function(t){f.expVarContext=t.varContext;i=t.execute(i,f);!n.inlineCountEnabled||u.isInstanceOf(t,o.expressions.TopExp)||u.isInstanceOf(t,o.expressions.SkipExp)||(f.inlineCount=i.length);f.expVarContext=undefined}),n.inlineCountEnabled&&(i.$inlineCount=f.inlineCount),i}},n.clone=function(){throw t.createError(r.notImplemented,["Query","clone"]);},n.copy=function(n){t.forEach(this.expressions,function(t){n.expressions.push(t.clone())});n.inlineCountEnabled=this.inlineCountEnabled;n.lastExpOrder=this.lastExpOrder;n.isMultiTyped=this.isMultiTyped;n.lastProjection=this.lastProjection;n.isClosed=this.isClosed;n.hasBeetlePrm=this.hasBeetlePrm;this.options&&(n.options=t.combine(null,this.options))},n.getExpression=function(n,i){for(var e,f=this.lastProjection;f<this.expressions.length;f++)if(e=this.expressions[f],u.isInstanceOf(e,n))return e;if(i===!0)throw t.createError(r.expressionCouldNotBeFound,{type:n,query:this});return null},n.removeExpression=function(n){for(var i,t=this.expressions.length-1;t>=0;t--)i=this.expressions[t],u.isInstanceOf(i,n)&&this.expressions.splice(t,1);return this},f}(),ObservableProviderBase:function(){var i=function(n){this.name=n||"ObservableProviderBase"},n=i.prototype;return n.toString=function(){return this.name},n.isObservable=function(){throw t.createError(r.notImplemented,[this.name,"isObservable"]);},n.toObservable=function(){throw t.createError(r.notImplemented,[this.name,"toObservable"]);},n.getValue=function(){throw t.createError(r.notImplemented,[this.name,"getValue"]);},n.setValue=function(){throw t.createError(r.notImplemented,[this.name,"setValue"]);},i}(),AjaxProviderBase:function(){var n=function(n){this.name=n||"AjaxProviderBase";this.syncSupported=!0},i=n.prototype;return i.toString=function(){return this.name},i.doAjax=function(){throw t.createError(r.notImplemented,[this.name,"doAjax"]);},n}(),SerializationServiceBase:function(){var i=function(n){this.name=n||"SerializationServiceBase"},n=i.prototype;return n.toString=function(){return this.name},n.serialize=function(){throw t.createError(r.notImplemented,[this.name,"serialize"]);},n.deserialize=function(){throw t.createError(r.notImplemented,[this.name,"deserialize"]);},i}(),PromiseProviderBase:function(){var i=function(n){this.name=n||"PromiseProviderBase"},n=i.prototype;return n.toString=function(){return this.name},n.deferred=function(){throw t.createError(r.notImplemented,[this.name,"deferred"]);},n.getPromise=function(){throw t.createError(r.notImplemented,[this.name,"getPromise"]);},n.resolve=function(){throw t.createError(r.notImplemented,[this.name,"resolve"]);},n.reject=function(){throw t.createError(r.notImplemented,[this.name,"reject"]);},i}(),DataServiceBase:function(){function v(n,i,e,o){if(o._awaitingMetadata=!1,o._readyCallbacks=[],n==null?n="":n[n.length-1]!=="/"&&(n+="/"),o.uri=n,e=e||{},o.ajaxProvider=e.ajaxProvider||s.getAjaxProvider(),o.serializationService=e.serializationService||s.getSerializationService(),o.ajaxTimeout=e.ajaxTimeout,o.dataType=e.dataType||"json",o.contentType=e.contentType||"application/json; charset=utf-8",f=e.registerMetadataTypes,f==null&&(f=s.registerMetadataTypes),i!==!1||i===undefined)if(i==null){var a=null;s.cacheMetadata===!0&&(a=t.findInArray(c,n,"uri"));a?o.metadataManager=a.data:(o._awaitingMetadata=!0,o.fetchMetadata(null,function(t){o._awaitingMetadata=!1;o.metadataManager=new l.MetadataManager(t);s.cacheMetadata===!0&&c.push({uri:n,data:o.metadataManager});h(o)},function(n){throw t.createError(r.couldNotLoadMetadata,{exception:n,args:arguments,dataService:this});}))}else if(u.isInstanceOf(i,l.MetadataManager))o.metadataManager=i;else if(u.isObject(i))try{o.metadataManager=new l.MetadataManager(i)}catch(v){throw t.createError(r.invalidArguments,{exception:v,args:arguments,dataService:this});}o._awaitingMetadata||h(o)}function h(t){var r,u,o,i,s;if(t.isReady())for(r=t.metadataManager,f&&r&&(u=r.name,n.hasOwnProperty(u)||(n[u]=e.EntityManager)),o=t._readyCallbacks.slice(0),t._readyCallbacks=[],i=0;i<o.length;i++)s=o[i],s&&s.call(t)}var c=[],a=function(n,t,i){v(n,t,i,this)},i=a.prototype,f;return i.toString=function(){return this.uri},i.isReady=function(){return!this._awaitingMetadata},i.ready=function(n){this._readyCallbacks.push(n);h(this)},i.getEntityType=function(n){return this.metadataManager?this.metadataManager.getEntityType(n):null},i.createQuery=function(n,i,r){return(t.assertPrm(n,"resourceName").isNotEmptyString().check(),i)?this.createEntityQuery(i,n,r):this.metadataManager?this.metadataManager.createQuery(n,null,r):new o.EntityQuery(n,null,r)},i.createEntityQuery=function(n,i,u){if(!this.metadataManager)throw t.createError(r.noMetadataEntityQuery,{dataService:this});return this.metadataManager.createQuery(i,n,u)},i.registerCtor=function(n,i,u){if(this.metadataManager==null)throw t.createError(r.noMetadataEntityQuery);this.metadataManager.registerCtor(n,i,u)},i.createEntity=function(n,i){if(!this.metadataManager)throw t.createError(r.noMetadataEntityQuery,{dataService:this});return this.metadataManager.createEntity(n,i)},i.createRawEntity=function(n,i){if(!this.metadataManager)throw t.createError(r.noMetadataEntityQuery,{dataService:this});return this.metadataManager.createRawEntity(n,i)},i.toEntity=function(n,t){var i=null;return this.metadataManager&&(i=this.metadataManager.getEntityTypeByFullName(t)),i||(i=new l.EntityType(t)),e.EntityTracker.toEntity(n,i,s.getObservableProvider())},i.toODataQueryParams=function(n,i){if(n.isMultiTyped===!0)throw t.createError(r.oDataNotSupportMultiTyped,{query:n});var u={varContext:i},f=[];return t.forEach(n.parameters,function(n){f.push({name:n.name,value:n.value==null?"":n.value})}),n.inlineCountEnabled===!0&&f.push({name:"$inlinecount",value:"allpages"}),t.forEach(n.expressions,function(n,t){u.expVarContext=n.varContext;var r,i;n.onlyBeetle===!0?(r="!e"+t,i=n.toBeetleQuery(u),i=n.name+":"+i):(r="$"+n.name,i=n.toODataQuery(u));f.push({name:r,value:i});u.expVarContext=undefined}),f},i.toBeetleQueryParams=function(n,i){var u={varContext:i},r=[];return t.forEach(n.parameters,function(n){r.push({name:n.name,value:n.value==null?"":n.value})}),n.inlineCountEnabled===!0&&r.push({name:"!e0",value:"inlinecount:allpages"}),t.forEach(n.expressions,function(n,t){u.expVarContext=n.varContext;r.push({name:"!e"+(t+1),value:n.name+":"+n.toBeetleQuery(u)});u.expVarContext=undefined}),r},i.fetchMetadata=function(){throw t.createError(r.notImplemented,["DataServiceBase","fetchMetadata"]);},i.createEntityAsync=function(){throw t.createError(r.notImplemented,["DataServiceBase","createEntityAsync"]);},i.executeQuery=function(){throw t.createError(r.notImplemented,["DataServiceBase","executeQuery"]);},i.executeQueryParams=function(){throw t.createError(r.notImplemented,["DataServiceBase","executeQueryParams"]);},i.saveChanges=function(){throw t.createError(r.notImplemented,["DataServiceBase","saveChanges"]);},a}()}}(),c=function(){return{defaultDateConverterInstance:function(){var n=function(){i.DateConverterBase.call(this,"Default Date Converter")},r;return t.inherit(n,i.DateConverterBase),r=n.prototype,r.parse=function(n){if(typeof n!="string"||n.length<10||!/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])$/.test(n.substr(0,10)))return null;/.\d{3}$/.test(n)&&(n+="Z");try{var t=Date.parse(n);return isNaN(t)?null:new Date(t)}catch(i){return null}},r.toISOString=function(n){return n.toISOString()},new n}(),koObservableProviderInstance:function(n){var f,r;return n&&(n.extenders.intercept=function(t,i){return n.computed({read:t,write:function(n){var r=i&&i.callback;r&&r(i.object,i.property,t,n)}})}),f=function(){i.ObservableProviderBase.call(this,"Knockout Observable Provider");t.tryFreeze(this)},t.inherit(f,i.ObservableProviderBase),r=f.prototype,r.isObservable=function(t,i){return n.isObservable(t[i])},r.toObservable=function(i,r,f){function o(t,r,u){var f=n.observable(r);return u?n.observable(r).extend({intercept:{object:i,property:t,callback:u}}):f}function h(r,u,f,e,o){var s;return f=f||[],e&&(f=t.createTrackableArray(f,i,r,function(n,t,r,f,o){s.$fromKo!==!0&&i[u].valueHasMutated();s.$fromKo=!1;e(n,t,r,f,o)})),s=n.observableArray(f),s.subscribe(function(){s.$fromKo=!0},null,"beforeChange"),o&&(s.equalityComparer=function(n,t){o(i,r,n,t)}),s}var c=f&&f.propertyChange,l=f&&f.arrayChange,a=f&&f.dataPropertyChange,v=f&&f.scalarNavigationPropertyChange,y=f&&f.pluralNavigationPropertyChange,s=f&&f.arraySet,e=[];t.forEachProperty(i,function(n,t){e.push({p:n,v:t})});r&&r.hasMetadata&&(t.forEach(r.dataProperties,function(n){var r=i[n.name];r=r===undefined?null:n.handle(r);i[n.name]=o(n,r,a);t.removeFromArray(e,n.name,"p")}),t.forEach(r.navigationProperties,function(n){var r=i[n.name];r===undefined&&(r=null);i[n.name]=n.isScalar?o(n,r,v):h(n,n.name,r,y,s);t.removeFromArray(e,n.name,"p")}));t.forEach(e,function(n){var f=n.p,e=n.v;i[f]=u.isArray(e)?h(f,f,e,l,s):o(f,e,c);t.findInArray(r.properties,f)||r.properties.push(f)})},r.getValue=function(t,i){return n.utils.unwrapObservable(t[i])},r.setValue=function(n,t,i){n[t](i)},new f}(n.ko),propertyObservableProviderInstance:function(){var r=function(){i.ObservableProviderBase.call(this,"Property Observable Provider");t.tryFreeze(this)},n;return t.inherit(r,i.ObservableProviderBase),n=r.prototype,n.isObservable=function(n,t){return n.$fields!==undefined&&n.$fields[t]!==undefined},n.toObservable=function(n,i,r){function o(t,i,r){return Object.defineProperty(n,i,{get:function(){return n.$fields[i]},set:function(u){if(r){var f=p(n,i);r(n,t,f,u)}else n.$fields[i]=u},enumerable:!0,configurable:!0})}function h(i,r,u,e,o){return u=u||[],e&&(u=t.createTrackableArray(u,n,i,e)),f[r]=u,Object.defineProperty(n,r,{get:function(){return n.$fields[r]},set:function(t){o?o(n,i,items,t):n.$fields[r]=t}})}function p(n,t){return function(){return arguments.length==0?n.$fields[t]:n.$fields[t]=arguments[0]}}var c=r&&r.propertyChange,l=r&&r.arrayChange,a=r&&r.dataPropertyChange,v=r&&r.scalarNavigationPropertyChange,y=r&&r.pluralNavigationPropertyChange,s=r&&r.arraySet,f={},e=[];return t.forEachProperty(n,function(n,t){e.push({p:n,v:t})}),i&&i.hasMetadata&&(t.forEach(i.dataProperties,function(i){var r=n[i.name];r=r===undefined?null:i.handle(r);delete n[i.name];o(i,i.name,a);t.removeFromArray(e,i.name,"p");f[i.name]=r}),t.forEach(i.navigationProperties,function(i){var r=n[i.name];r===undefined&&(r=null);delete n[i.name];i.isScalar?(o(i,i.name,v),f[i.name]=r):h(i,i.name,r,y,s);t.removeFromArray(e,i.name,"p")})),t.forEach(e,function(r){var e=r.p,a=r.v;delete n[e];u.isArray(a)?h(e,e,a,l,s):(o(e,e,c),f[e]=a);t.findInArray(i.properties,e)||i.properties.push(e)}),n.$fields=f,n},n.getValue=function(n,t){return n[t]},n.setValue=function(n,t,i){n[t]=i},new r}(),jQueryAjaxProviderInstance:function(n){function f(n){var i={status:n.status,xhr:n};if(n.responseText)try{i.detail=JSON.parse(n.responseText)}catch(r){}return t.createError(n.statusText,i)}function e(n){return function(t){return n.getResponseHeader(t)}}var r=function(){i.AjaxProviderBase.call(this,"jQuery Ajax Provider");t.tryFreeze(this)},u;return t.inherit(r,i.AjaxProviderBase),u=r.prototype,u.doAjax=function(t,i,r,u,o,s,h,c,l,a,v){var y={url:t,accepts:{json:"application/json; odata=verbose",xml:"text/xml; application/xhtml+xml;application/xml",text:"text/xml"},type:i,dataType:r,contentType:u,traditional:!1,data:o,async:s,timeout:h,headers:l,success:function(n,t,i){if(i.onreadystatechange=null,i.abort=null,n&&n.Error){var r=f(i);r.message=n.Error;v(r)}else a(n,e(i),i)},error:function(n){n.onreadystatechange=null;n.abort=null;v(f(n))}};return c!=null&&n.extend(y,c),y.cache==null&&(y.cache=!1),n.ajax(y)},new r}(n.$),angularAjaxProviderInstance:function(n){function o(n){return function(t){return t?n[t.toLowerCase()]:n}}var u=function(){i.AjaxProviderBase.call(this,"Angular Ajax Provider");this.syncSupported=!1;t.tryFreeze(this)},f,e;return t.inherit(u,i.AjaxProviderBase),f=u.prototype,n&&(e=n.injector(["ng"]).get("$http")),f.doAjax=function(n,i,u,f,s,h,c,l,a,v,y){if(h===!1)throw t.createError(r.syncNotSupported,[this.name]);var p={method:i,url:n,contentType:f,data:s,timeout:c,headers:a,responseType:u,transformResponse:[function(n){return n}]};return l!=null&&t.extend(p,l),p.cache==null&&(p.cache=!1),e(p).success(function(n,t,i){v(n,o(i()))}).catch(function(n){var i={status:n.status,config:n.config,detail:n.data,error:n};y(t.createError(n.statusText,i))})},new u}(n.angular),jsonSerializationServiceInstance:function(){var n=function(){i.SerializationServiceBase.call(this,"Json Serializer");t.tryFreeze(this)},r;return t.inherit(n,i.SerializationServiceBase),r=n.prototype,r.serialize=function(n){return JSON.stringify(n)},r.deserialize=function(n){return u.isTypeOf(n,"string")?JSON.parse(n):n},new n}(),qPromiseProviderInstance:function(n){var u=function(){i.PromiseProviderBase.call(this,"Q Promise Provider");t.tryFreeze(this)},r;return t.inherit(u,i.PromiseProviderBase),r=u.prototype,r.toString=function(){return this.name},r.deferred=function(){return n.defer()},r.getPromise=function(n){return n.promise},r.resolve=function(n,t){n.resolve(t)},r.reject=function(n,t){n.reject(t)},new u}(n.Q),angularPromiseProviderInstance:function(n){var f=function(){i.PromiseProviderBase.call(this,"Angular Promise Provider");t.tryFreeze(this)},r,u,e;return t.inherit(f,i.PromiseProviderBase),r=f.prototype,r.toString=function(){return this.name},n&&(u=n.injector(["ng"]),e=u.get("$q")),r.deferred=function(){return e.defer()},r.getPromise=function(n){return n.promise},r.resolve=function(n,t){n.resolve(t);u.get("$rootScope").$apply()},r.reject=function(n,t){n.reject(t);u.get("$rootScope").$apply()},new f}(n.angular),jQueryPromiseProviderInstance:function(n){var u=function(){i.PromiseProviderBase.call(this,"jQuery Promise Provider");t.tryFreeze(this)},r;return t.inherit(u,i.PromiseProviderBase),r=u.prototype,r.toString=function(){return this.name},r.deferred=function(){return n.Deferred()},r.getPromise=function(n){return n.promise()},r.resolve=function(n,t){n.resolve(t)},r.reject=function(n,t){n.reject(t)},new u}(n.$)}}(),l=function(){return{DataProperty:function(){var i=function(n,t,i,r,u,f,o,s,h){this.owner=n;this.name=t;this.displayName=i||t;this.dataType=r;this.isNullable=u;this.isKeyPart=f;this.generationPattern=o;this.defaultValue=s;this.useForConcurrency=h;this.relatedNavigationProperties=[];this.validators=[];this.isEnum=r instanceof e.dataTypes.enumeration;this.isComplex=r.isComplex},n=i.prototype;return n.toString=function(){return this.displayName},n.isValid=function(n){return n==null?!this.isNullable:this.dataType.isValid(n,this)},n.handle=function(n){if(this.dataType!=e.dataTypes.string&&n===""&&(n=null),n==null){if(!this.isNullable)throw t.createError(r.notNullable,[this.displayName],{property:this});return null}if(n=this.dataType.handle(n,this),this.dataType==e.dataTypes.number&&this.precision&&n.toString().replace(/\./g,"").length>this.precision)throw t.createError(r.maxPrecisionError,[n,this.precision],{dataType:dataType,value:n});return this.dataType==e.dataTypes.number&&this.scale!=null&&(n=Number(n.toFixed(this.scale))),n},n.getDefaultValue=function(){return this.defaultValue!=null?this.defaultValue:this.isNullable?null:this.generationPattern==f.generationPattern.Identity&&this.isKeyPart===!0?this.dataType.autoValue():this.dataType.defaultValue()},n.addValidation=function(n,i,r,u){t.assertPrm(n,"name").isNotEmptyString().check();t.assertPrm(i,"func").isFunction().check();this.validators.push(new e.Validator(n,i,r,u))},n.validate=function(n){var r=[],u,i;return this.validators.length>0&&(u=this,i=t.getValue(n,this.name),t.forEach(this.validators,function(f){var e=f.validate(i,n);e&&r.push(t.createValidationError(n,i,u,e,f))})),r},i}(),NavigationProperty:function(){var i=function(n,t,i,r,u,f,e,o){this.owner=n;this.name=t;this.displayName=i||t;this.entityTypeName=r;this.entityType=null;this.isScalar=u;this.isComplex=f===undefined;this.associationName=f;this.cascadeDelete=e===!0;this.foreignKeyNames=o||[];this.inverse=null;this.foreignKeys=[];this.validators=[];this.triggerOwnerModify=!1},n=i.prototype;return n.toString=function(){return this.displayName},n.checkAssign=function(n){if(n!=null){if(!n.$tracker)throw t.createError(r.assignErrorNotEntity,[this],{property:this,value:n});var i=n.$tracker.entityType;if(!this.entityType.isAssignableWith(i))throw t.createError(r.assignError,[this.name,i.shortName],{property:this,value:n});}},n.addValidation=function(n,i,r,u){t.assertPrm(n,"name").isNotEmptyString().check();t.assertPrm(i,"func").isFunction().check();this.validators.push(new e.Validator(n,i,r,u))},n.validate=function(n){var u=[],i,r;return this.validators.length>0&&(i=this,r=t.getValue(n,i.name),t.forEach(this.validators,function(f){var e=f.validate(r);e&&u.push(t.createValidationError(n,r,i,e,f))})),u},i}(),EntityType:function(){function f(n,t){n.baseType&&f(n.baseType,t);n.constructor&&n.constructor.call(t,t)}function a(n,i){for(var u,f,e,o=n.length,r=0;r<o;r++){if(u=n[r],r==o-1)return f=t.findInArray(i.dataProperties,u,"name"),f?f:t.findInArray(i.navigationProperties,u,"name");if(e=t.findInArray(i.navigationProperties,u,"name"),e)i=e.entityType;else return null}return null}function h(n,t){return n.name===t.name?!0:t.baseType!=null?h(n,t.baseType):!1}function c(n,t){var i=u.isTypeOf(t,"string")?t:t.name;return n.name===i?!0:n.baseType!=null?c(n.baseType,t):!1}var i=function(n,t,i,r,u,f,e,o,s){this.name=n;this.displayName=t||n;this.shortName=i;this.keyNames=r||[];this.baseTypeName=u;this.setName=f;this.setTypeName=e;this.metadataManager=s;this.hasMetadata=s!=null;this.properties=[];this.dataProperties=[];this.navigationProperties=[];this.keys=[];this.floorType=this;this.baseType=null;this.validators=[];this.isComplexType=o==!0;this.constructor=null;this.initializer=null},n=i.prototype;return n.toString=function(){return this.name},n.getProperty=function(n){return a(n.split("."),this)},n.createQuery=function(n,t){if(n)return new o.EntityQuery(n,this,t);var i=new o.EntityQuery(this.setName,this,t);return this.shortName==this.setTypeName?i:i.ofType(this.shortName)},n.registerCtor=function(n,i){n!=null&&t.assertPrm(n,"constructor").isFunction().check();i!=null&&t.assertPrm(i,"initializer").isFunction().check();this.constructor=n;this.initializer=i},n.createEntity=function(n){var t=this.createRawEntity(n);return e.EntityTracker.toEntity(t,this,s.getObservableProvider())},n.createRawEntity=function(n){var i=n||{};return t.forEach(this.dataProperties,function(n){i[n.name]===undefined&&(i[n.name]=n.getDefaultValue())}),t.forEach(this.navigationProperties,function(n){i[n.name]=n.isComplex?n.entityType.createRawEntity():n.isScalar?null:[]}),f(this,i),i.$type=this.name,i},n.isAssignableWith=function(n){return h(this,n)},n.isAssignableTo=function(n){return c(this,n)},n.hasSameBaseType=function(n){return this.floorType.name===n.floorType.name},n.addDataProperty=function(n,i,f,o,s){var h,c;if(t.assertPrm(n,"name").isNotEmptyString().check(),h=t.findInArray(this.dataProperties,n,"name"),h)throw t.createError(r.dataPropertyAlreadyExists,[n],{entityType:this,existing:h});if(u.isNotEmptyString(f)&&(f=e.dataTypes.byName(f)),t.assertPrm(f,"dataType").isInstanceOf(e.dataTypes.baseType).check(),s!=null&&!f.isValid(s))throw t.createError(r.invalidDefaultValue,[s,f.name],{entityType:this,dataType:f,defaultValue:s});c=new l.DataProperty(this,n,i,f,o===!0,!1,null,s);this.dataProperties.push(c)},n.addValidation=function(n,i,r,u){t.assertPrm(n,"name").isNotEmptyString().check();t.assertPrm(i,"func").isFunction().check();this.validators.push(new e.Validator(n,i,r,u))},n.validate=function(n){var i=[];return this.validators.length>0&&t.forEach(this.validators,function(r){var u=r.validate(n);u&&i.push(t.createValidationError(n,null,null,u,r))}),t.forEach(this.dataProperties,function(t){var r=t.validate(n);r&&(i=i.concat(r))}),t.forEach(this.navigationProperties,function(t){var r=t.validate(n);r&&(i=i.concat(r))}),i},i}(),MetadataManager:function(){var i=function(n){this.types=[];this.typesDict={};this.enums={};this.name=null;this.displayName=null;n&&this.parseBeetleMetadata(n)},n=i.prototype;return n.toString=function(){return this.types.join(", ")},n.getEntityTypeByFullName=function(n,i){var u=t.findInArray(this.types,n,"name");if(!u&&i===!0)throw t.createError(r.notFoundInMetadata,[n],{metadataManager:this,typeName:n});return u},n.getEntityType=function(n,i){u.isFunction(n)&&(n=t.getFuncName(n));var f=this.typesDict[n];if(!f&&i===!0)throw t.createError(r.notFoundInMetadata,[n],{metadataManager:this,typeShortName:n});return f},n.createQuery=function(n,i,r){if(u.isFunction(i)&&(i=t.getFuncName(i)),i)return this.getEntityType(i,!0).createQuery(n,r);var f=t.filterArray(this.types,function(t){return t.setName==n});return f.length==1?f[0].createQuery(n,r):new o.EntityQuery(n,null,r)},n.registerCtor=function(n,i,r){u.isFunction(n)&&(n=t.getFuncName(n));var f=this.getEntityType(n,!0);f.registerCtor(i,r)},n.createEntity=function(n,i){u.isFunction(n)&&(n=t.getFuncName(n));var r=this.getEntityType(n,!0);return r.createEntity(i)},n.createRawEntity=function(n,i){u.isFunction(n)&&(n=t.getFuncName(n));var r=this.getEntityType(n,!0);return r.createRawEntity(i)},n.parseBeetleMetadata=function(n){var s,v,c,o,y,p,w,b,a,i,r,k,d;if(u.isTypeOf(n,"string")&&(n=JSON.parse(n)),this.types=[],this.typesDict={},this.enums={},this.name=n.n,this.displayName=t.getResourceValue(n.r,n.l||n.n),s=n.e,v={},s)for(c=0;c<s.length;c++)o=s[c],y={},t.forEach(o.m,function(n){y[n.n]={name:n.n,value:n.v,displayName:t.getResourceValue(n.r,n.l||n.n)}}),p=new h.Enum(y),this.enums[o.n]=p,v[o.n]=new e.dataTypes.enumeration(p,o.n,t.getResourceValue(o.r,o.l||o.n));for(w=this,b=n.m,a=0;a<b.length;a++)i=b[a],r=new l.EntityType(i.n,t.getResourceValue(i.rn,i.s),i.s,i.k,i.b,i.q,i.t,i.c,this),t.forEach(i.d,function(n){var o,s,u;o=n.e?v[n.t]:e.dataTypes.byName(n.t);s=t.getResourceValue(n.r,n.l||n.n);u=new l.DataProperty(r,n.n,s,o,n.i===!0,i.k&&t.findInArray(i.k,n.n)!=null,n.g?n.g=="I"?f.generationPattern.Identity:f.generationPattern.Computed:null,n.d?o.handle(n.d):null,n.c);n.v&&t.forEach(n.v,function(t){u.validators.push(e.Validator.byCode(t.t,t.a,t.m,t.r,u.displayName,n.r))});n.p&&(u.precision=Number(n.p));n.s&&(u.scale=Number(n.s));r.dataProperties.push(u)}),k=i.r,k&&t.forEach(k,function(n){var i=new l.NavigationProperty(r,n.n,t.getResourceValue(n.r,n.l||n.n),n.t,n.s===!0,n.a,n.c);n.f&&t.forEach(n.f,function(n){i.foreignKeyNames.push(n)});n.v&&t.forEach(n.v,function(t){i.validators.push(e.Validator.byCode(t.t,t.a,t.m,t.r,i.displayName,n.r))});r.navigationProperties.push(i)}),d=i.x,d&&t.forEach(d,function(n){var i=new l.NavigationProperty(r,n.n,t.getResourceValue(n.r,n.l||n.n),n.t,!0);r.navigationProperties.push(i)}),this.types.push(r),this.typesDict[r.shortName]=r;t.forEach(this.types,function(n){n.baseTypeName&&(n.baseType=w.getEntityType(n.baseTypeName,!0));delete n.baseTypeName});t.forEach(this.types,function(n){for(var i=n.baseType;i;)n.floorType=i,t.forEach(i.dataProperties,function(i){t.findInArray(n.dataProperties,i.name,"name")||n.dataProperties.push(i)}),t.forEach(i.navigationProperties,function(i){t.findInArray(n.navigationProperties,i.name,"name")||n.navigationProperties.push(i)}),i=i.baseType;t.forEach(n.navigationProperties,function(i){var r,u;if(!i.entityType)for(i.entityType=w.getEntityType(i.entityTypeName,!0),r=0;r<i.entityType.navigationProperties.length;r++)if(u=i.entityType.navigationProperties[r],u.associationName===i.associationName&&i!==u){i.inverse=u;break}t.forEach(i.foreignKeyNames,function(r){if(!t.findInArray(i.foreignKeys,r,"name")){var u=t.findInArray(n.dataProperties,r,"name");u&&(u.relatedNavigationProperties.push(i),i.foreignKeys.push(u))}})});t.forEach(n.keyNames,function(i){n.keys.push(t.findInArray(n.dataProperties,i,"name"))})})},i}()}}(),o=function(){return function(){String.prototype.hasOwnProperty("substringOf")||(String.prototype.substringOf=function(n){return u.isNotEmptyString(n)&&n.indexOf(this)>=0});String.prototype.hasOwnProperty("startsWith")||(String.prototype.startsWith=function(n){return this.indexOf(n)==0});String.prototype.hasOwnProperty("endsWith")||(String.prototype.endsWith=function(n){return this.indexOf(n)==this.length-n.length});Number.prototype.hasOwnProperty("round")||(Number.prototype.round=function(){return Math.round(this)});Number.prototype.hasOwnProperty("ceiling")||(Number.prototype.ceiling=function(){return Math.ceil(this)});Number.prototype.hasOwnProperty("floor")||(Number.prototype.floor=function(){return Math.floor(this)})}(),{expressions:function(){return{OfTypeExp:function(){var n=function(n){u.isFunction(n)&&(n=t.getFuncName(n));i.ExpressionBase.call(this,"oftype",-1,!0,!0);this.typeName=n},r;return t.inherit(n,i.ExpressionBase),r=n.prototype,r.toBeetleQuery=function(){return this.typeName},r.clone=function(){return new n(this.typeName)},r.execute=function(n){var i=this;return t.filterArray(n,function(n){return n&&(n.$tracker&&n.$tracker.entityType.isAssignableTo(i.typeName)||typeof n===i.typeName)})},n}(),WhereExp:function(){var n=function(n,t){i.ExpressionBase.call(this,"filter",2,!1,!1);this.exp=n;this.varContext=t},r;return t.inherit(n,i.ExpressionBase),r=n.prototype,r.clone=function(){return new n(this.exp,this.varContext)},r.execute=function(n,i){var r=u.isFunction(this.exp)?this.exp:t.jsepToFunction(h.jsep(this.exp),i);return t.filterArray(n,r)},n}(),OrderByExp:function(){function f(n){return n+=",",n=n.replace(/\,/," ,").replace(/ desc.*?\,/g," x,").replace(/ \,/g," desc,").replace(/ x\,/g,","),n.substr(0,n.length-1)}var e="x => x",r=function(n,t){i.ExpressionBase.call(this,"orderby",1,!1,!1);this.exp=n||e;this.isDesc=t||!1},n;return t.inherit(r,i.ExpressionBase),n=r.prototype,n.clone=function(){return new r(this.exp,this.isDesc)},n.toODataQuery=function(n){var i=u.isFunction(this.exp)?t.funcToLambda(this.exp):this.exp;return this.isDesc&&(i=f(i)),t.jsepToODataQuery(h.jsep(i),n)},n.toBeetleQuery=function(n){if(!this.exp)return"";var i=u.isFunction(this.exp)?t.funcToLambda(this.exp):this.exp;return this.isDesc&&(i=f(i)),t.jsepToBeetleQuery(h.jsep(i),n)},n.execute=function(n,i){var o,r,v,y,e;if(u.isFunction(this.exp))return o=this,n.sort(function(n,t){var i=o.exp(n,t);return o.isDesc?-1*i:i});var s=[],c=h.jsep(this.exp),l=c.type=="Compound"?c.body:[c];for(r=0;r<l.length;r++){var f=!1,p=l[r],a=l[r+1];a&&a.type=="Identifier"&&(v=a.name.toLowerCase(),v=="desc"?(f=!0,r++):v=="asc"&&r++);f=f!=this.isDesc;y=function(n,r){return function(u,f){var e=t.jsepToFunction(n,i),o=e(u),s=e(f);return o==s?0:o>s?r?-1:1:r?1:-1}}(p,f);s.push(y)}return e=[],e.push.apply(e,n),e.sort(function(n,t){for(var r,i=0;i<s.length;i++)if(r=s[i](n,t),r!=0)return r;return 0})},r}(),ExpandExp:function(){var n=function(n){i.ExpressionBase.call(this,"expand",1,!1,!1);this.exp=n},r;return t.inherit(n,i.ExpressionBase),r=n.prototype,r.clone=function(){return new n(this.exp)},r.execute=function(n){return n},n}(),SelectExp:function(){var n=function(n){i.ExpressionBase.call(this,"select",2,!1,!0);this.exp=n},r;return t.inherit(n,i.ExpressionBase),r=n.prototype,r.clone=function(){return new n(this.exp)},r.execute=function(n,i){return u.isFunction(this.exp)?t.mapArray(n,this.exp):t.runSelectExp(n,this.exp,i)},n}(),SkipExp:function(){var r=function(n){i.ExpressionBase.call(this,"skip",2,!1,!1);this.count=n},n;return t.inherit(r,i.ExpressionBase),n=r.prototype,n.toODataQuery=function(){return this.count},n.toBeetleQuery=function(){return this.count},n.clone=function(){return new r(this.count)},n.execute=function(n){return n.slice(this.count)},r}(),TopExp:function(){var r=function(n){i.ExpressionBase.call(this,"top",2,!1,!1);this.count=n},n;return t.inherit(r,i.ExpressionBase),n=r.prototype,n.toODataQuery=function(){return this.count},n.toBeetleQuery=function(){return this.count},n.clone=function(){return new r(this.count)},n.execute=function(n){return n.slice(0,this.count)},r}(),GroupByExp:function(){var n=function(n,t){i.ExpressionBase.call(this,"groupby",3,!0,!0);this.keySelector=n;this.elementSelector=t},r;return t.inherit(n,i.ExpressionBase),r=n.prototype,r.toBeetleQuery=function(n){var i="",r,f;return this.keySelector&&(r=u.isFunction(this.keySelector)?t.funcToLambda(this.keySelector):this.keySelector,i+=t.jsepToBeetleQuery(h.jsep(r),n)),this.elementSelector&&(f=u.isFunction(this.elementSelector)?t.funcToLambda(this.elementSelector):this.elementSelector,i+=";"+t.jsepToBeetleQuery(h.jsep(f),n)),i},r.clone=function(){return new n(this.keySelector,this.elementSelector)},r.execute=function(n,i){var r=[],c,e,f,l,o,a,v,s,y;if(this.keySelector)for(c=u.isFunction(this.keySelector)?t.mapArray(n,this.keySelector):t.runSelectExp(n,this.keySelector,i),e=0;e<c.length;e++){for(f=null,l=c[e],o=0;o<r.length;o++)if(a=r[o],t.objEquals(a.Key,l)){f=a;break}f||(f={Key:l,Items:[]},r.push(f));f.Items.push(n[e])}else r.push({Key:null,Items:n});return this.elementSelector&&(u.isFunction(this.elementSelector)?v=this.elementSelector:(s=h.jsep(this.elementSelector),y=s.type=="Compound"?s.body:[s],v=t.jsepToProjector(y,i)),t.forEach(r,function(n,t){var u=n.Items,i;u.Key=n.Key;i=v(n.Items);r[t]=i})),r},n}(),DistinctExp:function(){function f(n){var i=[];return t.forEach(n,function(n){for(var u=!1,r=0;r<i.length;r++)if(t.objEquals(i[r],n)){u=!0;break}u===!1&&i.push(n)}),i}var n=function(n){i.ExpressionBase.call(this,"distinct",3,!0,!0);this.exp=n},r;return t.inherit(n,i.ExpressionBase),r=n.prototype,r.clone=function(){return new n(this.exp)},r.execute=function(n,i){return this.exp?u.isFunction(this.exp)?f(t.mapArray(n,this.exp)):f(t.runSelectExp(n,this.exp,i)):f(n)},n}(),ReverseExp:function(){var n=function(){i.ExpressionBase.call(this,"reverse",3,!0,!1)},r;return t.inherit(n,i.ExpressionBase),r=n.prototype,r.toBeetleQuery=function(){return""},r.clone=function(){return new n},r.execute=function(n){return n.reverse()},n}(),SelectManyExp:function(){function f(n,t){var i,r,u;if(n.length==0)return n;for(i=[],r=0;r<n.length;r++)u=t(n[r]),i=i.concat.apply(i,u);return i}var n=function(n){i.ExpressionBase.call(this,"selectMany",3,!0,!0);this.exp=n},r;return t.inherit(n,i.ExpressionBase),r=n.prototype,r.clone=function(){return new n(this.exp)},r.execute=function(n,i){return n.length==0?n:u.isFunction(this.exp)?f(n,this.exp):f(n,t.jsepToFunction(h.jsep(this.exp),i))},n}(),SkipWhileExp:function(){var n=function(n,t){i.ExpressionBase.call(this,"skipWhile",3,!0,!1);this.exp=n;this.varContext=t},r;return t.inherit(n,i.ExpressionBase),r=n.prototype,r.clone=function(){return new n(this.exp,this.varContext)},r.execute=function(n,i){for(var f=u.isFunction(this.exp)?this.exp:t.jsepToFunction(h.jsep(this.exp),i),r=0;f(n[r])==!0;)r++;return n.slice(r+1)},n}(),TakeWhileExp:function(){var n=function(n,t){i.ExpressionBase.call(this,"takeWhile",3,!0,!1);this.exp=n;this.varContext=t},r;return t.inherit(n,i.ExpressionBase),r=n.prototype,r.clone=function(){return new n(this.exp,this.varContext)},r.execute=function(n,i){for(var f=u.isFunction(this.exp)?this.exp:t.jsepToFunction(h.jsep(this.exp),i),r=0;f(n[r])==!0;)r++;return n.slice(0,r)},n}(),AllExp:function(){var n=function(n,t){i.ExpressionBase.call(this,"exec;all",3,!0,!0);this.exp=n;this.varContext=t;this.isExecuter=!0},r;return t.inherit(n,i.ExpressionBase),r=n.prototype,r.clone=function(){return new n(this.exp,this.varContext)},r.execute=function(n,i){var r=u.isFunction(this.exp)?this.exp:t.jsepToFunction(h.jsep(this.exp),i);return o.queryFuncs.all.impl(n,function(){return n},r)},n}(),AnyExp:function(){var n=function(n,t){i.ExpressionBase.call(this,"exec;any",3,!0,!0);n&&(this.exp=n);this.varContext=t;this.isExecuter=!0},r;return t.inherit(n,i.ExpressionBase),r=n.prototype,r.clone=function(){return new n(this.exp,this.varContext)},r.execute=function(n,i){if(this.exp){var r=u.isFunction(this.exp)?this.exp:t.jsepToFunction(h.jsep(this.exp),i);return o.queryFuncs.any.impl(n,function(){return n},r)}return n.length>0},n}(),AvgExp:function(){var n=function(n){i.ExpressionBase.call(this,"exec;avg",3,!0,!0);n&&(this.exp=n);this.isExecuter=!0},r;return t.inherit(n,i.ExpressionBase),r=n.prototype,r.clone=function(){return new n(this.exp)},r.execute=function(n,i){var r=this.exp?u.isFunction(this.exp)?this.exp:t.jsepToFunction(h.jsep(this.exp),i):function(n){return n};return o.queryFuncs.avg.impl(n,function(){return n},r)},n}(),MaxExp:function(){var n=function(n){i.ExpressionBase.call(this,"exec;max",3,!0,!0);n&&(this.exp=n);this.isExecuter=!0},r;return t.inherit(n,i.ExpressionBase),r=n.prototype,r.clone=function(){return new n(this.exp)},r.execute=function(n,i){var r=this.exp?u.isFunction(this.exp)?this.exp:t.jsepToFunction(h.jsep(this.exp),i):function(n){return n};return o.queryFuncs.max.impl(n,function(){return n},r)},n}(),MinExp:function(){var n=function(n){i.ExpressionBase.call(this,"exec;min",3,!0,!0);n&&(this.exp=n);this.isExecuter=!0},r;return t.inherit(n,i.ExpressionBase),r=n.prototype,r.clone=function(){return new n(this.exp)},r.execute=function(n,i){var r=this.exp?u.isFunction(this.exp)?this.exp:t.jsepToFunction(h.jsep(this.exp),i):function(n){return n};return o.queryFuncs.min.impl(n,function(){return n},r)},n}(),SumExp:function(){var n=function(n){i.ExpressionBase.call(this,"exec;sum",3,!0,!0);n&&(this.exp=n);this.isExecuter=!0},r;return t.inherit(n,i.ExpressionBase),r=n.prototype,r.clone=function(){return new n(this.exp)},r.execute=function(n,i){var r=this.exp?u.isFunction(this.exp)?this.exp:t.jsepToFunction(h.jsep(this.exp),i):function(n){return n};return o.queryFuncs.sum.impl(n,function(){return n},r)},n}(),CountExp:function(){var n=function(n,t){i.ExpressionBase.call(this,"exec;count",3,!0,!0);n&&(this.exp=n);this.varContext=t;this.isExecuter=!0},r;return t.inherit(n,i.ExpressionBase),r=n.prototype,r.clone=function(){return new n(this.exp,this.varContext)},r.execute=function(n,i){if(this.exp){var r=u.isFunction(this.exp)?this.exp:t.jsepToFunction(h.jsep(this.exp),i);return t.filterArray(n,r).length}return n.length},n}(),FirstExp:function(){var n=function(n,t){i.ExpressionBase.call(this,"exec;first",3,!0,!1);n&&(this.exp=n);this.varContext=t;this.isExecuter=!0},f;return t.inherit(n,i.ExpressionBase),f=n.prototype,f.clone=function(){return new n(this.exp,this.varContext)},f.execute=function(n,i){if(this.exp){var f=u.isFunction(this.exp)?this.exp:t.jsepToFunction(h.jsep(this.exp),i);n=t.filterArray(n,f)}if(n.length==0)throw t.createError(r.arrayEmpty,{array:n,expression:this});return n[0]},n}(),FirstOrDefaultExp:function(){var n=function(n,t){i.ExpressionBase.call(this,"exec;firstOD",3,!0,!1);n&&(this.exp=n);this.varContext=t;this.isExecuter=!0},r;return t.inherit(n,i.ExpressionBase),r=n.prototype,r.clone=function(){return new n(this.exp,this.varContext)},r.execute=function(n,i){if(this.exp){var r=u.isFunction(this.exp)?this.exp:t.jsepToFunction(h.jsep(this.exp),i);n=t.filterArray(n,r)}return n.length==0?null:n[0]},n}(),SingleExp:function(){var n=function(n,t){i.ExpressionBase.call(this,"exec;single",3,!0,!1);n&&(this.exp=n);this.varContext=t;this.isExecuter=!0},f;return t.inherit(n,i.ExpressionBase),f=n.prototype,f.clone=function(){return new n(this.exp,this.varContext)},f.execute=function(n,i){if(this.exp){var f=u.isFunction(this.exp)?this.exp:t.jsepToFunction(h.jsep(this.exp),i);n=t.filterArray(n,f)}if(n.length!=1)throw t.createError(r.arrayNotSingle,{array:n,expression:this});return n[0]},n}(),SingleOrDefaultExp:function(){var n=function(n,t){i.ExpressionBase.call(this,"exec;singleOD",3,!0,!1);n&&(this.exp=n);this.varContext=t;this.isExecuter=!0},f;return t.inherit(n,i.ExpressionBase),f=n.prototype,f.clone=function(){return new n(this.exp,this.varContext)},f.execute=function(n,i){if(this.exp){var f=u.isFunction(this.exp)?this.exp:t.jsepToFunction(h.jsep(this.exp),i);n=t.filterArray(n,f)}if(n.length>1)throw t.createError(r.arrayNotSingleOrEmpty,{array:n,expression:this});return n.length==0?null:n[0]},n}(),LastExp:function(){var n=function(n,t){i.ExpressionBase.call(this,"exec;last",3,!0,!1);n&&(this.exp=n);this.varContext=t;this.isExecuter=!0},f;return t.inherit(n,i.ExpressionBase),f=n.prototype,f.clone=function(){return new n(this.exp,this.varContext)},f.execute=function(n,i){if(this.exp){var f=u.isFunction(this.exp)?this.exp:t.jsepToFunction(h.jsep(this.exp),i);n=t.filterArray(n,f)}if(n.length==0)throw t.createError(r.arrayEmpty,{array:n,expression:this});return n[n.length-1]},n}(),LastOrDefaultExp:function(){var n=function(n,t){i.ExpressionBase.call(this,"exec;lastOD",3,!0,!1);n&&(this.exp=n);this.varContext=t;this.isExecuter=!0},r;return t.inherit(n,i.ExpressionBase),r=n.prototype,r.clone=function(){return new n(this.exp,this.varContext)},r.execute=function(n,i){if(this.exp){var r=u.isFunction(this.exp)?this.exp:t.jsepToFunction(h.jsep(this.exp),i);n=t.filterArray(n,r)}return n.length==0?null:n[n.length-1]},n}()}}(),queryFuncs:function(){var n={};return n.toupper=function(){var n=function(){i.QueryFuncBase.call(this,"toupper","ToUpper",1)},r;return t.inherit(n,i.QueryFuncBase),r=n.prototype,r.impl=function(n,t){return(t?t(n):n).toUpperCase()},new n}(),n.touppercase=n.toupper,n.tolower=function(){var n=function(){i.QueryFuncBase.call(this,"tolower","ToLower",1)},r;return t.inherit(n,i.QueryFuncBase),r=n.prototype,r.impl=function(n,t){return(t?t(n):n).toLowerCase()},new n}(),n.tolowercase=n.tolower,n.substring=function(){var n=function(){i.QueryFuncBase.call(this,"substring","Substring",3)},r;return t.inherit(n,i.QueryFuncBase),r=n.prototype,r.impl=function(n,t,i,r){arguments.length==3?(r=i,i=t,t=n):t=t(n);i=i(n);r=r(n);var u=Number(i)+Number(r);return t&&t.substring(i,u)},new n}(),n.substringof=function(){var n=function(){i.QueryFuncBase.call(this,"substringof","Contains",2)},r;return t.inherit(n,i.QueryFuncBase),r=n.prototype,r.toBeetleFunction=function(n,t){return t=t?t+".":"",t+"Contains("+n+")"},r.impl=function(n,i,r){return r=r?r(n):n,r=t.handleStrOptions(r,this.varContext),i=t.handleStrOptions(i(n),this.varContext),r&&r.indexOf(i)>=0},new n}(),n.length=function(){var n=function(){i.QueryFuncBase.call(this,"length","Length",1)},r;return t.inherit(n,i.QueryFuncBase),r=n.prototype,r.toBeetleFunction=function(n){return n=n?n+".":"",n+"Length"},r.impl=function(n,t){return(t?t(n):n).length},new n}(),n.trim=function(){var n=function(){i.QueryFuncBase.call(this,"trim","Trim",1)},r;return t.inherit(n,i.QueryFuncBase),r=n.prototype,r.impl=function(n,t){return(t?t(n):n).trim()},new n}(),n.concat=function(){var n=function(){i.QueryFuncBase.call(this,"concat","Concat",null)},r;return t.inherit(n,i.QueryFuncBase),r=n.prototype,r.toBeetleFunction=function(){return"string.Concat("+Array.prototype.slice.call(arguments).join(", ")+")"},r.impl=function(n){for(var i=arguments[1](n).toString(),r=Array.prototype.slice.call(arguments,2),u=[],t=0;t<r.length;t++)u.push(r[t](n));return i.concat.apply(i,u)},new n}(),n.replace=function(){var n=function(){i.QueryFuncBase.call(this,"replace","Replace",3)},r;return t.inherit(n,i.QueryFuncBase),r=n.prototype,r.impl=function(n,i,r,u){return arguments.length==3?(u=r,r=i,i=n):i=i(n),r=r(n),t.ignoreWhiteSpaces(this.varContext)&&(r=r.trim()),t.isCaseSensitive(this.varContext)||(r=new RegExp(r,"gi")),i.replace(r,u(n))},new n}(),n.startswith=function(){var n=function(){i.QueryFuncBase.call(this,"startswith","StartsWith",2)},r;return t.inherit(n,i.QueryFuncBase),r=n.prototype,r.impl=function(n,i,r){return arguments.length==2?(r=i,i=n):i=i(n),i=t.handleStrOptions(i,this.varContext),r=t.handleStrOptions(r(n),this.varContext),i&&i.indexOf(r,0)===0},new n}(),n.endswith=function(){var n=function(){i.QueryFuncBase.call(this,"endswith","EndsWith",2)},r;return t.inherit(n,i.QueryFuncBase),r=n.prototype,r.impl=function(n,i,r){arguments.length==2?(r=i,i=n):i=i(n);i=t.handleStrOptions(i,this.varContext);r=t.handleStrOptions(r(n),this.varContext);var u=i.length-r.length;return i&&i.indexOf(r,u)!==-1},new n}(),n.indexof=function(){var n=function(){i.QueryFuncBase.call(this,"indexof","IndexOf",2)},r;return t.inherit(n,i.QueryFuncBase),r=n.prototype,r.impl=function(n,i,r){return arguments.length==2?(r=i,i=n):i=i(n),i=t.handleStrOptions(i,this.varContext),r=t.handleStrOptions(r(n),this.varContext),i&&i.indexOf(r)},new n}(),n.contains=function(){var f=function(){i.QueryFuncBase.call(this,"contains","Contains",2)},r;return t.inherit(f,i.QueryFuncBase),r=f.prototype,r.toODataFunction=function(i,r){if(u.isTypeOf(i,"string"))return n.substringof.toODataFunction(r,i);var f=[];return t.forEach(i,function(n){f.push(r+" eq "+e.dataTypes.toODataValue(n))}),"("+f.join(" or ")+")"},r.toBeetleFunction=function(i,r){if(u.isTypeOf(i,"string"))return n.substringof.toBeetleFunction(r,i);var f=[];return t.forEach(i,function(n){f.push(r+" == "+e.dataTypes.toBeetleValue(n))}),"("+f.join(" || ")+")"},r.impl=function(n,i,r){var f,e;if(arguments.length==1?i=n:arguments.length==2?(r=i,i=n):i=i(n),r=r?r(n):n,u.isArray(i)){for(f=0;f<i.length;f++)if(e=i[f],e==r)return!0;return!1}return i=t.handleStrOptions(i,this.varContext),r=t.handleStrOptions(r,this.varContext),i&&i.indexOf(r)>=0},new f}(),n.round=function(){var n=function(){i.QueryFuncBase.call(this,"round","Math.Round",1)},r;return t.inherit(n,i.QueryFuncBase),r=n.prototype,r.toBeetleFunction=function(n){return"Math.Round("+n+")"},r.impl=function(n,t){return Math.round(t?t(n):n)},new n}(),n.ceiling=function(){var n=function(){i.QueryFuncBase.call(this,"ceiling","Math.Ceiling(%1)",1)},r;return t.inherit(n,i.QueryFuncBase),r=n.prototype,r.toBeetleFunction=function(n){return"Math.Ceiling("+n+")"},r.impl=function(n,t){return Math.ceil(t?t(n):n)},new n}(),n.floor=function(){var n=function(){i.QueryFuncBase.call(this,"floor","Math.Floor",1)},r;return t.inherit(n,i.QueryFuncBase),r=n.prototype,r.toBeetleFunction=function(n){return"Math.Floor("+n+")"},r.impl=function(n,t){return Math.floor(t?t(n):n)},new n}(),n.second=function(){var n=function(){i.QueryFuncBase.call(this,"second","Second",1)},r;return t.inherit(n,i.QueryFuncBase),r=n.prototype,r.toBeetleFunction=function(n){return n=n?n+".":"",n+"Second"},r.impl=function(n,t){return t=e.dataTypes.date.handle(t?t(n):n),t.getSeconds()},new n}(),n.getseconds=n.second,n.minute=function(){var n=function(){i.QueryFuncBase.call(this,"minute","Minute",1)},r;return t.inherit(n,i.QueryFuncBase),r=n.prototype,r.toBeetleFunction=function(n){return n=n?n+".":"",n+"Minute"},r.impl=function(n,t){return t=e.dataTypes.date.handle(t?t(n):n),t.getMinutes()},new n}(),n.getminutes=n.minute,n.hour=function(){var n=function(){i.QueryFuncBase.call(this,"hour","Hour",1)},r;return t.inherit(n,i.QueryFuncBase),r=n.prototype,r.toBeetleFunction=function(n){return n=n?n+".":"",n+"Hour"},r.impl=function(n,t){return t=e.dataTypes.date.handle(t?t(n):n),t.getHours()},new n}(),n.gethours=n.hour,n.day=function(){var n=function(){i.QueryFuncBase.call(this,"day","Day",1)},r;return t.inherit(n,i.QueryFuncBase),r=n.prototype,r.toBeetleFunction=function(n){return n=n?n+".":"",n+"Day"},r.impl=function(n,t){return t=e.dataTypes.date.handle(t?t(n):n),t.getDate()},new n}(),n.getdate=n.day,n.month=function(){var n=function(){i.QueryFuncBase.call(this,"month","Month",1)},r;return t.inherit(n,i.QueryFuncBase),r=n.prototype,r.toBeetleFunction=function(n){return n=n?n+".":"",n+"Month"},r.impl=function(n,t){return t=e.dataTypes.date.handle(t?t(n):n),t.getMonth()+1},new n}(),n.getmonth=n.month,n.year=function(){var n=function(){i.QueryFuncBase.call(this,"year","Year",1)},r;return t.inherit(n,i.QueryFuncBase),r=n.prototype,r.toBeetleFunction=function(n){return n=n?n+".":"",n+"Year"},r.impl=function(n,t){return t=e.dataTypes.date.handle(t?t(n):n),t.getFullYear()},new n}(),n.getfullyear=n.year,n.max=function(){var n=function(){i.QueryFuncBase.call(this,"max","Max",2)},u;return t.inherit(n,i.QueryFuncBase),u=n.prototype,u.toODataFunction=function(){throw t.createError(r.functionNotSupportedForOData,["Max"]);},u.impl=function(n,t,i){var u,r,f;if(arguments.length==1?t=n:arguments.length==2?(i=t,t=n):t=t(n),t.length==0)return null;for(u=i?i(t[0]):t[0],r=1;r<t.length;r++)f=i?i(t[r]):t[r],f>u&&(u=f);return u},new n}(),n.min=function(){var n=function(){i.QueryFuncBase.call(this,"min","Min",2)},u;return t.inherit(n,i.QueryFuncBase),u=n.prototype,u.toODataFunction=function(){throw t.createError(r.functionNotSupportedForOData,["Min"]);},u.impl=function(n,t,i){var u,r,f;if(arguments.length==1?t=n:arguments.length==2?(i=t,t=n):t=t(n),t.length==0)return null;for(u=i?i(t[0]):t[0],r=1;r<t.length;r++)f=i?i(t[r]):t[r],f<u&&(u=f);return u},new n}(),n.sum=function(){var n=function(){i.QueryFuncBase.call(this,"sum","Sum",2)},u;return t.inherit(n,i.QueryFuncBase),u=n.prototype,u.toODataFunction=function(){throw t.createError(r.functionNotSupportedForOData,["Sum"]);},u.impl=function(n,t,i){var u,r,f;for(arguments.length==1?t=n:arguments.length==2?(i=t,t=n):t=t(n),u=0,r=0;r<t.length;r++)f=t[r],u+=i?i(f):f;return u},new n}(),n.count=function(){var n=function(){i.QueryFuncBase.call(this,"count","Count",1)},u;return t.inherit(n,i.QueryFuncBase),u=n.prototype,u.toODataFunction=function(){throw t.createError(r.functionNotSupportedForOData,["Count"]);},u.impl=function(n,t){return(t?t(n):n).length},new n}(),n.avg=function(){var u=function(){i.QueryFuncBase.call(this,"avg","Average",2)},f;return t.inherit(u,i.QueryFuncBase),f=u.prototype,f.toODataFunction=function(){throw t.createError(r.functionNotSupportedForOData,["Avg"]);},f.impl=function(t,i,r){return(arguments.length==1?i=t:arguments.length==2?(r=i,i=t):i=i(t),i.length==0)?null:n.sum.impl(t,function(){return i},r)/i.length},new u}(),n.any=function(){var n=function(){i.QueryFuncBase.call(this,"any","Any",2);this.needsAlias=!0},r;return t.inherit(n,i.QueryFuncBase),r=n.prototype,r.toODataFunction=function(n,t,i){return t+"/any("+n+": "+i+")"},r.impl=function(n,t,i){var r,u;if(arguments.length==1?t=n:arguments.length==2?(i=t,t=n):t=t(n),!i)return t.length>0;for(r=0;r<t.length;r++)if(u=t[r],i(u)===!0)return!0;return!1},new n}(),n.all=function(){var n=function(){i.QueryFuncBase.call(this,"all","All",2);this.needsAlias=!0},r;return t.inherit(n,i.QueryFuncBase),r=n.prototype,r.toODataFunction=function(n,t,i){return t+"/all("+n+": "+i+")"},r.impl=function(n,t,i){var r,u;for(arguments.length==1?t=n:arguments.length==2?(i=t,t=n):t=t(n),r=0;r<t.length;r++)if(u=t[r],i(u)!==!0)return!1;return!0},new n}(),n.getFunc=function(i,u){var f=n[i.toLowerCase()];if(f==null&&u!==!1)throw t.createError(r.unknownFunction,[i]);return f},n}(),ArrayQuery:function(){var r,n;return Array.prototype.asQueryable=function(){return new o.ArrayQuery(this)},Array.hasOwnProperty("q")||(Array.prototype.q=function(){return this.asQueryable()}),r=function(n){this.array=n;i.QueryBase.call(this)},t.inherit(r,i.QueryBase),n=r.prototype,n.executeAfterExecuter=!0,n.execute=function(n){return this.options&&(n=t.combine(this.options.varContext,n)),this.toFunction()(this.array,n)},n.clone=function(){var n=new o.ArrayQuery(this.array);return this.copy(n),n},n.copy=function(n){i.QueryBase.prototype.copy.call(this,n)},r}(),EntityQuery:function(){function e(n,i){if(n==null)return null;if(u.isTypeOf(n,"string")){if(i==null)throw t.createError(r.onlyManagerCreatedCanAcceptEntityShortName);return i.getEntityType(n,!0)}return t.assertPrm(n,"type").isInstanceOf(l.EntityType).check(),n}var f=function(n,t,r){this.resource=n;this.entityType=e(t,r);this.manager=r;this.liveValidate=r&&r.liveValidate;this.parameters=[];i.QueryBase.call(this)},n;return t.inherit(f,i.QueryBase),n=f.prototype,n.toString=function(){var n=[];return n.push("resource: ("+this.resource+")"),this.entityType&&n.push("entityType: ("+this.entityType.shortName+")"),this.manager&&n.push("manager: ("+this.manager.toString()+")"),n.push(i.QueryBase.prototype.toString.call(this)),n.join(", ")},n.expand=function(n){var t=this.clone();return t.addExpression(new o.expressions.ExpandExp(n))},n.include=function(){return this.expand.apply(this,arguments)},n.setParameter=function(n,i){var r=this.clone(),u=t.findInArray(r.parameters,n,"name");return u?u.value=i:r.parameters.push({name:n,value:i}),r},n.setEntityType=function(n){n=e(n,this.manager);var t=this.clone();return t.entityType=n,t},n.execute=function(n,i,u){if(!this.manager)throw t.createError(r.onlyManagerCreatedCanBeExecuted,{query:this,options:n});return this.manager.executeQuery(this,n,i,u)},n.executeLocally=function(n){if(!this.manager)throw t.createError(r.onlyManagerCreatedCanBeExecuted,{query:this,options:options});return this.manager.executeQueryLocally(this,n)},n.clone=function(){var n=new o.EntityQuery(this.resource,this.entityType,this.manager);return this.copy(n),n},n.copy=function(n){i.QueryBase.prototype.copy.call(this,n);t.forEach(this.parameters,function(t){n.parameters.push(t)})},f}()}}(),e=function(){return{ValueNotifyWrapper:function(){return function(n,i){this.value=n;this.fromBeetle=i===!0;t.tryFreeze(this)}}(),Event:function(){var i=function(n,t){this.name=n;this.subscribers=[];this.publisher=t},n=i.prototype;return n.toString=function(){return this.name},n.subscribe=function(n){t.findInArray(this.subscribers,n)||this.subscribers.push(n)},n.unsubscribe=function(n){t.removeFromArray(this.subscribers,n)},n.notify=function(){var n=arguments;t.forEach(this.subscribers,function(t){t.apply(t,n)})},i}(),dataTypes:function(){function f(n,i){throw t.createError(r.assignError,[n.name,i],{dataType:n,value:i});}var e=function(){var r=function(n){i.DataTypeBase.call(this,"dateBase");this.name=n},n;return t.inherit(r,i.DataTypeBase),n=r.prototype,n.defaultValue=function(){return new Date(Date.UTC(1753,1,1))},n.isValid=function(n){return Object.prototype.toString.call(n)==="[object Date]"},n.handle=function(n){if(!this.isValid(n)){var t=n;n=this.tryParse(t);n||f(this,t)}return n},n.autoValue=function(){return new Date},n.getRawValue=function(n){return n==null?null:s.getDateConverter().toISOString(n)},n.tryParse=function(n){return s.getDateConverter().parse(n)},n.toODataValue=function(n){return n=this.handle(n),"datetime'"+s.getDateConverter().toISOString(n)+"'"},n.toBeetleValue=function(n){return n=this.handle(n),'"'+s.getDateConverter().toISOString(n)+'"'},r}(),n={};return n.object=function(){var n=function(){i.DataTypeBase.call(this,"object");t.tryFreeze(this)},r;return t.inherit(n,i.DataTypeBase),r=n.prototype,r.toODataValue=function(n){return n},r.toBeetleValue=function(n){return n},new n}(),n.array=function(){var u=function(){i.DataTypeBase.call(this,"array");t.tryFreeze(this)},n;return t.inherit(u,i.DataTypeBase),n=u.prototype,n.isValid=function(n){return n instanceof Array},n.defaultValue=function(){return[]},n.handle=function(n){return this.isValid(n)||(n=n.split(",")),n},n.autoValue=function(){throw t.createError(r.notImplemented,[this.name,"defaultValue"]);},n.toODataValue=function(n){return n},n.toBeetleValue=function(n){return n},new u}(),n.func=function(){var n=function(){i.DataTypeBase.call(this,"function");t.tryFreeze(this)};return t.inherit(n,i.DataTypeBase),new n}(),n.string=function(){var u=0,r=function(){i.DataTypeBase.call(this,"string");t.tryFreeze(this)},n;return t.inherit(r,i.DataTypeBase),n=r.prototype,n.defaultValue=function(){return""},n.handle=function(n){return this.isValid(n)||(n=n.toString()),n},n.autoValue=function(){return"key_"+--u},n.toODataValue=function(n){return"'"+n.replace(/'/g,"''")+"'"},n.toBeetleValue=function(n){return'"'+n.replace(/"/g,'""')+'"'},new r}(),n.guid=function(){var r=function(){i.DataTypeBase.call(this,"guid");t.tryFreeze(this)},n;return t.inherit(r,i.DataTypeBase),n=r.prototype,n.defaultValue=function(){return"00000000-0000-0000-0000-000000000000"},n.isValid=function(n){return typeof n=="string"&&n.match(/^\{?[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}\}?$/i)},n.handle=function(n){return this.isValid(n)||f(this,n),n},n.autoValue=function(){return t.createGuid()},n.toODataValue=function(n){return"guid'"+n+"'"},n.toBeetleValue=function(n){return'"'+n+'"'},new r}(),n.date=function(){var n=function(){e.call(this,"date");t.tryFreeze(this)};return t.inherit(n,e),new n}(),n.dateTimeOffset=function(){var n=function(){e.call(this,"dateTimeOffset");t.tryFreeze(this)},i;return t.inherit(n,e),i=n.prototype,i.toODataValue=function(n){return n=this.handle(n),"datetimeoffset'"+s.getDateConverter().toISOString(n)+"'"},new n}(),n.time=function(){var r=function(){i.DataTypeBase.call(this,"time");t.tryFreeze(this)},n;return t.inherit(r,i.DataTypeBase),n=r.prototype,n.defaultValue=function(){return"00:00:00"},n.isValid=function(n){return/^([01]?\d|2[0-3])(((:[0-5]?\d){2}(\.\d{1,3}){0,1})|(:[0-5]?\d){0,2})?$/.test(n)},n.handle=function(n){return this.isValid(n)||f(this,n),n},n.autoValue=function(){return"00:00:00"},n.toODataValue=function(n){return"time'"+n+"'"},n.toBeetleValue=function(n){return'"'+n+'"'},new r}(),n.boolean=function(){var r=function(){i.DataTypeBase.call(this,"boolean");t.tryFreeze(this)},u;return t.inherit(r,i.DataTypeBase),u=r.prototype,u.defaultValue=function(){return!1},u.handle=function(t){if(!this.isValid(t)){if(n.string.isValid(t)){var i=t.toLowerCase();if(i=="true"||i=="1")return!0;if(i=="false"||i=="0")return!1}throw f(this,t);}return t},new r}(),n.int=function(){var u=0,r=function(){i.DataTypeBase.call(this,"int");t.tryFreeze(this)},n;return t.inherit(r,i.DataTypeBase),n=r.prototype,n.defaultValue=function(){return 0},n.isValid=function(n){return typeof n=="number"&&n%1==0},n.handle=function(n){var t=n;return typeof n!="number"&&(n=Number(n)),this.isValid(n)||f(this,t),n},n.autoValue=function(){return--u},new r}(),n.number=function(){var u=0,r=function(){i.DataTypeBase.call(this,"number");t.tryFreeze(this)},n;return t.inherit(r,i.DataTypeBase),n=r.prototype,n.defaultValue=function(){return 0},n.isValid=function(n){return!isNaN(n)&&typeof n=="number"},n.handle=function(n){var t=n;return typeof n!="number"&&(n=Number(n)),this.isValid(n)||f(this,t),n},n.autoValue=function(){return--u},new r}(),n.byte=function(){var u=0,r=function(){i.DataTypeBase.call(this,"byte");t.tryFreeze(this)},n;return t.inherit(r,i.DataTypeBase),n=r.prototype,n.defaultValue=function(){return 0},n.isValid=function(n){return typeof n=="number"&&n%1==0&&n>=0&&n<256},n.handle=function(n){var t=n;return typeof n!="number"&&(n=Number(n)),this.isValid(n)||f(this,t),n},n.autoValue=function(){return--u},new r}(),n.binary=function(){var r=function(){i.DataTypeBase.call(this,"binary");t.tryFreeze(this)},n;return t.inherit(r,i.DataTypeBase),n=r.prototype,n.defaultValue=function(){return'"AAAAAAAAAAA="'},n.isValid=function(){return!0},n.handle=function(n){return n},n.toODataValue=function(n){return n=this.handle(n),"X'"+s.getDateConverter().toISOString(n)+"'"},n.toBeetleValue=function(n){return'"'+n+'"'},new r}(),n.enumeration=function(){function e(n,i){var f,e,o,r,s;if(u.isArray(n))return f=0,t.forEach(n,function(n){f|=n.value}),f;if(e=Number(n),isNaN(e)||(n=e),u.isTypeOf(n,"string")){for(o=n.split(","),n=0,r=0;r<o.length;r++)if(s=i[o[r]],s!=null)n|=s.value;else return null;return n}return u.isTypeOf(n,"number")?n:u.isEnum(n,i)?n.value:null}var f=function(n,r,u){i.DataTypeBase.call(this,"enum");this.enumType=n;this.enumTypeName=r;this.displayName=u||r;t.tryFreeze(this)},n;return t.inherit(f,i.DataTypeBase),n=f.prototype,n.defaultValue=function(){return 0},n.isValid=function(n){return e(n,this.enumType)!=null},n.handle=function(n){var i=e(n,this.enumType);if(i==null)throw t.createError(r.invalidEnumValue,[n,this.enumTypeName],{enumType:this.enumType,value:n});return i},n.getRawValue=function(n){return u.isEnum(n,this.enumType)?n.value:n},n.toODataValue=function(n){return this.getRawValue(n)},n.toBeetleValue=function(n){return this.getRawValue(n)},f}(),n.geometry=function(){var r=function(){i.DataTypeBase.call(this,"geometry");this.isComplex=!0;t.tryFreeze(this)},n;return t.inherit(r,i.DataTypeBase),n=r.prototype,n.defaultValue=function(){return{$type:"System.Data.Spatial.DbGeometry",CoordinateSystemId:null,WellKnownText:"",WellKnownBinary:null}},n.isValid=function(n){return n.$tracker&&n.$tracker.getValue("WellKnownText")},n.handle=function(n){return n.$tracker&&(n.$tracker.entityType.isComplexType=!0),n},new r}(),n.geography=function(){var r=function(){i.DataTypeBase.call(this,"geography");this.isComplex=!0;t.tryFreeze(this)},n;return t.inherit(r,i.DataTypeBase),n=r.prototype,n.defaultValue=function(){return{$type:"System.Data.Spatial.DbGeography",CoordinateSystemId:null,WellKnownText:"",WellKnownBinary:null}},n.isValid=function(n){return n.$tracker&&n.$tracker.getValue("WellKnownText")},n.handle=function(n){return n.$tracker&&(n.$tracker.entityType.isComplexType=!0),n},new r}(),n.byName=function(i){var u=n[i];if(!u)throw t.createError(r.unknownDataType,[i]);return u},n.byValue=function(t){return n.string.isValid(t)?n.guid.isValid(t)?n.guid:n.date.tryParse(t)?n.date:n.string:n.date.isValid(t)?n.date:n.boolean.isValid(t)?n.boolean:n.int.isValid(t)?n.int:n.number.isValid(t)?n.number:n.array.isValid(t)?n.array:u.isObject(t)?n.object:n.binary},n.handle=function(t){var i=n.date.tryParse(t);return i!=null?i:t},n.toODataValue=function(t){return t==null?"null":n.byValue(t).toODataValue(t)},n.toBeetleValue=function(t){return t==null?"null":n.byValue(t).toBeetleValue(t)},n}(),Validator:function(){function i(i,u,f,e){var o=function(n){return n==null?!1:u.test(n)};return f=t.formatString(f||r.invalidValue,e),new n(i,o,f,{pattern:u})}var n=function(n,i,r,u){this.name=n;this.func=i;this.message=r;this.args=u;t.tryFreeze(this)},f=n.prototype;return f.toString=function(){var n=[],t;if(this.args)for(t in this.args)n.push(t+": "+this.args[t]);return n.length>0?this.name+" ("+n.join(", ")+")":this.name},f.validate=function(n,t){return this.func(n,t)==!0?null:this.message},n.byCode=function(i,u,f,e,o,h){var c=s.getLocalizeFunction();c&&(f=e&&c(e)||f,o=h&&c(h)||o);u=u||[];u.push(f);u.push(o);switch(i){case"re":return n.required.apply(null,u);case"sl":return n.stringLength.apply(null,u);case"ma":return n.maxLength.apply(null,u);case"mi":return n.minLength.apply(null,u);case"ra":return n.range.apply(null,u);case"rx":return n.regularExpression.apply(null,u);case"ea":return n.emailAddress.apply(null,u);case"cc":return n.creditCard.apply(null,u);case"ur":return n.url.apply(null,u);case"ph":return n.phone.apply(null,u);case"po":return n.postalCode.apply(null,u);case"ti":return n.time.apply(null,u);case"co":return n.compare.apply(null,u);default:throw t.createError(r.unknownValidator,[i]);}},n.required=function(i,f,e){var o=function(n){return n==null?!1:u.isTypeOf(n,"string")&&!i&&n==""?!1:!0};return f=t.formatString(f||r.requiredError,e),new n("Required",o,f,{allowEmptyStrings:i})},n.stringLength=function(i,f,e,o){var s=function(n){return!i&&!f?!0:u.isNotEmptyString(n)?i&&n.length<i?!1:f&&n.length>f?!1:!0:!1};return e=t.formatString(e||r.stringLengthError,o,i,f),new n("StringLength",s,e,{min:i,max:f})},n.maxLength=function(i,u,f){var e=function(n){return n==null?!0:i&&n.length>i?!1:!0};return u=t.formatString(u||r.maxLenError,f,i),new n("MaxLength",e,u,{length:i})},n.minLength=function(i,u,f){var e=function(n){return n==null?!1:i&&n.length<i?!1:!0};return u=t.formatString(u||r.minLenError,f,i),new n("MinLength",e,u,{length:i})},n.range=function(i,u,f,e){var o=function(n){return!i&&!u?!0:i&&n<i?!1:u&&n>u?!1:!0};return f=t.formatString(f||r.rangeError,e,i,u),new n("Range",o,f,{min:i,max:u})},n.regularExpression=function(n,t,r){return u.isTypeOf(n,"string")&&(n=new RegExp(n)),i("RegularExpression",n,t,r)},n.emailAddress=function(n,t){return i("EmailAddress",/^\w+@[a-zA-Z_]+?\.[a-zA-Z]{2,3}$/,n,t)},n.creditCard=function(n,t){return i("CreditCard",/^((4\d{3})|(5[1-5]\d{2})|(6011)|(3[68]\d{2})|(30[012345]\d))[ -]?(\d{4})[ -]?(\d{4})[ -]?(\d{4}|3[4,7]\d{13})$/,n,t)},n.url=function(n,t){return i("Url",/(http|ftp|https):\/\/[\w-]+(\.[\w-]+)+([\w.,@?^=%&amp;:\/~+#-]*[\w@?^=%&amp;\/~+#-])?/,n,t)},n.phone=function(n,t){return i("Phone",/^(?!.*-.*-.*-)(?=(?:\d{8,10}$)|(?:(?=.{9,11}$)[^-]*-[^-]*$)|(?:(?=.{10,12}$)[^-]*-[^-]*-[^-]*$)  )[\d-]+$/,n,t)},n.postalCode=function(n,t){return i("PostalCode",/^\d{5}([\-]?\d{4})?$/,n,t)},n.time=function(n,t){return i("Time",/^([01]?\d|2[0-3])(((:[0-5]?\d){2}(\.\d{1,3}){0,1})|(:[0-5]?\d){0,2})?$/,n,t)},n.compare=function(i,u,f){var o=function(n,r){var u=t.getValue(r,i);return n==u},e=s.getLocalizeFunction(),h=e&&e(i)||i;return u=t.formatString(u||r.compareError,f,h),new n("Compare",o,u,{property:i})},n}(),EntityContainer:function(){function r(n,t){var i=new u(n);return t.push(i),i}var u=function(){function u(n,t){var i=r(n,t);return i>-1?t[i]:null}function r(n,t){var f=t.length,r,u,i;if(f>0)for(r=0,u=f-1;r<=u;){if(i=Math.floor((r+u)/2),t[i].key<n){r=i+1;continue}if(t[i].key>n){u=i-1;continue}return i}return-1}function f(n,t){for(var i=0;i<t.length&&n>t[i].key;)i++;return i}var i=function(n){this.typeName=n.name;this.keyIndex=[];t.tryFreeze(this)},n=i.prototype;return n.toString=function(){return this.typeName+": "+this.keyIndex.length},n.push=function(n,t){var i=f(n,this.keyIndex);this.keyIndex.splice(i,0,{key:n,entity:t})},n.remove=function(n){var t=r(n,this.keyIndex);this.keyIndex.splice(t,1)},n.getEntity=function(n){var t=u(n,this.keyIndex);return t?t.entity:null},n.getRelations=function(n,t){for(var r,u=[],i=0;i<this.keyIndex.length;i++)r=this.keyIndex[i],r.entity.$tracker.foreignKey(t)===n&&u.push(r.entity);return u},n.relocateKey=function(n,t,i){this.remove(t);i&&this.push(i,n)},n.getEntities=function(){var n=[];return t.forEach(this.keyIndex,function(t){n.push(t.entity)}),n},i}(),i=function(){this.entitySets=[];this.allEntities=[];t.tryFreeze(this)},n=i.prototype;return n.toString=function(){return this.allEntities.length},n.push=function(n){var u;this.allEntities.push(n);var i=n.$tracker,t=i.entityType,r=i.key;if(r)while(t)u=this.getEntitySet(t),u.push(r,n),t=t.baseType},n.remove=function(n){var r;t.removeFromArray(this.allEntities,n);var u=n.$tracker,i=u.entityType,f=u.key;if(f)while(i)r=this.findEntitySet(i),r&&(r.remove(f),i=i.baseType)},n.getEntities=function(){return this.allEntities},n.getEntityByKey=function(n,t){if(!n)return null;var i=this.findEntitySet(t);return i?i.getEntity(n):null},n.getRelations=function(n,t){var u=t.entityType,r=n.$tracker.key,i;return r?(i=this.findEntitySet(u),i)?i.getRelations(r,t):null:null},n.relocateKey=function(n,t,i){for(var u=n.$tracker.entityType,f;u;)f=this.findEntitySet(u),f?f.relocateKey(n,t,i):(f=r(u,this.entitySets),f.push(i,n)),u=u.baseType},n.getChanges=function(){return t.filterArray(this.allEntities,function(n){return!(n.$tracker.entityType.isComplexType&&n.$tracker.owners.length>0)&&n.$tracker.isChanged()})},n.count=function(){return this.allEntities.length},n.findEntitySet=function(n){return t.findInArray(this.entitySets,n.name,"typeName")},n.getEntitySet=function(n){var t=this.findEntitySet(n);return t||(t=r(n,this.entitySets)),t},i}(),EntitySet:function(){function u(n,i){var f,u,e;if(n==null)throw t.createError(r.cannotCheckInstanceOnNull);if(f=i.entityType,!f.isAssignableWith(n)&&(u=n.$tracker&&n.$tracker.entityType,e=u&&u.shortName||"Object",!u||!f.isAssignableWith(u)))throw t.createError(r.typeError,[e,f.shortName]);}var i=function(n,t){this.local=t.entities.getEntitySet(n);o.EntityQuery.call(this,n.setName,n,t)},n;return t.inherit(i,o.EntityQuery),n=i.prototype,n.toString=function(){return"EntitySet: "+this.entityType.shortName},n.create=function(n){var t=this.entityType.createEntity(n);return this.manager.addEntity(t),t},n.createDetached=function(n){return this.entityType.createEntity(n)},n.createRaw=function(n){return this.entityType.createRawEntity(n)},n.add=function(n){u(n,this);this.manager.addEntity(n)},n.attach=function(n){u(n,this);this.manager.attachEntity(n)},n.remove=function(n){u(n,this);this.manager.deleteEntity(n)},i}(),EntityTracker:function(){function w(n,t,i,r){r.entity=n;n.$tracker=r;r.entityType=t;r.entityState=f.entityStates.Detached;r.observableProvider=i;r.forceUpdate=!1;r.originalValues=[];r.changedValues=[];r.manager=null;r.owners=[];r.validationErrors=[];r.validationErrorsChanged=new e.Event("validationErrorsChanged",r);r.entityStateChanged=new e.Event("entityStateChanged",r);r.propertyChanged=new e.Event("propertyChanged",r);r.arrayChanged=new e.Event("arrayChanged",r);t.hasMetadata&&(r.key=a(r))}function b(n,t,i){var r={propertyChange:k,arrayChange:d,dataPropertyChange:g,scalarNavigationPropertyChange:nt,pluralNavigationPropertyChange:tt,arraySet:it};return i.observableProvider.toObservable(n,t,r)}function l(n,t){n.baseType&&l(n.baseType,t);n.initializer&&n.initializer.call(t,t)}function a(n,t,i){var e=n.entityType,o,r,u,f;if(e.keys.length==0)return null;for(o=[],r=0;r<e.keys.length;r++)u=e.keys[r],f=u===t?i:n.getValue(u.name),u.dataType.name=="guid"&&(f=f.toLowerCase()),o.push(f);return o.join(",")}function v(n,i,u,f){if(!n)throw t.createError(r.propertyNotFound,[i],{propertyName:i,entity:f.entity,manager:f.manager});var e=n.entityType.createQuery(u,f.manager);return n.isScalar?t.forEach(n.foreignKeys,function(t,i){var r=n.entityType.keys[i],u=f.getValue(t.name);e=e.where(r.name+" == @0",[u])}):t.forEach(n.foreignKeyNames,function(n,t){var i=f.getValue(f.entityType.keys[t]);e=e.where(n+" == @0",[i])}),e}function k(n,t,r,f){var l=!1,h,o,c;(u.isInstanceOf(f,e.ValueNotifyWrapper)&&(l=!f.fromBeetle,f=f.value),h=r(),h!==f)&&(o=n.$tracker,o.manager&&(c=o.manager.handleUnmappedProperties),c==null&&(c=s.handleUnmappedProperties),c!==!0||(f=e.dataTypes.handle(f),h!==f))&&(r(f),o.manager&&i(n,t,h,o),l||o.propertyChanged.notify({entity:n,property:t,oldValue:h,newValue:f}))}function d(n,t,r,u,f){var e=n.$tracker;e.manager&&i(n,null,null,e);e.arrayChanged.notify({entity:n,property:t,items:r,removedItems:u,addedItems:f})}function g(n,f,h,c){var it=!1,nt=!1,v,k,y,w,b,g,d;if((u.isInstanceOf(c,e.ValueNotifyWrapper)&&(it=c.fromBeetle,nt=!c.fromBeetle,c=c.value),v=h(),v!==c)&&(c=f.handle(c),v!==c)&&(f.dataType!==e.dataTypes.date&&f.dataType!==e.dataTypes.dateTimeOffset||v==null||c==null||v.valueOf()!==c.valueOf())){var l=n.$tracker,tt=null,p=null;if(f.isKeyPart){if(tt=l.key,p=a(l,f,c),l.manager&&(k=l.manager.getEntityByKey(p,l.entityType.floorType),k&&k!==n))throw t.createError(r.sameKeyExists,{key:p,entity:k});l.key=p}if(y=l.liveValidate,l.manager?(i(n,f.name,f.dataType.getRawValue(v),l),y==null&&(y=l.manager.liveValidate)):l.entityType.isComplexType&&t.forEach(l.owners,function(n){i(n.entity,n.property.name+"."+f.name,c,n.entity.$tracker)}),h(c),y==null&&(y=s.liveValidate),y===!0&&o(f.validate(n),l,f),nt||l.propertyChanged.notify({entity:n,property:f,oldValue:v,newValue:c}),f.isKeyPart&&(l.manager&&l.manager.entities.relocateKey(n,tt,p),rt(n)),f.isComplex){for(w=v.$tracker.owners,b=w.length-1;b>=0;b--)g=w[b],g.entity==n&&g.property==f&&w.splice(b,1);w.length==0&&v.$tracker.manager&&v.$tracker.manager.detachEntity(v);c.$tracker.owners.push({entity:n,property:f})}l.manager&&(d=l.manager.autoFixScalar,d==null&&(d=s.autoFixScalar),t.forEach(f.relatedNavigationProperties,function(n){var t,i,r;if(n.isScalar===!0)if(t=l.foreignKey(n),t){if(i=l.getValue(n.name),i&&i.$tracker.key===t)return;r=null;d&&(r=l.manager.getEntityByKey(t,n.entityType));r?l.setValue(n.name,r):i&&l.setValue(n.name,new e.ValueNotifyWrapper(null,!0))}else l.setValue(n.name,null)}))}}function nt(n,f,h,l){var g=!1,nt=!1,a,v,p,b,w,k,y,d;if(u.isInstanceOf(l,e.ValueNotifyWrapper)&&(g=l.fromBeetle,nt=!l.fromBeetle,l=l.value),a=h(),a!==l)if(f.checkAssign(l),h(l),v=n.$tracker,p=v.liveValidate,p==null&&v.manager&&(p=v.manager.liveValidate),p==null&&(p=s.liveValidate),p===!0&&o(f.validate(n),v,f),nt||v.propertyChanged.notify({entity:n,property:f,oldValue:a,newValue:l}),c(l,v.manager),f.isComplex){if(l==null)throw t.createError(r.complexCannotBeNull,[f.displayName],{entity:n,property:f});for(b=a.$tracker.owners,w=b.length-1;w>=0;w--)k=b[w],k.entity==n&&k.property==f&&b.splice(w,1);a.$tracker.owners.length==0&&a.$tracker.manager&&a.$tracker.manager.detachEntity(a);l.$tracker.owners.push({entity:n,property:f});i(n,f.name,l.$tracker.toRaw(),v)}else g||(f.triggerOwnerModify&&f.foreignKeys.length==0&&i(n,null,null,v),t.setForeignKeys(n,f,l)),y=f.inverse,y&&(y.isScalar?(a&&a.$tracker.setValue(y.name,null),l&&l.$tracker.setValue(y.name,n)):(a&&a.$tracker.getValue(y.name).remove(n),l&&(d=l.$tracker.getValue(y.name),t.findInArray(d,n)||d.push(n))))}function tt(n,r,u,f,e){var h=n.$tracker,l=h.liveValidate,a;l==null&&h.manager&&(l=h.manager.liveValidate);l==null&&(l=s.liveValidate);l===!0&&o(r.validate(n),h,r);r.triggerOwnerModify&&i(n,null,null,h);h.arrayChanged.notify({entity:n,property:r,items:u,removedItems:f,addedItems:e});a=r.inverse;a?(f&&t.forEach(f,function(t){t.$tracker.getValue(a.name)==n&&t.$tracker.setValue(a.name,null)}),e&&t.forEach(e,function(t){c(t,h.manager);t.$tracker.setValue(a.name,n)})):(f&&t.forEach(f,function(n){t.setForeignKeys(n,r,null)}),e&&t.forEach(e,function(i){c(i,h.manager);t.setForeignKeys(i,r,n)}))}function it(n,i,u,e){var c,h,o,l;if(u!==e){if(c=s.getArraySetBehaviour(),c==f.arraySetBehaviour.NotAllowed)throw t.createError(r.settingArrayNotAllowed,{entity:n,property:i});if(h=[],o=t.filterArray(e,function(){return!0}),c==f.arraySetBehaviour.Replace?t.forEach(u,function(n){t.findInArray(o,n)?t.removeFromArray(o,n):h.push(n)}):c==f.arraySetBehaviour.Append&&t.forEach(e,function(n){t.findInArray(u,n)&&t.removeFromArray(o,n)}),h.length>0)for(l=h.length-1;l>=0;l--)u.splice(t.indexOf(u,h[l]),1);o.length>0&&u.push.apply(u,o)}}function rt(n){var i=n.$tracker;t.forEach(i.entityType.navigationProperties,function(r){var u,e,f;r.isScalar?(u=r.inverse,u&&u.isScalar&&(e=i.getValue(r.name),e&&t.setForeignKeys(e,u,n))):(f=i.getValue(r.name),f&&f.length>0&&t.forEach(f,function(i){t.setForeignKeys(i,r,n)}))})}function c(n,i){if(n&&i&&!n.$tracker.entityType.isComplexType&&!i.isInManager(n)&&n.$tracker.manager!=i){if(n.$tracker.manager)throw t.createError(r.entityAlreadyBeingTracked,null,{entity:n,manager:i});i.addEntity(n)}}function i(n,r,u,e){var o=e.entityState;o==f.entityStates.Unchanged&&(t.forEach(e.entityType.navigationProperties,function(n){var u=n.inverse,r;u&&u.triggerOwnerModify&&(r=e.getValue(n.name),r&&(n.isScalar?i(r,null,null,r.$tracker):t.forEach(r,function(n){i(n,null,null,n.$tracker)})))}),e.toModified());ut(r,u,e.originalValues,e.changedValues)}function ut(n,i,r,u){var f,e;n!=null&&(i==null||i.$tracker==null||i.$tracker.entityType.isComplexType)&&(f=t.findInArray(r,n,"p"),f||r.push({p:n,v:i}),e=t.findInArray(u,n,"p"),e||u.push({p:n,v:i}))}function o(n,i,r){var u=[],f=r?t.filterArray(i.validationErrors,function(n){return n.property===r}):t.filterArray(i.validationErrors,function(){return!0});t.forEach(f,function(r){t.findInArray(n,r.validator,"validator")?t.removeFromArray(n,r.validator,"validator"):(t.removeFromArray(i.validationErrors,r),u.push(r))});i.validationErrors=i.validationErrors.concat(n);(u.length>0||n.length>0)&&i.validationErrorsChanged.notify({errors:i.validationErrors,added:n,removed:u})}function y(n){if(n.manager==null)throw t.createError(r.entityNotBeingTracked,{entity:entity,manager:n});}var h=function(n,t,i){delete n.$type;delete n.$id;w(n,t,i||s.getObservableProvider(),this);b(n,t,this);l(t,n)},n=h.prototype;return n.toString=function(){return"EntityTracker: "+this.entityType.shortName+", key: "+this.key},n.setManagerInfo=function(n){if(this.manager)throw t.createError(r.entityAlreadyBeingTracked,{otherManager:this.manager});t.assertPrm(n,"manager").isInstanceOf(e.EntityManager).check();this.manager=n},n.isChanged=function(){return this.entityState===f.entityStates.Added||this.entityState===f.entityStates.Deleted||this.entityState===f.entityStates.Modified},n.delete=function(){y(this);this.manager.deleteEntity(this.entity)},n.detach=function(){y(this);this.manager.detachEntity(this.entity)},n.toAdded=function(){if(this.entityState!=f.entityStates.Added){var n={entity:this.entity,oldState:this.entityState,newState:f.entityStates.Added,newChanged:!this.isChanged()};this.entityState=f.entityStates.Added;this.entityStateChanged.notify(n)}},n.toModified=function(){if(this.entityState!=f.entityStates.Modified){var n={entity:this.entity,oldState:this.entityState,newState:f.entityStates.Modified,newChanged:!this.isChanged()};this.entityState=f.entityStates.Modified;this.entityStateChanged.notify(n)}},n.toDeleted=function(){if(this.entityState!=f.entityStates.Deleted){var n={entity:this.entity,oldState:this.entityState,newState:f.entityStates.Deleted,newChanged:!this.isChanged()};this.entityState=f.entityStates.Deleted;this.entityStateChanged.notify(n)}},n.toUnchanged=function(){if(this.entityState!=f.entityStates.Unchanged){var n={entity:this.entity,oldState:this.entityState,newState:f.entityStates.Unchanged,newUnchanged:this.isChanged()};this.originalValues.length=0;this.changedValues.length=0;this.entityState=f.entityStates.Unchanged;this.entityStateChanged.notify(n)}},n.toDetached=function(){if(this.entityState!=f.entityStates.Detached){var n={entity:this.entity,oldState:this.entityState,newState:f.entityStates.Detached,newUnchanged:this.isChanged()};this.entityState=f.entityStates.Detached;this.entityStateChanged.notify(n)}},n.rejectChanges=function(){var n=this;t.forEach(this.originalValues,function(t){n.setValue(t.p,t.v)});this.originalValues.length=0},n.undoChanges=function(){var n=this;t.forEach(this.changedValues,function(t){n.setValue(t.p,t.v)});this.changedValues.length=0},n.acceptChanges=function(){this.changedValues.length=0},n.getValue=function(n){return this.observableProvider.getValue(this.entity,n)},n.setValue=function(n,t){this.observableProvider.setValue(this.entity,n,t)},n.getOriginalValue=function(n){var i=t.findInArray(this.originalValues,n,"p");return i?i.v:this.getValue(n)},n.foreignKey=function(n){var r=n.entityType,u,t;if(r.keys.length==0)return null;for(u=[],t=0;t<r.keys.length;t++){var f=r.keys[t],e=n.foreignKeyNames[t],i=this.getValue(e);if(i==null)return null;f.dataType.name=="guid"&&(i=i.toLowerCase());u.push(i)}return u.join(",")},n.createLoadQuery=function(n,i){var r=t.findInArray(this.entityType.navigationProperties,n,"name");return v(r,n,i,this)},n.loadNavigationProperty=function(n,i,u,e,o,s){var c,h,l;if(this.manager==null)throw t.createError(r.entityNotBeingTracked,{entity:this.entity});return c=t.findInArray(this.entityType.navigationProperties,n,"name"),h=v(c,n,u,this),i&&t.forEach(i,function(n){h=h.expand(n)}),l=this,e=e||{},e.merge==null&&(e.merge=f.mergeStrategy.Preserve),e.autoFixScalar==null&&(e.autoFixScalar=!0),e.autoFixPlural==null&&(e.autoFixPlural=!0),this.manager.executeQuery(h,e,function(){c.inverse||l.manager.fixNavigations(entity);o&&o.apply(null,arguments)},s)},n.validate=function(){return this.entityState==f.entityStates.Deleted?this.validationErrors=[]:o(this.entityType.validate(this.entity),this),this.validationErrors},n.toRaw=function(n){var r=this.entityType,i={},f=this;return r.hasMetadata&&(t.forEach(r.dataProperties,function(t){var r=f.getValue(t.name);r!=null&&r.$tracker?(n==!0||r.$tracker.entityType.isComplexType)&&(i[t.name]=r.$tracker.toRaw(n)):i[t.name]=t.dataType.getRawValue(r)}),n==!0&&t.forEach(r.navigationProperties,function(n){var r=f.getValue(n.name);r==null?i[n.name]=null:u.isArray(r)?t.forEach(r,function(n){n!=null&&n.$tracker?i[p].push(n.$tracker.toRaw(!0)):i[p].push(n)}):i[n.name]=r.$tracker.toRaw(!0)})),t.forEach(r.properties,function(r){var e=f.getValue(r);u.isArray(e)?(i[r]=[],t.forEach(e,function(t){t!=null&&t.$tracker?n==!0&&i[r].push(t.$tracker.toRaw(!0)):i[r].push(t)})):e!=null&&e.$tracker?(n==!0||e.$tracker.entityType.isComplexType)&&(i[r]=e.$tracker.toRaw(n)):i[r]=e}),i},h.toEntity=function(n,t,i){return new e.EntityTracker(n,t,i).entity},h}(),EntityManager:function(){function w(n,t,i,r,e,o){var l,h,a,v,b,w;return(i=i||{},l=i.async,l==null&&(l=o.workAsync),l==null&&(l=s.workAsync),i.async=l,h=l?o.promiseProvider:null,a=null,h&&(a=h.deferred()),v=i.makeObservable,v==null&&(v=!0),b=i.state==f.entityStates.Detached,w=null,o.dataService.createEntityAsync(n,t,i,function(n,t,s,l){var g,k,d;try{g=!1;u.isArray(n)||(n=[n],g=!0);v&&!b&&y(n,t,f.mergeStrategy.ThrowError,f.entityStates.Added,o);g&&(n=n[0]);k={};k.userData=s("X-UserData");d=k.userData!=null;i.includeHeaderGetter===!0&&(k.headerGetter=s,d=!0);i.includeXhr===!0&&(k.xhr=l,d=!0);d&&(n.$extra=k);p(r,h,a,n);h||(w=n)}catch(nt){c(e,h,a,n,o)}},function(t){t.typeName=n;c(e,h,a,t,o)}),h)?h.getPromise(a):w}function k(n,t,i,r){var e=f.mergeStrategy.ThrowError,o=i;t?(t.merge!=null&&(e=t.merge),t.state!=null&&(o=t.state)):t={};u.isArray(n)||(n=[n]);y(n,null,e,o,r,t.autoFixScalar,t.autoFixPlural)}function ht(o,h){function k(n,i){return function(r){t.extend(this,r);i.createEntity(n,this)}}function g(n){return function(i,r){t.extend(this,i);r==!0?n.createRawEntity(this):n.createEntity(this)}}var w,b,p;if(h._readyCallbacks=[],h._readyPromises=[],o.length<1||o.length>3)throw t.createError(r.managerInvalidArgs,{entityManager:h});var y=o[0],a=o[1],c=o[2];if(u.isInstanceOf(y,i.DataServiceBase))h.dataService=y,c=o[1];else if(u.isTypeOf(y,"string"))o.length===2&&u.isObject(a)&&!u.isInstanceOf(a,l.MetadataManager)&&(c=a,a=undefined),w=s.getDefaultServiceType(),b=w===f.serviceTypes.WebApi?v.WebApiService:v.MvcService,h.dataService=new b(y,a,c);else throw t.createError(r.managerInvalidArgs,{entityManager:this,arguments:o});c=c||{};h.promiseProvider=c.promiseProvider||s.getPromiseProvider();h.autoFixScalar=c.autoFixScalar;h.autoFixPlural=c.autoFixPlural;h.validateOnMerge=c.validateOnMerge;h.validateOnSave=c.validateOnSave;h.liveValidate=c.liveValidate;h.handleUnmappedProperties=c.handleUnmappedProperties;h.forceUpdate=c.forceUpdate;h.workAsync=c.workAsync;h.minimizePackage=c.minimizePackage;h.pendingChangeCount=0;h.entities=new e.EntityContainer;h.validationErrors=[];h.entityStateChanged=new e.Event("entityStateChanged",h);h.validationErrorsChanged=new e.Event("validationErrorsChanged",h);h.hasChangesChanged=new e.Event("hasChangesChanged",h);h.queryExecuting=new e.Event("queryExecuting",h);h.queryExecuted=new e.Event("queryExecuted",h);h.saving=new e.Event("saving",h);h.saved=new e.Event("saved",h);p=c.registerMetadataTypes;p==null&&(p=s.registerMetadataTypes);h.dataService.ready(function(){var s=h.dataService.metadataManager,r,u,i,t,f,c,e,o;if(p&&s){if(r=s.types,r)for(h.entitySets={},u=0;u<r.length;u++)i=r[u],t=i.shortName,h.hasOwnProperty(t)||(h[t]=k(t,h)),f=i.setName,f&&!h.hasOwnProperty(f)&&(c=h.createSet(i),h[f]=c,h.entitySets[t]=c),n.hasOwnProperty(t)||(n[t]=g(i));if(e=s.enums,e)for(o in e)n.hasOwnProperty(o)||(n[o]=e[o])}d(h)})}function d(n){var i,e,t,r,u,f;if(n.isReady())for(i=n._readyCallbacks.slice(0),e=n._readyPromises.slice(0),n._readyCallbacks=[],n._readyPromises=[],t=0;t<i.length;t++)r=i[t],r&&r.call(n),u=e[t],u&&(f=n.promiseProvider,f&&f.resolve(u))}function y(n,i,e,o,h,c,l){var v;if(o){if(o===f.entityStates.Detached)return}else o=f.entityStates.Added;e||(e=f.mergeStrategy.Preserve);c==null&&(c=h.autoFixScalar);c==null&&(c=s.autoFixScalar);l==null&&(l=h.autoFixPlural);l==null&&(l=s.autoFixPlural);v=h.validateOnMerge;v==null&&(v=s.validateOnMerge);i=i||h.flatEntities(u.isArray(n)?n:[n]);var p=[],w=[],y=[],b=h.entities.count(),a=h;t.forEach(i,function(n){var u;if(n!=null){if(u=n.$tracker,!u&&n.$type)u=a.toEntity(n,n.$type).$tracker;else if(u.entityType.isComplexType||h.isInManager(n))return;var o=u.entityType,s=u.key,i=null;if(b>0&&s&&(i=a.entities.getEntityByKey(s,o.floorType)),i){if(o.name!==i.$tracker.entityType.name)throw t.createError(r.sameKeyOnDifferentTypesError,[i.$tracker.entityType.shortName,o.shortName],{existingEntity:i,entity:n,manager:a});if(e===f.mergeStrategy.ThrowError)throw t.createError(r.sameKeyExists,{existingEntity:i,entity:n,manager:a});else e===f.mergeStrategy.Preserve?y.push({o:n,n:i}):(y.push({o:n,n:i}),w.push({o:i,n:n}))}else a.entities.push(n),n.$tracker.setManagerInfo(a),p.push(n)}});t.forEach(p,function(n){tt(n,c,l,a);yt(n,a);nt(n,o);v===!0&&n.$tracker.validate()});t.forEach(w,function(n){ct(n.o,n.n);nt(n.o,o)});t.forEach(y,function(i){var r=t.indexOf(n,i.o);r>=0&&(n[r]=i.n);lt(i.o,i.n,c,l,a)})}function g(n,i){if(!i.isInManager(n))throw t.createError(r.entityNotBeingTracked,{entity:n,manager:i});}function nt(n,i){if(i===f.entityStates.Unchanged)n.$tracker.toUnchanged();else if(i===f.entityStates.Modified)n.$tracker.toModified();else if(i===f.entityStates.Added)n.$tracker.toAdded();else if(i===f.entityStates.Deleted)n.$tracker.toDeleted();else throw t.createError(r.mergeStateError,[i],{entity:n,state:i});}function ct(n,i){var r=i.$tracker;t.forEach(r.entityType.dataProperties,function(t){n.$tracker.setValue(t.name,r.getValue(t.name))})}function tt(n,i,r,f){if(i==!0||r==!0){var e=n.$tracker,o=e.entityType;t.forEach(o.navigationProperties,function(t){var u=e.getValue(t.name),o,h,s,c;if(t.isComplex){for(o=u.$tracker.owners,h=!1,s=0;s<o.length;s++)if(c=o[s],c.entity==n&&c.property==t){h=!0;break}h||o.push({entity:n,property:t})}else t.isScalar?it(e,u,t,t.name,i,f):(rt(u,f),r&&ft(n,t,u,f))});t.forEach(o.dataProperties,function(t){var u,i,f,r,o;if(t.isComplex){for(u=e.getValue(t.name),u.$tracker.entityType.isComplexType=!0,i=u.$tracker.owners,f=!1,r=0;r<i.length;r++)if(o=i[r],o.entity==n&&o.property==t){f=!0;break}f||i.push({entity:n,property:t})}});t.forEach(e.entityType.properties,function(n){var t=e.getValue(n);u.isArray(t)?rt(t,f):it(e,t,null,n,!1,f)})}}function it(n,i,r,u,f,e){i?(i.$tracker&&i.$tracker.manager!=e&&(i=e.getEntityByKey(i.$tracker.key,i.$tracker.entityType),n.setValue(u,i)),r&&t.setForeignKeys(n.entity,r,i)):r&&f&&ut(n,r,e)}function rt(n,t){for(var r,u,i=n.length-1;i>=0;i--)r=n[i],r&&r.$tracker&&r.$tracker.manager!=t&&(u=t.getEntityByKey(r.$tracker.key,r.$tracker.entityType),u?n.splice(i,1,u):n.splice(i,1))}function lt(n,i,r,u,e){var s=i.$tracker,c,o,h,l;s.entityState!=f.entityStates.Deleted&&(c=n.$tracker,l=c.entityType,t.forEach(l.navigationProperties,function(f){var y,p,l,a,v;f.isComplex||(o=c.getValue(f.name),h=s.getValue(f.name),f.isScalar?h||(r==!0?ut(s,f,e):r===!0&&f.inverse&&f.inverse.isScalar||u===!0&&f.inverse&&!f.inverse.isScalar||(y=c.foreignKey(f),p=s.foreignKey(f),y==p&&o!=null&&e.isInManager(o)&&(l=f.inverse,l?l.isScalar?o.$tracker.setValue(l.name,i):(a=o.$tracker.getValue(l.name),v=t.indexOf(a,n),v>=0&&a.splice(v,1,i)):s.setValue(f.name,o)))):u?ft(i,f,h,e):r===!0&&f.inverse||t.forEach(o,function(n){e.isInManager(n)&&!t.findInArray(h,n)&&h.push(n)}))}))}function ut(n,t,i){var u=n.foreignKey(t),r=i.entities.getEntityByKey(u,t.entityType);r&&r.$tracker.entityState==f.entityStates.Deleted&&(r=null);n.setValue(t.name,r)}function ft(n,i,r,u){var e=u.entities.getRelations(n,i);e&&t.forEach(e,function(n){n.$tracker.entityState==f.entityStates.Deleted||t.findInArray(r,n)||r.push(n)})}function et(n,i){var r=n.$tracker,u=r.entityType,f=i?new e.ValueNotifyWrapper(null,!0):null;u.hasMetadata&&t.forEach(u.navigationProperties,function(n){n.isScalar?r.setValue(n.name,f):r.getValue(n.name).splice(0)})}function at(n,i,r){t.forEach(n,function(n){n.$tracker.entityState==f.entityStates.Deleted?(n.$tracker.toDetached(),ot(n,r),i.remove(n)):n.$tracker.toUnchanged()})}function vt(n,i,r){if(i.removed.length>0)for(var u=i.removed.length-1;u>=0;u--)r.validationErrors.splice(t.indexOf(r.validationErrors,i.removed[u]),1);i.added.length>0&&r.validationErrors.push.apply(r.validationErrors,i.added);(i.removed.length>0||i.added.length>0)&&r.validationErrorsChanged.notify({errors:r.validationErrors,added:i.added,removed:i.removed})}function yt(n,t){n.$tracker.entityStateChanged.subscribe(function(n){var i=t.pendingChangeCount;n.newChanged===!0?t.pendingChangeCount++:n.newUnchanged===!0&&t.pendingChangeCount--;t.entityStateChanged.notify(n);i==0&&t.pendingChangeCount>0?t.hasChangesChanged.notify({hasChanges:!0}):i>0&&t.pendingChangeCount==0&&t.hasChangesChanged.notify({hasChanges:!1})});n.$tracker.validationErrorsChanged.subscribe(function(i){vt(n,i,t)})}function ot(n,i){n.$tracker.entityStateChanged.unsubscribe(i.entityStateChanged.notify);n.$tracker.validationErrorsChanged.unsubscribe(i.validationErrorsChanged.notify);var r=t.filterArray(i.validationErrors,function(t){return t.entity==n});t.removeFromArray(i.validationErrors,n,"entity");i.validationErrorsChanged.notify({errors:i.validationErrors,removed:r,added:[]})}function pt(n,t,i){var r={manager:n,query:t,options:i};return n.queryExecuting.notify(r),a.queryExecuting.notify(r),r}function st(n,t,i,r){var u={manager:n,query:t,options:i,result:r};return n.queryExecuted.notify(u),a.queryExecuted.notify(u),u.result}function wt(n,t,i,r){var u={manager:n,changes:t,savePackage:i,options:r};return n.saving.notify(u),a.saving.notify(u),u.options}function bt(n,t,i,r){var u={manager:n,changes:t,savePackage:i,options:r};n.saved.notify(u);a.saved.notify(u)}function p(n,t,i,r){n&&n(r);t&&t.resolve(i,r)}function c(n,t,i,r,u){if(r.manager=u,n&&n(r),t&&t.reject(i,r),!n&&!t)throw r;}var b=function(){ht(arguments,this)},h=b.prototype;return h.toString=function(){return this.dataService.toString()+", "+r.pendingChanges+": "+this.pendingChangeCount+", "+r.validationErrors+": "+this.validationErrors.length},h.isReady=function(){return this.dataService.isReady()},h.ready=function(n){var t,i,r,u;return this._readyCallbacks.push(n),t=this.promiseProvider,i=null,t&&(r=t.deferred(),this._readyPromises.push(r),i=t.getPromise(r)),u=this,setTimeout(function(){d(u)},10),i},h.getEntityType=function(n){return this.dataService.getEntityType(n)},h.createQuery=function(n,t){return this.dataService.createQuery(n,t,this)},h.createEntityQuery=function(n,t){return this.dataService.createEntityQuery(n,t,this)},h.registerCtor=function(n,t,i){this.dataService.registerCtor(n,t,i)},h.createEntity=function(n,t){var i=this.dataService.createEntity(n,t),r=[i];return y(r,null,f.mergeStrategy.ThrowError,f.entityStates.Added,this),i},h.createDetachedEntity=function(n,t){return this.dataService.createEntity(n,t)},h.createRawEntity=function(n,t){return this.dataService.createRawEntity(n,t)},h.createEntityAsync=function(n,t,i,r,u){return w(n,t,i,r,u,this)},h.createDetachedEntityAsync=function(n,t,i,r,u){return i?i.state=f.entityStates.Detached:i={state:f.entityStates.Detached},w(n,t,i,r,u,this)},h.createRawEntityAsync=function(n,t,i,r,u){return i?i.makeObservable=!1:i={makeObservable:!1},w(n,t,i,r,u,this)},h.executeQuery=function(n,i,e,o){var d,v,h,w,g,nt,k;n.options&&(i=t.combine(n.options,i));d=pt(this,n,i);n=d.query;i=d.options;i=i||{};v=i.async;v==null&&(v=this.workAsync);v==null&&(v=s.workAsync);h=v?this.promiseProvider:null;w=null;h&&(w=h.deferred());var a=f.mergeStrategy.Preserve,l=f.executionStrategy.Server,b=null;if(u.isEnum(i,f.mergeStrategy)?(a=i,i={makeObservable:a!=f.mergeStrategy.NoTrackingRaw}):u.isEnum(i,f.executionStrategy)?l=i:(i.merge&&(a=i.merge),i.execution&&(l=i.execution),i.async=v,i.makeObservable=a!=f.mergeStrategy.NoTrackingRaw,i.handleUnmappedProperties==null&&(i.handleUnmappedProperties=this.handleUnmappedProperties)),g=a==f.mergeStrategy.NoTracking||a==f.mergeStrategy.NoTrackingRaw,g&&l==f.executionStrategy.Both)throw t.createError(r.executionBothNotAllowedForNoTracking,{executionStrategy:l,mergeStrategy:a});return((l==f.executionStrategy.Local||l==f.executionStrategy.LocalIfEmptyServer)&&(b=this.executeQueryLocally(n,i.varContext)),nt=null,l==f.executionStrategy.Local||l==f.executionStrategy.LocalIfEmptyServer&&b&&(b.length==null||b.length>0)?(b=st(this,n,i,b),p(e,h,w,b)):(k=this,this.dataService.executeQuery(n,i,function(t,r,s,v){var it,b,d,tt;try{it=!1;b=s("X-InlineCount");b!=null&&(b=Number(b));t&&(g||(u.isArray(t)||(t=[t],it=!0),y(t,r,a,f.entityStates.Unchanged,k,i.autoFixScalar,i.autoFixPlural),it&&(t=t[0])));l==f.executionStrategy.Both&&(t=k.executeQueryLocally(n,i.varContext,!0),t.$inlineCountDiff!=null&&(b!=null&&(b+=t.$inlineCountDiff),delete t.$inlineCountDiff));t&&u.isObject(t)&&(n.inlineCountEnabled&&b!=null&&(t.$inlineCount=b),d={},d.userData=s("X-UserData"),tt=d.userData!=null,i.includeHeaderGetter===!0&&(d.headerGetter=s,tt=!0),i.includeXhr===!0&&(d.xhr=v,tt=!0),tt&&(t.$extra=d));t=st(k,n,i,t);p(e,h,w,t);h||(nt=t)}catch(rt){c(o,h,w,rt,k)}},function(t){t.query=n;c(o,h,w,t,k)})),h)?h.getPromise(w):nt},h.executeQueryLocally=function(n,i,u){var v=n.entityType,y,h,s,p,w;if(v)if(h=this.entities.findEntitySet(v),h)y=h.getEntities();else return[];else throw t.createError(r.typeRequiredForLocalQueries);u&&n.getExpression(o.expressions.GroupByExp,!1)&&(a.warning.notify({message:r.countDiffCantBeCalculatedForGrouped,query:n,options:i}),u=!1);var e=[],c=[],l=[];return t.forEach(y,function(n){n.$tracker.entityState==f.entityStates.Added?(u&&c.push(n),e.push(n)):n.$tracker.entityState==f.entityStates.Deleted?u&&l.push(n):e.push(n)}),s=n.toFunction(),e=s(e,i),u&&e.$inlineCount!=null&&(p=c.length>0?s(c,i).$inlineCount:0,w=l.length>0?s(l,i).$inlineCount:0,e.$inlineCountDiff=p-w),e},h.getEntityByKey=function(n,t){var i=u.isInstanceOf(t,l.EntityType)?t:this.getEntityType(t,!0);return this.entities.getEntityByKey(n,i)},h.deleteEntity=function(n){var i,u,e;for(g(n,this),i=this,u=[],t.forEach(n.$tracker.entityType.navigationProperties,function(f){var e,o;if(f.cascadeDelete){if(f.inverse&&f.inverse.cascadeDelete)throw t.createError(r.twoEndCascadeDeleteNotAllowed,{entity:n,property:f});e=n.$tracker.getValue(f.name);e&&(f.isScalar?f.foreignKeys!=null&&f.foreignKeys.length>0?u.push(e):i.deleteEntity(e):(o=t.filterArray(e,function(){return!0}),t.forEach(o,function(n){i.deleteEntity(n)})))}}),n.$tracker.entityState===f.entityStates.Added?this.detachEntity(n):(et(n,!0),n.$tracker.toDeleted()),e=0;e<u.length;e++)i.deleteEntity(u[e])},h.addEntity=function(n,t){k(n,t,f.entityStates.Added,this)},h.attachEntity=function(n,t){k(n,t,f.entityStates.Unchanged,this)},h.detachEntity=function(n,i){var f=this,e;u.isArray(n)||(n=[n]);e=i===!0?this.flatEntities(n):n;t.forEach(e,function(n){if(n.$tracker.entityType.isComplexType&&n.$tracker.owners.length>0)throw t.createError(r.cannotDetachComplexTypeWithOwners);g(n,f);et(n,!0);ot(n,f);n.$tracker.toDetached();n.$tracker.manager=null;f.entities.remove(n)})},h.rejectChanges=function(n,i){var e=this,r;u.isArray(n)||(n=[n]);r=i===!0?this.flatEntities(n):n;t.forEach(r,function(n){var t=n.$tracker;t.entityState==f.entityStates.Added?e.detachEntity(n):t.entityState!=f.entityStates.Detached&&(t.rejectChanges(),t.toUnchanged())})},h.undoChanges=function(n,i){u.isArray(n)||(n=[n]);var r=i===!0?this.flatEntities(n):n;t.forEach(r,function(n){n.$tracker.undoChanges()})},h.acceptChanges=function(n,i){u.isArray(n)||(n=[n]);var r=i===!0?this.flatEntities(n):n;t.forEach(r,function(n){n.$tracker.acceptChanges()})},h.createSavePackage=function(n,i){var o,u,c,e,h,l;if(n=n||this.getChanges(),i=i||{},o=[],u=i.validateOnSave,u==null&&(u=this.validateOnSave),u==null&&(u=s.validateOnSave),u===!0&&t.forEach(n,function(n){if(n.$tracker.entityState!=f.entityStates.Deleted){var t=n.$tracker.validate();t&&t.length>0&&o.push({entity:n,validationErrors:t})}}),o.length>0)throw t.createError(r.validationFailed,{entities:n,entitiesInError:o});return c=i.userData||null,e=i.forceUpdate,e==null&&(e=this.forceUpdate),e==null&&(e=s.forceUpdate),h={userData:c,forceUpdate:e},l=this.exportEntities(n,i),h.entities=l,h},h.exportEntities=function(n,i){var u,r;return i=i||{},u=[],n=n||this.entities.getEntities(),r=i.minimizePackage,r==null&&(r=this.minimizePackage),r==null&&(r=s.minimizePackage),t.forEach(n,function(n,i){var e=n.$tracker,a=e.entityType,s=e.entityState,h=e.forceUpdate,c={},o,l;if(r===!0)if(s==f.entityStates.Modified)if(e.originalValues.length>0)o={},t.forEach(e.originalValues,function(t){var f,r=t.p.split("."),s,u,i;if(r.length>1){for(s=0;s<r.length-1;s++)u=r[s],n=n.$tracker.getValue(u),o[u]==null&&(o[u]={}),o=o[u];f=r[r.length-1]}else f=t.p;i=e.getValue(f);i&&i.$tracker&&(i=i.$tracker.toRaw());o[f]=i}),t.forEach(e.entityType.dataProperties,function(n){(n.isKeyPart===!0||n.useForConcurrency===!0)&&(o[n.name]=e.getValue(n.name))});else if(h===!0)o=e.toRaw(n);else return;else if(s==f.entityStates.Deleted)o={},t.forEach(e.entityType.dataProperties,function(n){(n.isKeyPart===!0||n.useForConcurrency===!0)&&(o[n.name]=e.getValue(n.name))});else if(s==f.entityStates.Added)o=e.toRaw(n);else return;else o=e.toRaw(n);s==f.entityStates.Modified&&t.forEach(e.originalValues,function(n){var t=n.v;t&&t.$tracker&&(t=t.$tracker.toRaw());c[n.p]=t});l={t:a.name,s:s.toString(),o:c,i:i,f:h};o.$t=l;u.push(o)}),u},h.importEntities=function(n,i){var e=this;u.isArray(n)||(n=[n]);t.forEach(n,function(n){var u=n.$t,s,o,h,c;switch(u.s){case"Unchanged":s=f.entityStates.Unchanged;break;case"Added":s=f.entityStates.Added;break;case"Deleted":s=f.entityStates.Deleted;break;case"Modified":s=f.entityStates.Modified;break;default:throw t.createError(r.unsoppertedState,[u.s],{entity:n});}if(o=e.toEntity(n,u.t),y(o,[o],i||f.mergeStrategy.Preserve,s,e,!0,!0),u.o)for(h in u.o)c=u.o[h],o.$tracker.originalValues.push({p:h,v:c});o.$tracker.forceUpdate=u.forceUpdate;delete o.$t})},h.hasChanges=function(){return this.pendingChangeCount>0},h.getChanges=function(){return this.entities.getChanges()},h.saveChanges=function(n,t,i){return this.savePackage(null,n,t,i)},h.savePackage=function(n,i,r,e){var v,h,l,o,w,a;if(i=i||{},v=i.async,v==null&&(v=this.workAsync),v==null&&(v=s.workAsync),i.async=v,h=v?this.promiseProvider:null,l=null,h&&(l=h.deferred()),!n)if(i.entities?(o=i.entities,u.isArray(o)||(o=[o])):o=this.getChanges(),o.length)try{n=this.createSavePackage(o,i)}catch(b){c(e,h,l,b,this)}else p(r,h,l,{AffectedCount:0,GeneratedValues:[]});if(w=null,n){i=wt(this,o,n,i);try{a=this;this.dataService.saveChanges(n,i,function(u,s,v){try{u.GeneratedEntities!=null&&u.GeneratedEntities.length>0&&y(u.GeneratedEntities,null,f.mergeStrategy.Preserve,f.entityStates.Unchanged,a,i.autoFixScalar,i.autoFixPlural);u.GeneratedValues&&t.forEach(u.GeneratedValues,function(n){var r,e,t,u,h,s;if(!(n.Index<0)){if(r=o[n.Index],t=n.Property.split("."),t.length>1){for(u=0;u<t.length-1;u++)r=r.$tracker.getValue(t[u]);e=t[t.length-1]}else e=n.Property;h=r.$tracker;n.Value!=null&&n.Value.$type&&(s=[n.Value],y(s,null,f.mergeStrategy.Preserve,f.entityStates.Unchanged,a,i.autoFixScalar,i.autoFixPlural),n.Value=s[0]);h.setValue(e,n.Value)}});at(o,a.entities,a);u.userData=s("X-UserData");i.includeHeaderGetter===!0&&(u.headerGetter=s);i.includeXhr===!0&&(u.xhr=v);bt(a,o,n,i);p(r,h,l,u);h||(w=u)}catch(b){b.changes=o;b.savePackage=n;c(e,h,l,b,a)}},function(t){t.changes=o;t.savePackage=n;c(e,h,l,t,a)})}catch(b){c(e,h,l,b,this)}}return h?h.getPromise(l):w},h.toEntity=function(n,t){return n.$type&&!t&&(t=n.$type),this.dataService.toEntity(n,t)},h.fixNavigations=function(n){if(!this.isInManager(n))throw t.createError(r.entityNotBeingTracked,null,{entity:n});tt(n,!0,!0,this)},h.isInManager=function(n){return n.$tracker.manager==this},h.flatEntities=function(n){var r=this,i=arguments[1]||[];return u.isArray(n)||(n=[n]),t.forEach(n,function(n){var f,s,o,e;if(n!=null){if(u.isArray(n)){r.flatEntities(n,i);return}if(!t.findInArray(i,n))if(f=n.$tracker,s=n.$type,f)i.push(n),f.entityType.hasMetadata?(t.forEach(f.entityType.dataProperties,function(n){if(n.isComplex){var t=f.getValue(n.name);t&&(u.isArray(t)?r.flatEntities(t,i):(t.$tracker||t.$type)&&r.flatEntities([t],i))}}),t.forEach(f.entityType.navigationProperties,function(n){var t=f.getValue(n.name);t&&(u.isArray(t)?r.flatEntities(t,i):(t.$tracker||t.$type)&&r.flatEntities([t],i))})):t.forEach(f.entityType.properties,function(n){var t=f.getValue(n);t&&(u.isArray(t)?r.flatEntities(t,i):(t.$tracker||t.$type)&&r.flatEntities([t],i))});else if(s){i.push(n);for(o in n)o!=="$type"&&(e=n[o],e&&(u.isArray(e)?r.flatEntities(e,i):(e.$tracker||e.$type)&&r.flatEntities([e],i)))}}}),i},h.entry=function(n){return n.$tracker},h.createSet=function(n){return u.isInstanceOf(n,l.EntityType)||(u.isFunction(n)&&(n=t.getFuncName(n)),n=this.getEntityType(n,!0)),new e.EntitySet(n,this)},h.set=function(n){return u.isFunction(n)&&(n=t.getFuncName(n)),this.entitySets&&this.entitySets[n]},b}(),EntityBase:function(){return function(n,i,r){r&&t.extend(this,r);n.createEntity(this);i!=null&&i.addEntity(this)}}()}}(),v=function(){var n={};return n.MvcService=function(){function f(n){var t=0,i,r,u;if(n.length==0)return t;for(i=0,u=n.length;i<u;i++)r=n.charCodeAt(i),t=(t<<5)-t+r|0;return t}var r=function(n,t,r){i.DataServiceBase.call(this,n,t,r)},n;return t.inherit(r,i.DataServiceBase),n=r.prototype,n.fetchMetadata=function(n,t,i){var u=null,o=this,r,f,e;return n=n||{},r=n.async,r==null&&(r=!this.ajaxProvider.syncSupported),f=n.timeout||this.ajaxTimeout||s.ajaxTimeout,e=n.extra,this.ajaxProvider.doAjax(this.uri+"Metadata","GET",this.dataType,this.contentType,null,r,f,e,null,function(n,i,r){u=o.serializationService.deserialize(n);t(u,i,r)},i),u},n.createEntityAsync=function(n,i,r,f,e){var o,h,c;u.isFunction(n)&&(n=t.getFuncName(n));o=this;r=r||{};h=r.makeObservable;h==null&&(h=!0);c=r.async;c==null&&(c=s.workAsync);var a=r.timeout||this.ajaxTimeout||s.ajaxTimeout,v=r.extra,l=o.uri+"CreateType?typeName="+n+"&initialValues=";i!=null&&(l+=o.serializationService.serialize(i));this.ajaxProvider.doAjax(l,"GET",this.dataType,this.contentType,null,c,a,v,null,function(n,t,i){n=o.serializationService.deserialize(n);var r=o.fixResults(n,h);f(n,r,t,i)},function(n){e(n)})},n.executeQuery=function(n,t,i,r){var u=this.toBeetleQueryParams(n,t&&t.varContext);return this.executeQueryParams(n.resource,u,t,i,r)},n.executeQueryParams=function(n,i,r,e,o){var c,y,p,k,w,b;r=r||{};var d=r.makeObservable,g=r.handleUnmappedProperties,nt=r.usePost||!1,tt=r.dataType||this.dataType,it=r.contentType||this.contentType,l=r.async;l==null&&(l=s.workAsync);var rt=r.timeout||this.ajaxTimeout||s.ajaxTimeout,ut=r.extra,a,v=null,h=r.uri||this.uri||"";h&&h[h.length-1]!="/"&&(h+="/");h=h+n;nt===!0?(y={},t.forEach(i,function(n){y[n.name]=n.value}),v=this.serializationService.serialize(y),c=v,a="POST"):(p=[],t.forEach(i,function(n){p.push(n.name+"="+encodeURIComponent(n.value))}),c=p.join("&"),h+="?"+c,a="GET");k=f(c);w={"x-beetle-request":k,"x-beetle-request-len":c.length};t.extend(w,r.headers);b=this;this.ajaxProvider.doAjax(h,a,tt,it,v,l,rt,ut,w,function(n,t,i){var r,f;try{n=b.serializationService.deserialize(n)}catch(o){}n!=null&&n.$d!=null&&(n=n.$d);r=null;n&&(f=!1,u.isArray(n)||(n=[n],f=!0),r=b.fixResults(n,d,g),f&&(n=n[0]));e(n,r,t,i)},function(n){o(n)})},n.saveChanges=function(n,i,r,u){var c=this,o,l;i=i||{};o=i.async;o==null&&(o=s.workAsync);var v=i.timeout||this.ajaxTimeout||s.ajaxTimeout,y=i.extra,e=i.uri||this.uri||"";e&&e[e.length-1]!="/"&&(e+="/");l=i.saveAction||"SaveChanges";e=e+l;var h=this.serializationService.serialize(n),p=f(h),a={"x-beetle-request":p,"x-beetle-request-len":h.length};t.extend(a,i.headers);this.ajaxProvider.doAjax(e,"POST",this.dataType,this.contentType,h,o,v,y,a,function(n,t,i){try{n=c.serializationService.deserialize(n)}catch(u){}n&&(c.fixResults(n,!1,null),delete n.$id,delete n.$type);r(n,t,i)},function(n){u(n)})},n.fixResults=function(n,i,r){function h(n){var l=n.$id,s,t,c;delete n.$id;f[l-1]=n;for(s in n)s!=="$type"&&(t=n[s],t!=null&&(t.$ref?n[s]=f[t.$ref-1]:t.$id?h(t):u.isArray(t)?o.fixResults(t,i,r,f):r!==!1&&(n[s]=e.dataTypes.handle(t))));i!==!1&&(c=n.$type,o.toEntity(n,c))}var o=this,f=arguments[3]||[];return u.isArray(n)||(n=[n]),r==null&&(r=s.handleUnmappedProperties),t.forEach(n,function(t,s){t!=null&&(t.$ref?n[s]=f[t.$ref-1]:t.$id?h(t):u.isArray(t)?o.fixResults(t,i,r,f):r!==!1&&(n[s]=e.dataTypes.handle(t)))}),f},r}(),n.WebApiService=function(){var i=function(n,t,i){v.MvcService.call(this,n,t,i);this.useBeetleQueryStrings=!1},u;return t.inherit(i,n.MvcService),u=i.prototype,u.executeQuery=function(n,t,i,u){var f,e,o;return t=t||{},e=t.varContext,o=t.useBeetleQueryStrings!=null?t.useBeetleQueryStrings:this.useBeetleQueryStrings,o===!0?f=this.toBeetleQueryParams(n,e):n.isMultiTyped===!0?(f=this.toBeetleQueryParams(n,e),a.warning.notify({message:r.beetleQueryChosenMultiTyped,query:n,options:t})):t.usePost?(f=this.toBeetleQueryParams(n,e),a.warning.notify({message:r.beetleQueryChosenPost,query:n,options:t})):f=this.toODataQueryParams(n,e),this.executeQueryParams(n.resource,f,t,i,u)},i}(),n}(),f=function(){return{observableProviders:new h.Enum({Knockout:{code:"ko",instance:c.koObservableProviderInstance},Property:{code:"prop",instance:c.propertyObservableProviderInstance}}),promiseProviders:new h.Enum({Q:{code:"Q",instance:c.qPromiseProviderInstance},jQuery:{code:"jQuery",instance:c.jQueryPromiseProviderInstance},Angular:{code:"Angular",instance:c.angularPromiseProviderInstance}}),ajaxProviders:new h.Enum({jQuery:{code:"jQuery",instance:c.jQueryAjaxProviderInstance},Angular:{code:"Angular",instance:c.angularAjaxProviderInstance}}),serializationServices:new h.Enum({JSON:{code:"JSON",instance:c.jsonSerializationServiceInstance}}),entityStates:new h.Enum("Detached","Unchanged","Added","Deleted","Modified"),langOperators:function(){var n=function(n,t,i,r,u){this.name=n;this.code=t;this.asFunc=i;this.oData=r;this.js=u||t},i=[];return i.push(new n("Not","!",function(n){return!n()},"not ")),i.push(new n("Negative","-",function(n){return-1*n()})),i.push(new n("And","&&",function(n,t){return n()&&t()},"and")),i.push(new n("Or","||",function(n,t){return n()||t()},"or")),i.push(new n("Equals","==",function(n,i){return t.equals(n(),i(),!1,this)},"eq")),i.push(new n("StrictEquals","==",function(n,i){return t.equals(n(),i(),!0,this)},"eq","===")),i.push(new n("NotEqual","!=",function(n,i){return!t.equals(n(),i(),!1,this)},"ne")),i.push(new n("StrictNotEqual","!=",function(n,i){return!t.equals(n(),i(),!0,this)},"ne","!==")),i.push(new n("Greater",">",function(n,t){return n()>t()},"gt")),i.push(new n("Lesser","<",function(n,t){return n()<t()},"lt")),i.push(new n("GreaterEqual",">=",function(n,t){var i=n(),r=t();return i==r||i>r},"ge")),i.push(new n("LesserEqual","<=",function(n,t){var i=n(),r=t();return i==r||i<r},"le")),i.push(new n("Sum","+",function(n,t){return n()+t()},"add")),i.push(new n("Subtract","-",function(n,t){return n()-t()},"sub")),i.push(new n("Multiply","*",function(n,t){return n()*t()},"mul")),i.push(new n("Divide","/",function(n,t){return n()/t()},"div")),i.push(new n("Modulo","%",function(n,t){return n()%t()},"mod")),i.push(new n("BitAnd","&",function(n,t){return n()&t()})),i.push(new n("BitOr","|",function(n,t){return n()|t()})),i.push(new n("BitShiftLeft","<<",function(n,t){return n()<<t()})),i.push(new n("BitShiftRight",">>",function(n,t){return n()>>t()})),n.find=function(n){var r=t.filterArray(i,function(t){return t.code==n||t.oData==n||t.js==n});return r.length>0?r[0]:null},n}(),mergeStrategy:new h.Enum("Preserve","Overwrite","ThrowError","NoTracking","NoTrackingRaw"),executionStrategy:new h.Enum("Server","Local","Both","LocalIfEmptyServer"),generationPattern:new h.Enum("Identity","Computed"),arraySetBehaviour:new h.Enum("NotAllowed","Replace","Append"),serviceTypes:new h.Enum("WebApi","Mvc")}}(),a=function(){return{queryExecuting:new e.Event("beetleQueryExecuting",this),queryExecuted:new e.Event("beetleQueryExecuted",this),saving:new e.Event("beetleSaving",this),saved:new e.Event("beetleSaved",this),info:new e.Event("beetleInfo",this),warning:new e.Event("beetleWarning",this),error:new e.Event("beetleError",this)}}(),s=function(){function o(n,i,f){var o,e,s;if(i&&u.isInstanceOf(n,i))return n;if(f!=null){if(u.isNotEmptyString(n))for(o=f.symbols(),e=0;e<o.length;e++)if(s=o[e],t.equals(s.name,n,!1,{isCaseSensitive:!1,ignoreWhiteSpaces:!1})){n=s;break}if(u.isEnum(n,f))return n.instance}throw t.createError(r.invalidArguments,null,{args:arguments});}var s,h,l;s=n.ko?c.koObservableProviderInstance:c.propertyObservableProviderInstance;h=n.Q?c.qPromiseProviderInstance:n.angular?c.angularPromiseProviderInstance:c.jQueryPromiseProviderInstance;l=n.angular?c.angularAjaxProviderInstance:c.jQueryAjaxProviderInstance;var a=c.jsonSerializationServiceInstance,v=f.arraySetBehaviour.NotAllowed,y=f.serviceTypes.WebApi,p=c.defaultDateConverterInstance,w,e={};return e.autoFixScalar=!0,e.autoFixPlural=!1,e.validateOnMerge=!0,e.validateOnSave=!0,e.liveValidate=!0,e.handleUnmappedProperties=!0,e.isCaseSensitive=!1,e.ignoreWhiteSpaces=!1,e.forceUpdate=!1,e.cacheMetadata=!0,e.registerMetadataTypes=!1,e.workAsync=!0,e.ajaxTimeout=null,e.minimizePackage=!1,e.getObservableProvider=function(){return s},e.setObservableProvider=function(n){s=o(n,i.ObservableProviderBase,f.observableProviders)},e.getPromiseProvider=function(){return h},e.setPromiseProvider=function(n){h=o(n,i.PromiseProviderBase,f.promiseProviders)},e.getAjaxProvider=function(){return l},e.setAjaxProvider=function(n){l=o(n,i.AjaxProviderBase,f.ajaxProviders)},e.getSerializationService=function(){return a},e.setSerializationService=function(n){a=o(n,i.SerializationServiceBase,f.serializationServices)},e.getArraySetBehaviour=function(){return v},e.setArraySetBehaviour=function(n){v=o(n,null,f.arraySetBehaviour)},e.getDefaultServiceType=function(){return y},e.setDefaultServiceType=function(n){y=o(n,null,f.serviceTypes)},e.getDateConverter=function(){return p},e.setDateConverter=function(n){p=o(n,i.DateConverterBase)},e.getLocalizeFunction=function(){return w},e.setLocalizeFunction=function(n){t.assertPrm(n,"func").isFunction().check();w=n},e}(),r={argCountMismatch:'Argument count mismatch for "%0".',arrayEmpty:"The array does not contain any element.",arrayNotSingle:"The array does not contain exactly one element.",arrayNotSingleOrEmpty:"The array does not contain zero or one element.",assignError:"Cannot set %0 property with %1.",assignErrorNotEntity:"Cannot set %0 property, value is not an entity.",autoGeneratedCannotBeModified:"Auto generated properties cannot be modified.",beetleQueryChosenMultiTyped:"Beetle query string is used because query is multi-typed.",beetleQueryChosenPost:"Beetle query string is used because query method is POST.",beetleQueryNotSupported:"Beetle queries are not supported, you may use only OData query parameters (where, orderBy, select, expand, top, skip).",cannotBeEmptyString:"%0 value can not be empty string.",cannotCheckInstanceOnNull:"Cannot check instance on null value.",cannotDetachComplexTypeWithOwners:"Complex types with owners cannot be detached.",compareError:"%0 property value must be equal with %1.",complexCannotBeNull:"%0 complex property can not be null.",couldNotLoadMetadata:"Could not load metadata.",couldNotLocateNavFixer:"Could not locate any observable provider.",couldNotLocatePromiseProvider:"Could not locate any promise provider.",couldNotParseToken:"Could not parse %0.",countDiffCantBeCalculatedForGrouped:'In-line count difference can not be calculated when query contains a "groupBy" expression',dataPropertyAlreadyExists:"Data property already exists: %0.",entityAlreadyBeingTracked:"Entity is already being tracked by another manager.",entityNotBeingTracked:"Entity is not being tracked by a manager.",executionBothNotAllowedForNoTracking:"Execution strategy cannot be Both when merge strategy is NoTracking or NoTrackingRaw.",expressionCouldNotBeFound:"Expression could not be found.",functionNeedsAlias:"%0 function needs alias to work properly. You can set alias like Linq, p => p.Name.",functionNotSupportedForOData:"OData does not support %0 function.",instanceError:"%0 is not an instance of %1.",invalidArguments:"Invalid arguments.",invalidDefaultValue:"%0 is not a valid default value for %0.",invalidEnumValue:"Invalid enum value, %0 cannot be found in %1.",invalidExpression:"%0 can only have %1 type expressions.",invalidPropertyAlias:"Invalid property alias.",invalidStatement:"Invalid statement.",invalidValue:"Invalid value for %0 property.",managerInvalidArgs:"Invalid arguments. Valid args are: {DataService, [Injections]} or {Uri, [Metadata], [Injections]}.",maxLenError:"%0 property length cannot exceed %1.",maxPrecisionError:"Value %0 exceeded maximum precision of %1.",mergeStateError:"Cannot merge entities with %0 state.",minLenError:"%0 property length must be greater than %1.",noMetadataEntityQuery:"Cannot create entity query when no metadata is available.",noMetadataRegisterCtor:"Cannot register constructor when no metadata is available.",noOpenGroup:"Could not find any open group.",notFoundInMetadata:"Could not find %0 in metadata.",notImplemented:"%0 %1 is not implemented.",notNullable:"Cannot set %0 with null, property is not nullable.",oDataNotSupportMultiTyped:"Multi-Typed queries cannot be used for OData services.",odataDoesNotSupportAlias:"OData services does not support query alias and primitive typed resources.",onlyManagerCreatedCanBeExecuted:"Only queries which are created from a manager can be directly executed.",onlyManagerCreatedCanAcceptEntityShortName:"Only queries which are created from a manager can accept entity type short name parameter.",pendingChanges:"Pending changes",pluralNeedsInverse:"To load plural relations, navigation property must have inverse.",projectionsMustHaveAlias:"All projected values must have a property name or alias.",propertyNotFound:"Could not find property: %0.",queryClosed:"Query is closed, expression cannot be added. Queries must be executed after some expressions like first, single, any, all etc..",rangeError:"%0 property value must be between %1 and %2.",requiredError:"%0 property is required.",sameKeyExists:"There is already an entity with same key in the manager.",sameKeyOnDifferentTypesError:"Two different types of entities cannot have same keys when they are from same inheritance root (%0, %1).",settingArrayNotAllowed:"Setting array property is not allowed, you may change this via beetle.settings.setArraySetBehaviour(behavior).",stringLengthError:"%0 property length must be between %1 and %2.",syncNotSupported:"%0 does not support sync ajax calls.",twoEndCascadeDeleteNotAllowed:"Two-end cascade deletes are not supported.",typeError:"%0 type is not %1.",typeMismatch:"%0 value type mismatch. expected type: %1, given type: %2, value: %3",typeRequiredForLocalQueries:'To execute queries locally, entity type must be provided (createQuery("Entities", "Entity") or createEntityQuery("Entity")).',unclosedQuote:'Unclosed quote in "%0".',unclosedToken:'Unclosed "%0".',unexpectedProperty:'Unexpected property "%0".',unexpectedToken:"Unexpected %0.",unknownDataType:"Unknown data type: %0.",unknownExpression:"Unknown expression.",unknownFunction:"Unknown function: %0.",unknownParameter:"Unknown parameter: %0.",unknownValidator:"Unknown validator type: %0.",unsoppertedState:"Unsupported entity state: %0.",validationErrors:"Validation errors",validationFailed:"Validation failed.",valueCannotBeNull:"Value cannot be null: %0.",operatorNotSupportedForOData:"Operator is not supported for OData: %0."},y={en:r},w=function(){return{version:"2.0.21",registerI18N:function(n,t,i){y[n]=t;i&&(r=t)},setI18N:function(n){var t=y[n];if(!t)throw new Error("Beetle could not find translation for "+n);r=t},helper:t,Assert:u,libs:h,baseTypes:i,impls:c,metadata:l,querying:o,core:e,services:v,enums:f,events:a,settings:s,MetadataManager:l.MetadataManager,EntityManager:e.EntityManager,EntityBase:e.EntityBase,EntitySet:e.EntitySet,WebApiService:v.WebApiService,MvcService:v.MvcService,Event:e.Event,Validator:e.Validator,ValueNotifyWrapper:e.ValueNotifyWrapper,TrackableArray:e.TrackableArray,entityStates:f.entityStates,mergeStrategy:f.mergeStrategy,executionStrategy:f.executionStrategy,arraySetBehaviour:f.arraySetBehaviour,serviceTypes:f.serviceTypes}}();return n.beetle=w,w})(this);