(function(n){"use strict";var t=function(){return{assertPrm:function(n,t){return new f(n,t)},combine:function(n,i){var r,e,u;if(n==i)return n;if(r={},n!=null)for(e in n)r[e]=n[e];if(i!=null)for(u in i){var s=r[u],o=i[u],h=f.isTypeOf(s,"object")&&f.isTypeOf(o,"object")?t.combine(s,o):o;r[u]=h}return r},objEquals:function(n,i){var u,e,r,o;if(n==i)return!0;if(n==null||i==null)return!1;if(f.isObject(n)&&f.isObject(i)){u=0;e=0;for(r in n){if(!i.hasOwnProperty(r)||!t.objEquals(t.getValue(n,r),t.getValue(i,r)))return!1;u++}for(o in i)e++;return u==e}return!1},isCaseSensitive:function(n){var t=n&&n.isCaseSensitive;return t==null?s.isCaseSensitive:t},ignoreWhiteSpaces:function(n){var t=n&&n.ignoreWhiteSpaces;return t==null?s.ignoreWhiteSpaces:t},handleStrOptions:function(n,i){return n==null?n:(t.isCaseSensitive(i)||(n=n.toLowerCase()),t.ignoreWhiteSpaces(i)&&(n=n.trim()),n)},equals:function(n,i,r,u){return typeof n=="string"&&typeof i=="string"&&(n=t.handleStrOptions(n,u),i=t.handleStrOptions(i,u)),r?n===i:n==i},formatString:function(n){var t=arguments,i=RegExp("%([0-"+(arguments.length-1)+"])","g"),r=RegExp("{([0-"+(arguments.length-2)+"])}","g");return n.replace(i,function(n,i){return t[Number(i)+1]||""}).replace(r,function(n,i){return t[Number(i)+1]||""})},tryFreeze:function(n,t){var r,i;if(!n||!Object.freeze)return n;if(Object.freeze(n),t===!0)for(r in n)i=n[r],f.isArray(i)?this.tryFreezeArray(i,t):f.isObject(i)&&this.tryFreeze(i,t);return n},tryFreezeArray:function(n,t){if(n&&Object.freeze)for(var i=0;i<n.length;i++)this.tryFreeze(n[i],t)},indexOf:function(n,t,i){for(var r=i||0;r<n.length;r++)if(n[r]===t)return r;return-1},forEach:function(n,t){for(var r,i=0;i<n.length;i++)r=n[i],t.call(r,r,i)},forEachProperty:function(n,t){var i,r;for(i in n)i[0]!="$"&&((r=n[i],f.isFunction(r))||t(i,r))},findInArray:function(n,t,i){for(var r=0;r<n.length;r++)if(i){if(n[r][i]===t)return n[r]}else if(n[r]===t)return t;return null},filterArray:function(n,t){for(var r,u=[],i=0;i<n.length;i++)r=n[i],t(r)===!0&&u.push(r);return u},removeFromArray:function(n,t,i){var r=[],u;for(this.forEach(n,function(n,u){i?n[i]===t&&r.push(u):n===t&&r.push(u)}),u=r.length-1;u>=0;u--)n.splice(r[u],1);return r.length},mapArray:function(n,t){for(var r,u=[],i=0;i<n.length;i++)r=n[i],u.push(t.call(r,r,i));return u},createGuid:function(){function n(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()},inherit:function(n,t){var i=new Function;i.prototype=t.prototype;n.prototype=new i;n.prototype.constructor=n;n.baseClass=t.prototype},getValue:function(n,t){function e(n,t){var i=n.$tracker;return i?i.getValue(t):u.isObservable(n,t)?u.getValue(n,t):n[t]}var r;if(n==null)return undefined;var u=s.getObservableProvider(),f=t.trim().split("."),i=n;for(r=0;r<f.length;r++)if(i=e(i,f[r]),i==null)break;return i},getResourceValue:function(n,t){var i=s.getLocalizeFunction();return i&&n&&i(n)||t},createValidationError:function(n,i,r,u,f){var e={entity:n,message:u,validator:f};return i&&(e.value=i),r&&(e.property=r),t.tryFreeze(e),e},createError:function(n,i,r){var u=null,e=null,o,s;if(f.isArray(i)?(u=i,e=r):f.isObject(i)&&(e=i),u&&u.length>0&&(u.splice(0,0,n),n=t.formatString.apply(null,u)),o=new Error(n),e)for(s in e)o[s]=e[s];return a.error.notify(o),o},setForeignKeys:function(n,t,i){for(var u,f,e,o,r=0;r<t.foreignKeys.length;r++)u=t.foreignKeys[r],f=n.$tracker,i?(e=t.entityType.keys[r],o=i.$tracker.getValue(e.name),f.setValue(u.name,o)):f.setValue(u.name,u.getDefaultValue())},jsepToODataQuery:function(n,i){var k,l,a,v,d,g,ut,f,c,p,rt,w,b,ft;if(i?i.aliases||(i.aliases=[]):i={aliases:[]},n.type=="LogicalExpression"||n.type=="BinaryExpression"){if(n.operator=="=>")throw t.createError(r.odataDoesNotSupportAlias);if(k=u.langOperators.find(n.operator).oData,!k)throw t.createError(r.operatorNotSupportedForOData,[n.operator],{expression:n});return"("+t.jsepToODataQuery(n.left,i)+" "+k+" "+t.jsepToODataQuery(n.right,i)+")"}if(n.type=="UnaryExpression")return n.operator+t.jsepToODataQuery(n.argument,i);if(n.type=="Identifier"){if(l=n.name,l[0]=="@"){if(a=undefined,v=l.slice(1),i.expVarContext&&i.expVarContext[v]!==undefined?a=i.expVarContext[v]:i.varContext&&(a=i.varContext[v]),a===undefined)throw t.createError(r.unknownParameter,[l],{expression:n,queryContext:i});return e.dataTypes.toODataValue(a)}return(d=t.findInArray(i.aliases,l,"alias"),d)?d.value:l}if(n.type=="Literal")return e.dataTypes.toODataValue(n.value);if(n.type=="MemberExpression")return i.currentAlias&&n.object.name==i.currentAlias.alias?n.property.name:(g=t.findInArray(i.aliases,n.object.name,"alias"),ut=g?g.value:t.jsepToODataQuery(n.object,i),ut+"/"+n.property.name);if(n.type=="Compound"){for(f=[],c=0;c<n.body.length;c++){var nt=n.body[c],tt=t.jsepToODataQuery(nt,i),it=tt.toLowerCase();if(it=="desc"||it=="asc"){if(f.length==0)throw t.createError(r.invalidStatement,{expression:n,statement:nt});f[f.length-1]+=" "+tt}else if(it=="as"){if(f.length==0||n.body.length<c+1)throw t.createError(r.invalidStatement,{expression:n,statement:nt});f[f.length-1]+=" as "+n.body[c+1].name;c++}else f.push(tt)}return f.join(", ")}if(n.type=="CallExpression"){var s=n.arguments,y=[],h=null;for(s.length==1&&s[0]&&s[0].type=="BinaryExpression"&&s[0].operator=="=>"&&(h={alias:s[0].left.name},h.value=h.alias,s=[s[0].right]),h&&(i.currentAlias=h,i.aliases.push(h)),p=0;p<s.length;p++)rt=s[p],rt!=null&&y.push(t.jsepToODataQuery(rt,i));if(n.callee.type=="MemberExpression"?(y.splice(0,0,t.jsepToODataQuery(n.callee.object,i)),w=n.callee.property.name):w=n.callee.name,b=o.queryFuncs.getFunc(w),b.needsAlias==!0)if(h)y.splice(0,0,h);else throw t.createError(r.functionNeedsAlias,[w],{expression:n});return ft=b.toODataFunction.apply(b,y),h&&(i.currentAlias=null,i.aliases.pop()),ft}throw t.createError(r.unknownExpression,{expression:n});},jsepToBeetleQuery:function(n,i){var rt,ut,l,a,v,p,w,ft,f,h,y,nt,tt,it,et;if(i?i.aliases||(i.aliases=[]):i={aliases:[]},n.type=="LogicalExpression"||n.type=="BinaryExpression")return n.operator=="=>"?(i.aliases.push({alias:n.left.name,value:"it"}),rt=t.jsepToBeetleQuery(n.right,i),i.aliases.pop(),rt):(ut=u.langOperators.find(n.operator).code,"("+t.jsepToBeetleQuery(n.left,i)+" "+ut+" "+t.jsepToBeetleQuery(n.right,i)+")");if(n.type=="UnaryExpression")return n.operator+t.jsepToBeetleQuery(n.argument,i);if(n.type=="Identifier"){if(l=n.name,l[0]=="@"){if(a=undefined,v=l.slice(1),i.expVarContext&&i.expVarContext[v]!==undefined?a=i.expVarContext[v]:i.varContext&&(a=i.varContext[v]),a===undefined)throw t.createError(r.unknownParameter,[l],{expression:n,queryContext:i});return e.dataTypes.toBeetleValue(a)}return(p=t.findInArray(i.aliases,l,"alias"),p)?p.value:l}if(n.type=="Literal")return e.dataTypes.toBeetleValue(n.value);if(n.type=="MemberExpression")return i.currentAlias&&n.object.name==i.currentAlias.alias?n.property.name:(w=t.findInArray(i.aliases,n.object.name,"alias"),ft=w?w.value:t.jsepToBeetleQuery(n.object,i),ft+"."+n.property.name);if(n.type=="Compound"){for(f=[],h=0;h<n.body.length;h++){var b=n.body[h],k=t.jsepToBeetleQuery(b,i),d=k.toLowerCase();if(d=="desc"||d=="asc"){if(f.length==0)throw t.createError(r.invalidStatement,{expression:n,statement:b});f[f.length-1]+=" "+k}else if(d=="as"){if(f.length==0||n.body.length<h+1)throw t.createError(r.invalidStatement,{expression:n,statement:b});f[f.length-1]+=" as "+n.body[h+1].name;h++}else f.push(k)}return f.join(", ")}if(n.type=="CallExpression"){var s=n.arguments,g=[],c=null;for(s.length==1&&s[0]&&s[0].type=="BinaryExpression"&&s[0].operator=="=>"&&(c={alias:s[0].left.name},c.value=c.alias,s=[s[0].right]),c&&(i.currentAlias=c,i.aliases.push(c)),y=0;y<s.length;y++)nt=s[y],nt!=null&&g.push(t.jsepToBeetleQuery(nt,i));return n.callee.type=="MemberExpression"?(g.splice(0,0,t.jsepToBeetleQuery(n.callee.object,i)),tt=n.callee.property.name):tt=n.callee.name,it=o.queryFuncs.getFunc(tt),et=it.toBeetleFunction.apply(it,g),c&&(i.currentAlias=null,i.aliases.pop()),et}throw t.createError(r.unknownExpression,{expression:n});},jsepToFunction:function(n,i){return function(f){var nt,it,rt,e,v,y,w,b,k,l,d,c,a,g;if(i?i.aliases||(i.aliases=[]):i={aliases:[]},i.currentAlias&&(i.currentAlias.value=f),n.type===undefined)return f;if(n.type=="LogicalExpression"||n.type=="BinaryExpression"){if(n.operator=="=>")return i.currentAlias&&i.aliases.push(i.currentAlias),i.currentAlias={alias:n.left.name},nt=t.jsepToFunction(n.right,i)(f),i.currentAlias=i.aliases.pop(),nt;var ut=u.langOperators.find(n.operator),tt=i.varContext,ft=function(){return t.jsepToFunction(n.left,i)(f)},et=function(){return t.jsepToFunction(n.right,i)(f)};return ut.asFunc.call(tt,ft,et)}if(n.type=="UnaryExpression")return it=function(){return t.jsepToFunction(n.argument,i)(f)},rt=u.langOperators.find(n.operator),rt.asFunc.call(tt,it);if(n.type=="Identifier"){if(e=n.name,e=="null")return null;if(e=="true")return!0;if(e=="false")return!1;if(e[0]=="@"){if(v=undefined,y=e.slice(1),i.expVarContext&&i.expVarContext[y]!==undefined?v=i.expVarContext[y]:i.varContext&&(v=i.varContext[y]),v===undefined)throw t.createError(r.unknownParameter,[e],{expression:n,queryContext:i});return v}return i.currentAlias&&i.currentAlias.alias==e?f:(w=t.findInArray(i.aliases,e,"alias"),w)?w.value:(b=t.getValue(f,e),b===undefined)?window[e]:b}if(n.type=="Literal")return n.value;if(n.type=="MemberExpression"){if(n.object.name){if(i.currentAlias&&n.object.name==i.currentAlias.alias)return t.getValue(f,n.property.name);if(k=t.findInArray(i.aliases,n.object.name,"alias"),k)return t.getValue(k.value,n.property.name)}return t.getValue(t.jsepToFunction(n.object,i)(f),n.property.name)}if(n.type=="CallExpression"){var s=n.arguments,h=[],p=null;if(s.length==1&&s[0]&&s[0].type=="BinaryExpression"&&s[0].operator=="=>"&&(p=s[0].left.name,s=[s[0].right]),p&&(i.currentAlias&&i.aliases.push(i.currentAlias),i.currentAlias={alias:p}),t.forEach(s,function(n){n!=null&&h.push(t.jsepToFunction(n,i))}),l=n.callee.type=="MemberExpression"?n.callee.property.name:n.callee.name,c=o.queryFuncs.getFunc(l,!1),c)n.callee.type=="MemberExpression"&&h.splice(0,0,t.jsepToFunction(n.callee.object,i)),h.splice(0,0,f),d=c.impl.apply(i,h);else{if(l[0]=="@")if(a=l.slice(1),i.expVarContext&&i.expVarContext[a])c=i.expVarContext[a];else if(i.varContext&&i.varContext[a])c=i.varContext[a];else throw t.createError(r.unknownParameter,[a],{expression:n,queryContext:i});else if(g=n.callee.type=="MemberExpression"?t.jsepToFunction(n.callee.object,i)(f):window,g==null||(c=g[l])==null)throw t.createError(r.unknownFunction,[l]);h=t.mapArray(h,function(){return this(f)});d=c.apply(i,h)}return p&&(i.currentAlias=i.aliases.pop()),d}throw t.createError(r.unknownExpression,{expression:n});}},jsepToProjector:function(n,i){var h=[],u,e,o,s;for(f.isArray(n)||(n=[n]),u=0;u<n.length;u++){e=null;o=n[u];switch(o.type){case"Identifier":e=o.name;break;case"MemberExpression":e=o.property.name}if(n.length>u+2&&n[u+1].name&&n[u+1].name.toLowerCase()=="as"){if(u=u+2,s=n[u],s.type!="Identifier")throw t.createError(r.invalidPropertyAlias,{expressions:n,aliasExpression:s});e=s.name}if(n.length>1&&!e)throw t.createError(r.projectionsMustHaveAlias,{expressions:n,expression:o});h.push({p:e,func:t.jsepToFunction(o,i)})}return function(t){for(var r,u,f={},i=0;i<h.length;i++){if(r=h[i],u=r.func(t),n.length==1)return u;f[r.p]=u}return f}}}}(),f=function(){var n=function(n,i){this.value=n;this.name=i;this.errors=[];t.tryFreeze(this)},i=n.prototype;return i.hasValue=function(){return n.hasValue(this.value,this.errors,this.name),this},i.isObject=function(){return n.isObject(this.value,this.errors,this.name),this},i.isFunction=function(){return n.isFunction(this.value,this.errors,this.name),this},i.isNotEmptyString=function(){return n.isNotEmptyString(this.value,this.errors,this.name),this},i.isTypeOf=function(t){return n.isTypeOf(this.value,t,this.errors,this.name),this},i.isArray=function(){return n.isArray(this.value,this.errors,this.name),this},i.isEnum=function(t){return n.isEnum(this.value,t,this.errors,this.name),this},i.isInstanceOf=function(t){return n.isInstanceOf(this.value,t,this.errors,this.name),this},i.check=function(){if(this.errors.length>0)throw t.createError(this.errors.join("\n"),{name:this.name,value:this.value});},n.hasValue=function(n,i,u){return n==null?(i&&i.push(t.formatString(r.valueCannotBeNull,u)),!1):!0},n.isObject=function(n,i,u){return n==null||!e.dataTypes.object.isValid(n)?(i&&i.push(t.formatString(r.typeError,u,"object")),!1):!0},n.isFunction=function(n,i,u){return n==null||!e.dataTypes.function.isValid(n)?(i&&i.push(t.formatString(r.typeError,u,"function")),!1):!0},n.isNotEmptyString=function(i,u,f){return i==null||i===""||!n.isTypeOf(i,"string",u)?(u&&u.push(t.formatString(r.cannotBeEmptyString,f)),!1):!0},n.isTypeOf=function(i,u,f,o){if(!n.hasValue(i))return!1;var s=e.dataTypes.byName(u);return s.isValid(i)?!0:(f&&f.push(t.formatString(r.typeMismatch,o,u,s,i)),!1)},n.isArray=function(n,i,u){return n==null||!e.dataTypes.array.isValid(n)?(i&&i.push(t.formatString(r.typeError,u,"array")),!1):!0},n.isEnum=function(n,i,u){return i.contains(n)?!0:(u&&u.push(t.formatString(r.invalidEnumValue,i,n)),!1)},n.isInstanceOf=function(n,i,u,f){return n==null?(u&&u.push(r.cannotCheckInstanceOnNull),!1):(n instanceof i)?!0:(u&&u.push(t.formatString(r.instanceError,f,i)),!1)},n}(),h=function(){var i={};return i.enums=function(){function r(n,t){for(var i in t)n[i]=t[i];return n}function n(n,i){this.name=n;i&&r(this,i);t.tryFreeze(this)}n.prototype={};n.prototype.constructor=n;n.prototype.toString=function(){return this.name};t.tryFreeze(n.prototype);var i=function(i){var u=this,r;if(arguments.length===1&&i!==null&&typeof i=="object")for(r in i)u[r]=new n(r,i[r]);else t.forEach(arguments,function(t){u[t]=new n(t)});t.tryFreeze(this)};return i.prototype.symbols=function(){var t=[],i,n;for(i in this)(n=this[i],f.isFunction(n))||t.push(n);return t},i.prototype.contains=function(t){return(t instanceof n)?this[t.name]===t:!1},i}(),i.jsep=function(t){var a="Compound",k="Identifier",v="MemberExpression",h="Literal",d="ThisExpression",g="CallExpression",nt="UnaryExpression",tt="BinaryExpression",it="LogicalExpression",u=!0,f={"-":u,"!":u,"~":u,"+":u},r={"=>":0,"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},s=function(n){var t=0,i;for(var r in n)(i=r.length)>t&&n.hasOwnProperty(r)&&(t=i);return t},c=s(f),e=s(r),y={"true":!0,"false":!1,"null":null},rt="this",p=function(n){return r[n]||0},w=function(n,t,i){var r=n==="||"||n==="&&"?it:tt;return{type:r,operator:n,left:t,right:i}},o=function(n){return n>=48&&n<=57},l=function(n){return n===36||n===95||n===64||n>=65&&n<=90||n>=97&&n<=122},ut=function(n){return n===36||n===95||n>=65&&n<=90||n>=97&&n<=122||n>=48&&n<=57},i=function(n){for(var t=0,ct=n.charAt,lt=n.charCodeAt,i=function(t){return ct.call(n,t)},u=function(t){return lt.call(n,t)},b=n.length,s=function(){for(var n=u(t);n===32||n===9;)n=u(++t)},ot=function(){s();for(var i=n.substr(t,e),u=i.length;u>0;){if(r.hasOwnProperty(i))return t+=u,i;i=i.substr(0,--u)}return!1},tt=function(){var r,i,o,n,s,f,e,u;if(f=it(),i=ot(),!i)return f;if(s={value:i,prec:p(i)},e=it(),!e)throw new Error("Expected expression after "+i+" at character "+t);for(n=[f,s,e];i=ot();){if(o=p(i),o===0)break;for(s={value:i,prec:o};n.length>2&&o<=n[n.length-2].prec;)e=n.pop(),i=n.pop().value,f=n.pop(),r=w(i,f,e),n.push(r);if(r=it(),!r)throw new Error("Expected expression after "+i+" at character "+t);n.push(s);n.push(r)}for(u=n.length-1,r=n[u];u>1;)r=w(n[u-1].value,n[u-2],r),u-=2;return r},it=function(){var i,r,e;if(s(),i=u(t),o(i)||i===46)return at();if(i===39||i===34)return vt();if(l(i))return pt();if(i===40)return wt();for(r=n.substr(t,c),e=r.length;e>0;){if(f.hasOwnProperty(r))return t+=e,{type:nt,operator:r,argument:it(),prefix:!0};r=r.substr(0,--e)}return!1},at=function(){for(var n="";o(u(t));)n+=i(t++);if(i(t)===".")for(n+=i(t++);o(u(t));)n+=i(t++);if(i(t)==="e"||i(t)==="E"){for(n+=i(t++),(i(t)==="+"||i(t)==="-")&&(n+=i(t++));o(u(t));)n+=i(t++);if(!o(u(t-1)))throw new Error("Expected exponent ("+n+i(t)+") at character "+t);}if(l(u(t)))throw new Error("Variable names cannot start with a number ("+n+i(t)+") at character "+t);return{type:h,value:parseFloat(n),raw:n}},vt=function(){for(var n="",u=i(t++),f=!1,r;t<b;)if(r=i(t++),r===u){f=!0;break}else if(r==="\\"){r=i(t++);switch(r){case"n":n+="\n";break;case"r":n+="\r";break;case"t":n+="\t";break;case"b":n+="\b";break;case"f":n+="\f";break;case"v":n+="\x0b"}}else n+=r;if(!f)throw new Error('Unclosed quote after "'+n+'"');return{type:h,value:n,raw:u+n+u}},st=function(){var f=u(t),e=t,r;if(l(f))t++;else throw new Error("Unexpected "+i(t)+"at character "+t);while(t<b)if(f=u(t),ut(f))t++;else break;return r=n.slice(e,t),y.hasOwnProperty(r)?{type:h,value:y[r],raw:r}:r===rt?{type:d}:{type:k,name:r}},yt=function(){for(var r,u=[],n;t<b;)if(s(),r=i(t),r===")"){t++;break}else if(r===",")t++;else{if(n=tt(),!n||n.type===a)throw new Error("Expected comma at character "+t);u.push(n)}return u},pt=function(){var n,r,u;for(r=st(),s(),n=i(t);n==="."||n==="["||n==="(";){if(n===".")t++,s(),r={type:v,computed:!1,object:r,property:st()};else if(n==="["){if(u=t,t++,r={type:v,computed:!0,object:r,property:tt()},s(),n=i(t),n!=="]")throw new Error("Unclosed [ at character "+t);t++;s()}else n==="("&&(t++,r={type:g,arguments:yt(),callee:r});s();n=i(t)}return r},wt=function(){t++;var n=tt();if(s(),i(t)===")")return t++,n;throw new Error("Unclosed ( at character "+t);},ft=[],et,ht;t<b;)if(et=i(t),et===";"||et===",")t++;else if(ht=tt())ft.push(ht);else if(t<b)throw new Error("Unexpected '"+i(t)+"' at character "+t);return ft.length===1?ft[0]:{type:a,body:ft}},b;return i.version="0.2.8",i.toString=function(){return"JavaScript Expression Parser (JSEP) v"+i.version},i.addUnaryOp=function(n){return f[n]=u,this},i.addBinaryOp=function(n,t){return e=Math.max(n.length,e),r[n]=t,this},i.removeUnaryOp=function(n){return delete f[n],n.length===c&&(c=s(f)),this},i.removeBinaryOp=function(n){return delete r[n],n.length===e&&(e=s(r)),this},typeof n=="undefined"?(b=t.jsep,t.jsep=i,i.noConflict=function(){return t.jsep===i&&(t.jsep=b),i}):typeof module!="undefined"&&module.exports?n=module.exports=i:n.parse=i,i}(n),i}(),i=function(){return{dateConverterBase:function(){var n=function(n){this.name=n},i=n.prototype;return i.parse=function(){throw t.createError(r.notImplemented,["dateConverterBase","parse"]);},i.toISOString=function(){throw t.createError(r.notImplemented,["dateConverterBase","toISOString"]);},n}(),dataTypeBase:function(){var i=function(n){this.name=n||"dataTypeBase";this.isComplex=!1},n=i.prototype;return n.toString=function(){return this.name},n.getRawValue=function(n){return n},n.isValid=function(n){return typeof n===this.name},n.toODataValue=function(n){return n.toString()},n.toBeetleValue=function(n){return n.toString()},n.defaultValue=function(){throw t.createError(r.notImplemented,[this.name,"defaultValue"]);},n.autoValue=function(){throw t.createError(r.notImplemented,[this.name,"autoValue"]);},n.handle=function(){throw t.createError(r.notImplemented,[this.name,"handle"]);},i}(),expressionBase:function(){var i=function(n,t,i,r){this.name=n||"expressionBase";this.order=t;this.onlyBeetle=i;this.isProjection=r},n=i.prototype;return n.toString=function(){return this.toBeetleQuery({})},n.combine=function(){throw t.createError(r.notImplemented,[this.name,"combine"]);},n.toODataQuery=function(n){if(this.onlyBeetle===!0)return this.toBeetleQuery(n);throw t.createError(r.notImplemented,[this.name,"toODataQuery"]);},n.toBeetleQuery=function(){throw t.createError(r.notImplemented,[this.name,"toBeetleQuery"]);},n.clone=function(){throw t.createError(r.notImplemented,[this.name,"clone"]);},n.execute=function(){throw t.createError(r.notImplemented,[this.name,"execute"]);},i}(),queryFuncBase:function(){var i=function(n,t,i){this.name=n;this.beetleName=t;this.argCount=i},n=i.prototype;return n.toODataFunction=function(){for(var t=[],n=0;n<arguments.length;n++)t.push(arguments[n]);return this.name+"("+t.join(", ")+")"},n.toBeetleFunction=function(){var i="",n=0,t;for(arguments.length==this.argCount&&(i=arguments[0]+".",++n),t=[],n;n<arguments.length;n++)t.push(arguments[n]);return i+this.beetleName+"("+t.join(", ")+")"},n.impl=function(){throw t.createError(r.notImplemented,[this.name,"impl"]);},i}(),queryBase:function(){var u=function(){this.expressions=[];this.inlineCountEnabled=!1;this.lastExpOrder=0;this.isMultiTyped=!1;this.lastProjection=0;this.isClosed=!1;this.hasBeetlePrm=!1;this.options=null},n=u.prototype;return n.executeAfterExecuter=!1,n.toString=function(){var n=[],i;return t.forEach(this.parameters,function(t){n.push(t.name+": "+(t.value==null?"":t.value))}),this.inlineCountEnabled===!0&&n.push("inlinecount: allpages"),i={},t.forEach(this.expressions,function(t){n.push(t.name+": "+t.toBeetleQuery(i))}),n.join(", ")},n.addExpression=function(n){if(this.isClosed)throw t.createError(r.queryClosed,null,{query:this});if(t.assertPrm(n,"expression").isInstanceOf(i.expressionBase).check(),this.expressions.push(n),n.isExecuter===!0){var u=this.options&&this.options.executeAfterExecuter;if(u==null&&(u=this.executeAfterExecuter),u)return this.execute();this.isClosed=!0}return(n.order<this.lastExpOrder||this.hasBeetlePrm&&!n.onlyBeetle)&&(this.isMultiTyped=!0),n.isProjection===!0&&(this.lastProjection=this.expressions.length-1),n.onlyBeetle&&(this.hasBeetlePrm=!0),this},n.inlineCount=function(n){var t=this.clone();return t.inlineCountEnabled=n!==!1,t},n.ofType=function(n){var t=this.clone(),i=t.getExpression(o.expressions.ofTypeExp);return i?(i.combine(n),t):t.addExpression(new o.expressions.ofTypeExp(n))},n.clearWhere=function(){var n=this.clone();return n.removeExpression(o.expressions.whereExp)},n.where=function(){var n=this.clone(),t=n.getExpression(o.expressions.whereExp);return t==null?n.addExpression(new o.expressions.whereExp(arguments)):t.and(arguments),n},n.and=function(){var n=this.clone();return n.getExpression(o.expressions.whereExp,!0).and(arguments),n},n.or=function(){var n=this.clone();return n.getExpression(o.expressions.whereExp,!0).or(arguments),n},n.andGroup=function(){var n=this.clone(),t=n.getExpression(o.expressions.whereExp);return t?t.andGroup.apply(t,arguments):n=n.where.apply(n,arguments),n},n.orGroup=function(){var n=this.clone(),t=n.getExpression(o.expressions.whereExp);return t?t.orGroup.apply(t,arguments):n=n.where.apply(n,arguments),n},n.closeGroup=function(){var n=this.clone();return n.getExpression(o.expressions.whereExp,!0).closeGroup(),n},n.clearOrderBy=function(){var n=this.clone();return n.removeExpression(o.expressions.orderByExp)},n.orderBy=function(n,t){var i=this.clone(),r=i.getExpression(o.expressions.orderByExp);return r?(r.combine(n,t),i):i.addExpression(new o.expressions.orderByExp(n,t))},n.orderByDesc=function(n){return this.orderBy(n,!0)},n.select=function(n){var i=this.clone(),t;return arguments.length==1?(t=arguments[0],f.isArray(t)&&(n=t.join(", "))):n=Array.prototype.slice.call(arguments).join(", "),i.addExpression(new o.expressions.selectExp(n))},n.skip=function(n){var t=this.clone(),i=t.getExpression(o.expressions.skipExp);return i?(i.combine(n),t):t.addExpression(new o.expressions.skipExp(n))},n.take=function(n){return this.top(n)},n.top=function(n){var t=this.clone(),i=t.getExpression(o.expressions.topExp);return i?(i.combine(n),t):t.addExpression(new o.expressions.topExp(n))},n.groupBy=function(n,t){var i=this.clone();return f.isArray(n)&&(n=n.join(", ")),f.isArray(t)&&(t=t.join(", ")),i.addExpression(new o.expressions.groupByExp(n,t))},n.distinct=function(n){var t=this.clone();return f.isArray(n)&&(n=n.join(", ")),t.addExpression(new o.expressions.distinctExp(n))},n.reverse=function(){var n=this.clone();return n.addExpression(new o.expressions.reverseExp)},n.selectMany=function(n){var t=this.clone();return t.addExpression(new o.expressions.selectManyExp(n))},n.skipWhile=function(n,t){var i=this.clone();return i.addExpression(new o.expressions.skipWhileExp(n,t))},n.takeWhile=function(n,t){var i=this.clone();return i.addExpression(new o.expressions.takeWhileExp(n,t))},n.all=function(n,t){var i=this.clone();return i.addExpression(new o.expressions.allExp(n,t))},n.any=function(n,t){var i=this.clone();return i.addExpression(new o.expressions.anyExp(n,t))},n.avg=function(n){var t=this.clone();return t.addExpression(new o.expressions.avgExp(n))},n.max=function(n){var t=this.clone();return t.addExpression(new o.expressions.maxExp(n))},n.min=function(n){var t=this.clone();return t.addExpression(new o.expressions.minExp(n))},n.sum=function(n){var t=this.clone();return t.addExpression(new o.expressions.sumExp(n))},n.count=function(n,t){var i=this.clone();return i.addExpression(new o.expressions.countExp(n,t))},n.first=function(n,t){var i=this.clone();return i.addExpression(new o.expressions.firstExp(n,t))},n.firstOrDefault=function(n,t){var i=this.clone();return i.addExpression(new o.expressions.firstOrDefaultExp(n,t))},n.single=function(n,t){var i=this.clone();return i.addExpression(new o.expressions.singleExp(n,t))},n.singleOrDefault=function(n,t){var i=this.clone();return i.addExpression(new o.expressions.singleOrDefaultExp(n,t))},n.last=function(n,t){var i=this.clone();return i.addExpression(new o.expressions.lastExp(n,t))},n.lastOrDefault=function(n,t){var i=this.clone();return i.addExpression(new o.expressions.lastOrDefaultExp(n,t))},n.withOptions=function(n){var i=this.clone();return i.options=t.combine(this.options,n),i},n.execute=function(){throw t.createError(r.notImplemented,["Query","execute"]);},n.x=function(){return this.execute.apply(this,arguments)},n.toFunction=function(){var n=this;return function(i,r){var u={varContext:r};return u.aliases=[],n.inlineCountEnabled&&(u.inlineCount=i.length),t.forEach(n.expressions,function(t){u.expVarContext=t.varContext;i=t.execute(i,u);!n.inlineCountEnabled||f.isInstanceOf(t,o.expressions.topExp)||f.isInstanceOf(t,o.expressions.skipExp)||(u.inlineCount=i.length);u.expVarContext=undefined}),n.inlineCountEnabled&&(i.$inlineCount=u.inlineCount),i}},n.clone=function(){throw t.createError(r.notImplemented,["Query","clone"]);},n.copy=function(n){t.forEach(this.expressions,function(t){n.expressions.push(t.clone())});n.inlineCountEnabled=this.inlineCountEnabled;n.lastExpOrder=this.lastExpOrder;n.isMultiTyped=this.isMultiTyped;n.lastProjection=this.lastProjection;n.isClosed=this.isClosed;n.hasBeetlePrm=this.hasBeetlePrm;this.options&&(n.options=t.combine(null,this.options))},n.getExpression=function(n,i){for(var e,u=this.lastProjection;u<this.expressions.length;u++)if(e=this.expressions[u],f.isInstanceOf(e,n))return e;if(i===!0)throw t.createError(r.expressionCouldNotBeFound,{type:n,query:this});return null},n.removeExpression=function(n){for(var i,t=this.expressions.length-1;t>=0;t--)i=this.expressions[t],f.isInstanceOf(i,n)&&this.expressions.splice(t,1);return this},u}(),observableProviderBase:function(){var i=function(n){this.name=n||"observableProviderBase"},n=i.prototype;return n.toString=function(){return this.name},n.isObservable=function(){throw t.createError(r.notImplemented,[this.name,"isObservable"]);},n.toObservable=function(){throw t.createError(r.notImplemented,[this.name,"toObservable"]);},n.getValue=function(){throw t.createError(r.notImplemented,[this.name,"getValue"]);},n.setValue=function(){throw t.createError(r.notImplemented,[this.name,"setValue"]);},i}(),ajaxProviderBase:function(){var n=function(n){this.name=n||"ajaxProviderBase"},i=n.prototype;return i.toString=function(){return this.name},i.doAjax=function(){throw t.createError(r.notImplemented,[this.name,"doAjax"]);},n}(),serializationServiceBase:function(){var i=function(n){this.name=n||"serializationServiceBase"},n=i.prototype;return n.toString=function(){return this.name},n.serialize=function(){throw t.createError(r.notImplemented,[this.name,"serialize"]);},n.deserialize=function(){throw t.createError(r.notImplemented,[this.name,"deserialize"]);},i}(),promiseProviderBase:function(){var i=function(n){this.name=n||"promiseProviderBase"},n=i.prototype;return n.toString=function(){return this.name},n.deferred=function(){throw t.createError(r.notImplemented,[this.name,"deferred"]);},n.getPromise=function(){throw t.createError(r.notImplemented,[this.name,"getPromise"]);},n.resolve=function(){throw t.createError(r.notImplemented,[this.name,"resolve"]);},n.reject=function(){throw t.createError(r.notImplemented,[this.name,"reject"]);},i}(),dataServiceBase:function(){function a(n,e,o,s){var v,w;n==null?n="":n[n.length-1]!="/"&&(n+="/");s.uri=n;var h=null,a=null,y=null,p=null;if(o&&(h=o.ajaxProvider,a=o.serializationService,y=o.dataType,p=o.dataType),s.ajaxProvider=h&&f.isInstanceOf(h,i.ajaxProviderBase)?h:l.jQueryAjaxProviderInstance,s.serializationService=a&&f.isInstanceOf(a,i.SerializationService)?a:l.jsonSerializationServiceInstance,!(e===!0))if(e){if(f.isInstanceOf(e,c.metadataManager))s.metadataManager=e;else if(f.isObject(e))try{s.metadataManager=new c.metadataManager(e)}catch(b){throw t.createError(r.invalidArguments,{exception:b,args:arguments,dataService:this});}}else v=t.findInArray(u,n,"uri"),v?s.metadataManager=v.data:(w=s.fetchMetadata(),s.metadataManager=new c.metadataManager(w),u.push({uri:n,data:s.metadataManager}));s.dataType=y||"json";s.contentType=p||"application/json; charset=utf-8"}var u=[],h=function(n,t,i){a(n,t,i,this)},n=h.prototype;return n.toString=function(){return this.uri},n.getEntityType=function(n){return this.metadataManager?this.metadataManager.getEntityTypeByShortName(n):null},n.createQuery=function(n,i,r){return(t.assertPrm(n,"resourceName").isNotEmptyString().check(),i)?this.createEntityQuery(i,n,r):(this.metadataManager&&this.metadataManager.createQuery(n,null,r),new o.entityQuery(n,null,r))},n.createEntityQuery=function(n,i,u){if(t.assertPrm(n,"shortName").isNotEmptyString().check(),!this.metadataManager)throw t.createError(r.noMetadataEntityQuery,{dataService:this});return this.metadataManager.createQuery(i,n,u)},n.registerCtor=function(n,i,u){if(this.metadataManager==null)throw t.createError(r.noMetadataEntityQuery);this.metadataManager.registerCtor(n,i,u)},n.createEntity=function(n,i){if(!this.metadataManager)throw t.createError(r.noMetadataEntityQuery,{dataService:this});return this.metadataManager.createEntity(n,i)},n.createRawEntity=function(n,i){if(!this.metadataManager)throw t.createError(r.noMetadataEntityQuery,{dataService:this});return this.metadataManager.createRawEntity(n,i)},n.toEntity=function(n,t){var i=null;return this.metadataManager&&(i=this.metadataManager.getEntityType(t)),i||(i=new c.entityType(t)),e.entityTracker.toEntity(n,i,s.getObservableProvider())},n.toODataQueryParams=function(n,i){if(n.isMultiTyped===!0)throw t.createError(r.oDataNotSupportMultiTyped,{query:n});var u={varContext:i},f=[];return t.forEach(n.parameters,function(n){f.push({name:n.name,value:n.value==null?"":n.value})}),n.inlineCountEnabled===!0&&f.push({name:"$inlinecount",value:"allpages"}),t.forEach(n.expressions,function(n,t){u.expVarContext=n.varContext;var r,i;n.onlyBeetle===!0?(r="!e"+t,i=n.toBeetleQuery(u),i=n.name+":"+i):(r="$"+n.name,i=n.toODataQuery(u));f.push({name:r,value:i});u.expVarContext=undefined}),f},n.toBeetleQueryParams=function(n,i){var u={varContext:i},r=[];return t.forEach(n.parameters,function(n){r.push({name:n.name,value:n.value==null?"":n.value})}),n.inlineCountEnabled===!0&&r.push({name:"!e0",value:"inlinecount:allpages"}),t.forEach(n.expressions,function(n,t){u.expVarContext=n.varContext;r.push({name:"!e"+(t+1),value:n.name+":"+n.toBeetleQuery(u)});u.expVarContext=undefined}),r},n.fetchMetadata=function(){throw t.createError(r.notImplemented,["dataServiceBase","fetchMetadata"]);},n.createEntityAsync=function(){throw t.createError(r.notImplemented,["dataServiceBase","createEntityAsync"]);},n.executeQuery=function(){throw t.createError(r.notImplemented,["dataServiceBase","executeQuery"]);},n.executeQueryParams=function(){throw t.createError(r.notImplemented,["dataServiceBase","executeQueryParams"]);},n.saveChanges=function(){throw t.createError(r.notImplemented,["dataServiceBase","saveChanges"]);},h}()}}(),l=function(){return{defaultDateConverterInstance:function(){var n=function(){i.dateConverterBase.call(this,"Default Date Converter")},r;return t.inherit(n,i.dateConverterBase),r=n.prototype,r.parse=function(n){if(typeof n!="string"||n.length<10||!/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])$/.test(n.substr(0,10)))return null;/.\d{3}$/.test(n)&&(n+="Z");try{var t=Date.parse(n);return isNaN(t)?null:new Date(t)}catch(i){return null}},r.toISOString=function(n){return n.toISOString()},new n}(),koObservableProviderInstance:function(n){var u,r;return n&&(n.extenders.intercept=function(t,i){return n.computed({read:t,write:function(n){var r=i&&i.callback;r&&r(i.object,i.property,t,n)}})}),u=function(){i.observableProviderBase.call(this,"Knockout Observable Provider");t.tryFreeze(this)},t.inherit(u,i.observableProviderBase),r=u.prototype,r.isObservable=function(t,i){return n.isObservable(t[i])},r.toObservable=function(i,r,u){function s(t,r,u){var f=n.observable(r);return u?n.observable(r).extend({intercept:{object:i,property:t,callback:u}}):f}function c(t,r,u,f,o){var s;return u=u||[],f&&(u=new e.trackableArray(u,i,t,function(n,t,u,e,o){s.$fromKo!==!0&&i[r].valueHasMutated();s.$fromKo=!1;f(n,t,u,e,o)})),s=n.observableArray(u),s.subscribe(function(){s.$fromKo=!0},null,"beforeChange"),o&&(s.equalityComparer=function(n,r){o(i,t,n,r)}),s}var l=u&&u.propertyChange,a=u&&u.arrayChange,v=u&&u.dataPropertyChange,y=u&&u.scalarNavigationPropertyChange,p=u&&u.pluralNavigationPropertyChange,h=u&&u.arraySet,o=[];t.forEachProperty(i,function(n,t){o.push({p:n,v:t})});r&&r.hasMetadata&&(t.forEach(r.dataProperties,function(n){var r=i[n.name];r=r===undefined?null:n.handle(r);i[n.name]=s(n,r,v);t.removeFromArray(o,n.name,"p")}),t.forEach(r.navigationProperties,function(n){var r=i[n.name];r===undefined&&(r=null);i[n.name]=n.isScalar?s(n,r,y):c(n,n.name,r,p,h);t.removeFromArray(o,n.name,"p")}));t.forEach(o,function(n){var u=n.p,e=n.v;i[u]=f.isArray(e)?c(u,u,e,a,h):s(u,e,l);t.findInArray(r.properties,u)||r.properties.push(u)})},r.getValue=function(t,i){return n.utils.unwrapObservable(t[i])},r.setValue=function(n,t,i){n[t](i)},new u}(n.ko),propertyObservableProviderInstance:function(){var r=function(){i.observableProviderBase.call(this,"Property Observable Provider");t.tryFreeze(this)},n;return t.inherit(r,i.observableProviderBase),n=r.prototype,n.isObservable=function(n,t){return n.$fields!==undefined&&n.$fields[t]!==undefined},n.toObservable=function(n,i,r){function s(t,i,r){return Object.defineProperty(n,i,{get:function(){return n.$fields[i]},set:function(u){if(r){var f=w(n,i);r(n,t,f,u)}else n.$fields[i]=u},enumerable:!0,configurable:!0})}function c(t,i,r,f,o){return r=r||[],f&&(r=new e.trackableArray(r,n,t,f)),u[i]=r,Object.defineProperty(n,i,{get:function(){return n.$fields[i]},set:function(r){o?o(n,t,items,r):n.$fields[i]=r}})}function w(n,t){return function(){return arguments.length==0?n.$fields[t]:n.$fields[t]=arguments[0]}}var l=r&&r.propertyChange,a=r&&r.arrayChange,v=r&&r.dataPropertyChange,y=r&&r.scalarNavigationPropertyChange,p=r&&r.pluralNavigationPropertyChange,h=r&&r.arraySet,u={},o=[];return t.forEachProperty(n,function(n,t){o.push({p:n,v:t})}),i&&i.hasMetadata&&(t.forEach(i.dataProperties,function(i){var r=n[i.name];r=r===undefined?null:i.handle(r);delete n[i.name];s(i,i.name,v);t.removeFromArray(o,i.name,"p");u[i.name]=r}),t.forEach(i.navigationProperties,function(i){var r=n[i.name];r===undefined&&(r=null);delete n[i.name];i.isScalar?(s(i,i.name,y),u[i.name]=r):c(i,i.name,r,p,h);t.removeFromArray(o,i.name,"p")})),t.forEach(o,function(r){var e=r.p,o=r.v;delete n[e];f.isArray(o)?c(e,e,o,a,h):(s(e,e,l),u[e]=o);t.findInArray(i.properties,e)||i.properties.push(e)}),n.$fields=u,n},n.getValue=function(n,t){return n[t]},n.setValue=function(n,t,i){n[t]=i},new r}(),backboneObservableProviderInstance:function(){var n=function(){i.observableProviderBase.call(this,"Backbone Observable Provider");t.tryFreeze(this)};return t.inherit(n,i.observableProviderBase),new n}(),jQueryAjaxProviderInstance:function(n){function f(n){var i={status:n.status,xhr:n};if(n.responseText)try{i.detail=JSON.parse(n.responseText)}catch(r){}return t.createError(n.statusText,i)}var r=function(){i.ajaxProviderBase.call(this,"jQuery Ajax Provider");t.tryFreeze(this)},u;return t.inherit(r,i.ajaxProviderBase),u=r.prototype,u.doAjax=function(t,i,r,u,e,o,s,h,c,l){var a={url:t,accepts:{json:"application/json; odata=verbose",xml:"text/xml; application/xhtml+xml;application/xml",text:"text/xml"},type:i,dataType:r,contentType:u,traditional:!1,data:e,cache:!1,async:o,timeout:s,success:function(n,t,i){if(i.onreadystatechange=null,i.abort=null,n&&n.Error){var r=f(i);r.message=n.Error;l(r)}else c(n,i)},error:function(n){n.onreadystatechange=null;n.abort=null;l(f(n))}};return h!=null&&n.extend(a,h),n.ajax(a)},new r}(n.$),jsonSerializationServiceInstance:function(){var n=function(){i.serializationServiceBase.call(this,"Json Serializer");t.tryFreeze(this)},r;return t.inherit(n,i.serializationServiceBase),r=n.prototype,r.serialize=function(n){return JSON.stringify(n)},r.deserialize=function(n){return f.isTypeOf(n,"string")?JSON.parse(n):n},new n}(),qPromiseProviderInstance:function(n){var u=function(){i.promiseProviderBase.call(this,"Q Promise Provider");t.tryFreeze(this)},r;return t.inherit(u,i.promiseProviderBase),r=u.prototype,r.toString=function(){return this.name},r.deferred=function(){return n.defer()},r.getPromise=function(n){return n.promise},r.resolve=function(n,t){n.resolve(t)},r.reject=function(n,t){n.reject(t)},new u}(n.Q),jQueryPromiseProviderInstance:function(n){var u=function(){i.promiseProviderBase.call(this,"jQuery Promise Provider");t.tryFreeze(this)},r;return t.inherit(u,i.promiseProviderBase),r=u.prototype,r.toString=function(){return this.name},r.deferred=function(){return n.Deferred()},r.getPromise=function(n){return n.promise()},r.resolve=function(n,t){n.resolve(t)},r.reject=function(n,t){n.reject(t)},new u}(n.$)}}(),c=function(){return{dataProperty:function(){var i=function(n,t,i,r,u,f,o,s,h){this.owner=n;this.name=t;this.displayName=i||t;this.dataType=r;this.isNullable=u;this.isKeyPart=f;this.generationPattern=o;this.defaultValue=s;this.useForConcurrency=h;this.relatedNavigationProperties=[];this.validators=[];this.isEnum=r instanceof e.dataTypes.enum;this.isComplex=r.isComplex},n=i.prototype;return n.toString=function(){return this.displayName},n.isValid=function(n){return n==null?!this.isNullable:this.dataType.isValid(n,this)},n.handle=function(n){if(n==null){if(!this.isNullable)throw t.createError(r.notNullable,[this.displayName],{property:this});return null}if(n=this.dataType.handle(n,this),this.dataType==e.dataTypes.number&&this.precision&&n.toString().replace(/\./g,"").length>this.precision)throw t.createError(r.maxPrecisionError,[n,this.precision],{dataType:dataType,value:n});return this.dataType==e.dataTypes.number&&this.scale!=null&&(n=Number(n.toFixed(this.scale))),n},n.getDefaultValue=function(){return this.defaultValue?this.defaultValue:this.isNullable?null:this.generationPattern==u.generationPattern.Identity&&this.isKeyPart===!0?this.dataType.autoValue():this.dataType.defaultValue()},n.addValidation=function(n,i,r,u){t.assertPrm(n,"name").isNotEmptyString().check();t.assertPrm(i,"func").isFunction().check();this.validators.push(new e.validator(n,i,r,u))},n.validate=function(n){var u=[],i,r;return this.validators.length>0&&(i=this,r=t.getValue(n,i.name),t.forEach(this.validators,function(f){var e=f.validate(r,n);e&&u.push(t.createValidationError(n,r,i,e,f))})),u},i}(),navigationProperty:function(){var i=function(n,t,i,r,u,f,e,o){this.owner=n;this.name=t;this.displayName=i||t;this.entityTypeName=r;this.entityType=null;this.isScalar=u;this.isComplex=f===undefined;this.associationName=f;this.cascadeDelete=e===!0;this.foreignKeyNames=o||[];this.inverse=null;this.foreignKeys=[];this.validators=[];this.triggerOwnerModify=!1},n=i.prototype;return n.toString=function(){return this.displayName},n.checkAssign=function(n){if(n!=null){if(!n.$tracker)throw t.createError(r.assignErrorNotEntity,[this],{property:this,value:n});var i=n.$tracker.entityType;if(!this.entityType.isAssignableWith(i))throw t.createError(r.assignError,[this.name,i.shortName],{property:this,value:n});}},n.addValidation=function(n,i,r,u){t.assertPrm(n,"name").isNotEmptyString().check();t.assertPrm(i,"func").isFunction().check();this.validators.push(new e.validator(n,i,r,u))},n.validate=function(n){var u=[],i,r;return this.validators.length>0&&(i=this,r=t.getValue(n,i.name),t.forEach(this.validators,function(f){var e=f.validate(r);e&&u.push(t.createValidationError(n,r,i,e,f))})),u},i}(),entityType:function(){function u(n,t){n.baseType&&u(n.baseType,t);n.constructor&&n.constructor.call(t,t)}function a(n,i){for(var u,f,e,o=n.length,r=0;r<o;r++){if(u=n[r],r==o-1)return f=t.findInArray(i.dataProperties,u,"name"),f?f:t.findInArray(i.navigationProperties,u,"name");if(e=t.findInArray(i.navigationProperties,u,"name"),e)i=e.entityType;else return null}return null}function h(n,t){return n.name===t.name?!0:t.baseType!=null?h(n,t.baseType):!1}function l(n,t){var i=f.isTypeOf(t,"string")?t:t.name;return n.name===i?!0:n.baseType!=null?l(n.baseType,t):!1}var i=function(n,t,i,r,u,f,e,o,s){this.name=n;this.displayName=t||n;this.shortName=i;this.keyNames=r||[];this.baseTypeName=u;this.setName=f;this.setTypeName=e;this.metadataManager=s;this.hasMetadata=s!=null;this.properties=[];this.dataProperties=[];this.navigationProperties=[];this.keys=[];this.floorType=this;this.baseType=null;this.validators=[];this.isComplexType=o==!0;this.constructor=null;this.initializer=null},n=i.prototype;return n.toString=function(){return this.name},n.getProperty=function(n){return a(n.split("."),this)},n.createQuery=function(n,t){if(n)return new o.entityQuery(n,this,t);var i=new o.entityQuery(this.setName,this,t);return this.shortName==this.setTypeName?i:i.ofType(this.shortName)},n.registerCtor=function(n,i){n!=null&&t.assertPrm(n,"constructor").isFunction().check();i!=null&&t.assertPrm(i,"initializer").isFunction().check();this.constructor=n;this.initializer=i},n.createEntity=function(n){var t=this.createRawEntity(n);return e.entityTracker.toEntity(t,this,s.getObservableProvider())},n.createRawEntity=function(n){var i=n||{};return t.forEach(this.dataProperties,function(n){i[n.name]||(i[n.name]=n.getDefaultValue())}),t.forEach(this.navigationProperties,function(n){i[n.name]=n.isComplex?n.entityType.createRawEntity():n.isScalar?null:[]}),u(this,i),i.$type=this.name,i},n.isAssignableWith=function(n){return h(this,n)},n.isAssignableTo=function(n){return l(this,n)},n.hasSameBaseType=function(n){return this.floorType.name===n.floorType.name},n.addDataProperty=function(n,i,u,o,s){var h,l;if(t.assertPrm(n,"name").isNotEmptyString().check(),h=t.findInArray(this.dataProperties,n,"name"),h)throw t.createError(r.dataPropertyAlreadyExists,[n],{entityType:this,existing:h});if(f.isNotEmptyString(u)&&(u=e.dataTypes.byName(u)),t.assertPrm(u,"dataType").isInstanceOf(e.dataTypes.baseType).check(),s!=null&&!u.isValid(s))throw t.createError(r.invalidDefaultValue,[s,u.name],{entityType:this,dataType:u,defaultValue:s});l=new c.dataProperty(this,n,i,u,o===!0,!1,null,s);this.dataProperties.push(l)},n.addValidation=function(n,i,r,u){t.assertPrm(n,"name").isNotEmptyString().check();t.assertPrm(i,"func").isFunction().check();this.validators.push(new e.validator(n,i,r,u))},n.validate=function(n){var i=[];return this.validators.length>0&&t.forEach(this.validators,function(r){var u=r.validate(n);u&&i.push(t.createValidationError(n,null,null,u,r))}),t.forEach(this.dataProperties,function(t){var r=t.validate(n);r&&(i=i.concat(r))}),t.forEach(this.navigationProperties,function(t){var r=t.validate(n);r&&(i=i.concat(r))}),i},i}(),metadataManager:function(){var i=function(n){this.types=[];this.enums={};this.name=null;this.displayName=null;n&&this.parseBeetleMetadata(n)},n=i.prototype;return n.toString=function(){return this.types.join(", ")},n.getEntityType=function(n,i){var u=t.findInArray(this.types,n,"name");if(!u&&i===!0)throw t.createError(r.notFoundInMetadata,[n],{metadataManager:this,typeName:n});return u},n.getEntityTypeByShortName=function(n,i){var u=t.findInArray(this.types,n,"shortName");if(!u&&i===!0)throw t.createError(r.notFoundInMetadata,[n],{metadataManager:this,typeShortName:n});return u},n.createQuery=function(n,i,r){if(i)return this.getEntityTypeByShortName(i,!0).createQuery(n,r);var u=t.filterArray(this.types,function(t){return t.setName==n});return u.length==1?u[0].createQuery(n,r):new o.entityQuery(n,null,r)},n.registerCtor=function(n,t,i){var r=this.getEntityTypeByShortName(n,!0);r.registerCtor(t,i)},n.createEntity=function(n,t){var i=this.getEntityTypeByShortName(n,!0);return i.createEntity(t)},n.createRawEntity=function(n,t){var i=this.getEntityTypeByShortName(n,!0);return i.createRawEntity(t)},n.parseBeetleMetadata=function(n){var o,a,s,r,v,y,p,w,l,i,f,b,k;if(this.types=[],this.enums={},this.name=n.n,this.displayName=t.getResourceValue(n.r,n.l||n.n),o=n.e,a={},o)for(s=0;s<o.length;s++)r=o[s],v={},t.forEach(r.m,function(n){v[n.n]={name:n.n,value:n.v,displayName:t.getResourceValue(n.r,n.l||n.n)}}),y=new h.enums(v),this.enums[r.n]=y,a[r.n]=new e.dataTypes.enum(y,r.n,t.getResourceValue(r.r,r.l||r.n));for(p=this,w=n.m,l=0;l<w.length;l++)i=w[l],f=new c.entityType(i.n,t.getResourceValue(i.rn,i.s),i.s,i.k,i.b,i.q,i.t,i.c,this),t.forEach(i.d,function(n){var o,s,r;o=n.e?a[n.t]:e.dataTypes.byName(n.t);s=t.getResourceValue(n.r,n.l||n.n);r=new c.dataProperty(f,n.n,s,o,n.i===!0,i.k&&t.findInArray(i.k,n.n)!=null,n.g?n.g=="I"?u.generationPattern.Identity:u.generationPattern.Computed:null,n.d?o.handle(n.d):null,n.c);n.v&&t.forEach(n.v,function(t){r.validators.push(e.validator.byCode(t.t,t.a,t.m,t.r,r.displayName,n.r))});n.p&&(r.precision=Number(n.p));n.s&&(r.scale=Number(n.s));f.dataProperties.push(r)}),b=i.r,b&&t.forEach(b,function(n){var i=new c.navigationProperty(f,n.n,t.getResourceValue(n.r,n.l||n.n),n.t,n.s===!0,n.a,n.c);n.f&&t.forEach(n.f,function(n){i.foreignKeyNames.push(n)});n.v&&t.forEach(n.v,function(t){i.validators.push(e.validator.byCode(t.t,t.a,t.m,t.r,i.displayName,n.r))});f.navigationProperties.push(i)}),k=i.x,k&&t.forEach(k,function(n){var i=new c.navigationProperty(f,n.n,t.getResourceValue(n.r,n.l||n.n),n.t,!0);f.navigationProperties.push(i)}),this.types.push(f);t.forEach(this.types,function(n){n.baseTypeName&&(n.baseType=p.getEntityTypeByShortName(n.baseTypeName,!0));delete n.baseTypeName});t.forEach(this.types,function(n){for(var i=n.baseType;i;)n.floorType=i,t.forEach(i.dataProperties,function(i){t.findInArray(n.dataProperties,i)||n.dataProperties.push(i)}),t.forEach(i.navigationProperties,function(i){t.findInArray(n.navigationProperties,i)||n.navigationProperties.push(i)}),i=i.baseType;t.forEach(n.navigationProperties,function(i){var r,u;if(!i.entityType)for(i.entityType=p.getEntityTypeByShortName(i.entityTypeName,!0),r=0;r<i.entityType.navigationProperties.length;r++)if(u=i.entityType.navigationProperties[r],u.associationName===i.associationName&&i!==u){i.inverse=u;break}t.forEach(i.foreignKeyNames,function(r){if(!t.findInArray(i.foreignKeys,r,"name")){var u=t.findInArray(n.dataProperties,r,"name");u.relatedNavigationProperties.push(i);i.foreignKeys.push(u)}})});t.forEach(n.keyNames,function(i){n.keys.push(t.findInArray(n.dataProperties,i,"name"))})})},i}()}}(),o=function(){return{expressions:function(){return{ofTypeExp:function(){var r=function(n){i.expressionBase.call(this,"oftype",-1,!0,!0);this.typeName=n},n;return t.inherit(r,i.expressionBase),n=r.prototype,n.combine=function(n){this.typeName=n},n.toBeetleQuery=function(){return this.typeName},n.clone=function(){return new r(this.typeName)},n.execute=function(n){var i=this;return t.filterArray(n,function(n){return n&&(n.$tracker&&n.$tracker.entityType.isAssignableTo(i.typeName)||typeof n===i.typeName)})},r}(),whereExp:function(){function c(n,t,i){var r=new v(t);n.length>0&&a(n,t,r);i.currentGroup?i.currentGroup.filterItems.push(r):i.groups.push(r);i.currentGroup=r;i.openGroups.push(r)}function a(n,i,o){var h,p,v,a,y,c,w;if(n.length==3||n.length==4){if(h=n[1],f.isTypeOf(h,"string"))for(h=h.toLowerCase(),p=u.filterOps.symbols(),v=0;v<p.length;v++)if(a=p[v],a.oData==h||a.code==h||a.name==h){h=a;break}t.assertPrm(h,"filterOperation").isEnum(u.filterOps).check();y=n[0];c=n[2];e.dataTypes.date.isValid(c)?c='"'+s.getDateConverter().toISOString(c)+'"':!f.isTypeOf(c,"string")||n.length==4&&c[0]=="@"||(c='"'+c+'"');w=h.isFunc?h===u.filterOps.Contains?"substringof("+c+", "+y+")":h.code+"("+y+", "+c+")":y+h.code+c;o.filterItems.push(new l(w,i,n[3]));return}if(n.length==1||n.length==2)o.filterItems.push(new l(n[0],i,n[1]));else throw t.createError(r.argCountMismatch,["where"],{args:n});}var l=function(){var i=function(n,t,i){this.expStr=n;this.exp=h.jsep(n);this.isOr=t===!0;this.varContext=i},n=i.prototype;return n.toString=function(){return this.exp.toString()},n.toODataQuery=function(n){n=n||{};n.expVarContext=this.varContext;var i=t.jsepToODataQuery(this.exp,n);return n.expVarContext=undefined,i},n.toBeetleQuery=function(n){n=n||{};n.expVarContext=this.varContext;var i=t.jsepToBeetleQuery(this.exp,n);return n.expVarContext=undefined,i},n.clone=function(){return new l(this.expStr,this.isOr,this.varContext)},n.toFunction=function(n){var i=this;return function(r){n=n||{};n.expVarContext=i.varContext;var u=t.jsepToFunction(i.exp,n)(r);return n.expVarContext=undefined,u}},i}(),v=function(){var i=function(n){this.isOr=n===!0;this.filterItems=[]},n=i.prototype;return n.toString=function(){var n=[],i=null;return t.forEach(this.filterItems,function(t){i!=null&&n.push(i.isOr?" or ":" and ");n.push(t.toString());i=t}),n.join("")},n.toODataQuery=function(n){var i="";return t.forEach(this.filterItems,function(t){var r=t.toODataQuery(n);i?i+=(t.isOr?" or ":" and ")+r:i=r}),"("+i+")"},n.toBeetleQuery=function(n){var i="";return t.forEach(this.filterItems,function(t){var r=t.toBeetleQuery(n);i?i+=(t.isOr?" or ":" and ")+r:i=r}),"("+i+")"},n.clone=function(n){var i=new v(this.isOr);return t.forEach(this.filterItems,function(t){i.filterItems.push(t.clone(n))}),n&&n.push({o:this,n:i}),i},n.toFunction=function(n){var t=this;return function(i){for(var u,r=null,f=0;f<t.filterItems.length;f++)u=t.filterItems[f],r=u.isOr?(r==null?!1:r)||u.toFunction(n)(i):(r==null?!0:r)&&u.toFunction(n)(i);return r}},i}(),o=function(n){i.expressionBase.call(this,"filter",2,!1,!1);this.currentGroup=null;this.groups=[];this.openGroups=[];n&&this.andGroup.apply(this,n)},n;return t.inherit(o,i.expressionBase),n=o.prototype,n.and=function(n){return this.currentGroup?a(n,!1,this.currentGroup):c(n,!1,this),this},n.or=function(n){return this.currentGroup?a(n,!0,this.currentGroup):c(n,!0,this),this},n.andGroup=function(){return c(arguments,!1,this),this},n.orGroup=function(){return c(arguments,!0,this),this},n.closeGroup=function(){var n=this.openGroups.pop();if(!n)throw t.createError(r.noOpenGroup,{expression:this});return this.currentGroup=this.openGroups[this.openGroups.length-1],this},n.combine=function(n){this.and(n)},n.toODataQuery=function(n){var i=null;return t.forEach(this.groups,function(t){var r=t.toODataQuery(n);i?i+=(t.isOr?" or ":" and ")+r:i=r}),i},n.toBeetleQuery=function(n){var i=null;return t.forEach(this.groups,function(t){var r=t.toBeetleQuery(n);i?i+=(t.isOr?" or ":" and ")+r:i=r}),i},n.clone=function(){var n=new o,i=[];return t.forEach(this.groups,function(t){n.groups.push(t.clone(i))}),t.forEach(this.openGroups,function(r){n.openGroups.push(t.findInArray(i,r,"o").n)}),this.currentGroup&&(n.currentGroup=t.findInArray(i,this.currentGroup,"o").n),n},n.execute=function(n,t){return o.execute(n,this.groups,t)},o.execute=function(n,i,r){var u=function(n){for(var u,t=null,f=0;f<i.length;f++)u=i[f],t=u.isOr?(t==null?!1:t)||u.toFunction(r)(n):(t==null?!0:t)&&u.toFunction(r)(n);return t};return t.filterArray(n,u)},o}(),orderByExp:function(){var u="x => x",n=function(n,t){i.expressionBase.call(this,"orderby",1,!1,!1);n=n||u;t===!0&&(n+=" desc");this.expStr=n;this.exp=h.jsep(n)},r;return t.inherit(n,i.expressionBase),r=n.prototype,r.combine=function(n,i){t.assertPrm(n,"expStr").isNotEmptyString().check();n=n||u;i===!0&&(n+=" desc");this.expStr+=", "+n;this.exp=h.jsep(this.expStr)},r.toODataQuery=function(n){return t.jsepToODataQuery(this.exp,n)},r.toBeetleQuery=function(n){return t.jsepToBeetleQuery(this.exp,n)},r.clone=function(){return new n(this.expStr)},r.execute=function(t,i){return n.execute(t,this.exp,i)},n.execute=function(n,i,r){for(var h,l,f,e=[],o=i.type=="Compound"?i.body:[i],u=0;u<o.length;u++){var c=!1,a=o[u],s=o[u+1];s&&s.type=="Identifier"&&(h=s.name.toLowerCase(),h=="desc"?(c=!0,u++):h=="asc"&&u++);l=function(n,i){return function(u,f){var e=t.jsepToFunction(n,r),o=e(u),s=e(f);return o==s?0:o>s?i?-1:1:i?1:-1}}(a,c);e.push(l)}return f=[],f.push.apply(f,n),f.sort(function(n,t){for(var r,i=0;i<e.length;i++)if(r=e[i](n,t),r!=0)return r;return 0})},n}(),expandExp:function(){var r=function(n){i.expressionBase.call(this,"expand",1,!1,!1);this.expStr=n;this.exp=h.jsep(n)},n;return t.inherit(r,i.expressionBase),n=r.prototype,n.combine=function(n){this.expStr+=", "+n;this.exp=h.jsep(this.expStr)},n.toODataQuery=function(n){return t.jsepToODataQuery(this.exp,n)},n.toBeetleQuery=function(n){return t.jsepToBeetleQuery(this.exp,n)},n.clone=function(){return new r(this.expStr)},n.execute=function(n){return n},r}(),selectExp:function(){var n=function(n){i.expressionBase.call(this,"select",2,!1,!0);this.expStr=n;this.exp=h.jsep(n)},r;return t.inherit(n,i.expressionBase),r=n.prototype,r.combine=function(n){this.expStr+=", "+n;this.exp=h.jsep(this.expStr)},r.toODataQuery=function(n){return t.jsepToODataQuery(this.exp,n)},r.toBeetleQuery=function(n){return t.jsepToBeetleQuery(this.exp,n)},r.clone=function(){return new n(this.expStr)},r.execute=function(t,i){return n.execute(t,this.exp,i)},n.execute=function(n,i,r){var u;if(n.length==0)return n;var e=i.type=="Compound"?i.body:[i],o=t.jsepToProjector(e,r),f=[];for(u=0;u<n.length;u++)f.push(o(n[u]));return f},n}(),skipExp:function(){var r=function(n){i.expressionBase.call(this,"skip",2,!1,!1);this.count=n},n;return t.inherit(r,i.expressionBase),n=r.prototype,n.combine=function(n){n<this.count&&(this.count=n)},n.toODataQuery=function(){return this.count},n.toBeetleQuery=function(){return this.count},n.clone=function(){return new r(this.count)},n.execute=function(n){return n.slice(this.count)},r}(),topExp:function(){var r=function(n){i.expressionBase.call(this,"top",2,!1,!1);this.count=n},n;return t.inherit(r,i.expressionBase),n=r.prototype,n.combine=function(n){n<this.count&&(this.count=n)},n.toODataQuery=function(){return this.count},n.toBeetleQuery=function(){return this.count},n.clone=function(){return new r(this.count)},n.execute=function(n){return n.slice(0,this.count)},r}(),groupByExp:function(){var n=function(n,t){i.expressionBase.call(this,"groupby",3,!0,!0);this.keySelectorStr=n;this.elementSelectorStr=t;this.keySelectorExp=null;n&&(this.keySelectorExp=h.jsep(n));this.elementSelectorExp=null;t&&(this.elementSelectorExp=h.jsep(t))},r;return t.inherit(n,i.expressionBase),r=n.prototype,r.toBeetleQuery=function(n){var i="";return this.keySelectorExp&&(i+=t.jsepToBeetleQuery(this.keySelectorExp,n)),this.elementSelectorExp&&(i+=";"+t.jsepToBeetleQuery(this.elementSelectorExp,n)),i},r.clone=function(){return new n(this.keySelectorStr,this.elementSelectorStr)},r.execute=function(t,i){return n.execute(t,this.keySelectorExp,this.elementSelectorExp,i)},n.execute=function(n,i,r,u){var f=[],c,s,e,l,h,a,v,y;if(i)for(c=o.expressions.selectExp.execute(n,i,u),s=0;s<c.length;s++){for(e=null,l=c[s],h=0;h<f.length;h++)if(a=f[h],t.objEquals(a.Key,l)){e=a;break}e||(e={Key:l,Items:[]},f.push(e));e.Items.push(n[s])}else f.push({Key:null,Items:n});return r&&(v=r.type=="Compound"?r.body:[r],y=t.jsepToProjector(v,u),t.forEach(f,function(n,t){var r=n.Items,i;r.Key=n.Key;i=y(n.Items);f[t]=i})),f},n}(),distinctExp:function(){function u(n){var i=[];return t.forEach(n,function(n){for(var u=!1,r=0;r<i.length;r++)if(t.objEquals(i[r],n)){u=!0;break}u===!1&&i.push(n)}),i}var n=function(n){i.expressionBase.call(this,"distinct",3,!0,!0);this.expStr=n;n&&(this.exp=h.jsep(n))},r;return t.inherit(n,i.expressionBase),r=n.prototype,r.toBeetleQuery=function(n){return this.exp?t.jsepToBeetleQuery(this.exp,n):""},r.clone=function(){return new n(this.expStr)},r.execute=function(t,i){return n.execute(t,this.exp,i)},n.execute=function(n,t,i){return t&&(n=o.expressions.selectExp.execute(n,t,i)),u(n)},n}(),reverseExp:function(){var n=function(){i.expressionBase.call(this,"reverse",3,!0,!1)},r;return t.inherit(n,i.expressionBase),r=n.prototype,r.toBeetleQuery=function(){return""},r.clone=function(){return new n},r.execute=function(t){return n.execute(t)},n.execute=function(n){return n.reverse()},n}(),selectManyExp:function(){var n=function(n){i.expressionBase.call(this,"selectMany",3,!0,!0);this.expStr=n;this.exp=h.jsep(n)},r;return t.inherit(n,i.expressionBase),r=n.prototype,r.toBeetleQuery=function(n){return t.jsepToBeetleQuery(this.exp,n)},r.clone=function(){return new n(this.expStr)},r.execute=function(t,i){return n.execute(t,this.exp,i)},n.execute=function(n,i,r){var e,u,f,o;if(n.length==0)return n;for(e=t.jsepToFunction(i,r),u=[],f=0;f<n.length;f++)o=e(n[f]),u=u.concat.apply(u,o);return u},n}(),skipWhileExp:function(){var n=function(n,t){i.expressionBase.call(this,"skipWhile",3,!0,!1);this.expStr=n;n&&(this.exp=h.jsep(n));this.varContext=t},r;return t.inherit(n,i.expressionBase),r=n.prototype,r.toBeetleQuery=function(n){return t.jsepToBeetleQuery(this.exp,n)},r.clone=function(){return new n(this.expStr,this.varContext)},r.execute=function(t,i){return n.execute(t,this.exp,i)},n.execute=function(n,i,r){for(var f=t.jsepToFunction(i,r),u=0;f(n[u])==!0;)u++;return n.slice(u+1)},n}(),takeWhileExp:function(){var n=function(n,t){i.expressionBase.call(this,"takeWhile",3,!0,!1);this.expStr=n;n&&(this.exp=h.jsep(n));this.varContext=t},r;return t.inherit(n,i.expressionBase),r=n.prototype,r.toBeetleQuery=function(n){return t.jsepToBeetleQuery(this.exp,n)},r.clone=function(){return new n(this.expStr,this.varContext)},r.execute=function(t,i){return n.execute(t,this.exp,i)},n.execute=function(n,i,r){for(var f=t.jsepToFunction(i,r),u=0;f(n[u])==!0;)u++;return n.slice(0,u)},n}(),allExp:function(){var n=function(n,t){i.expressionBase.call(this,"exec;all",3,!0,!0);this.expStr=n;this.exp=h.jsep(n);this.varContext=t;this.isExecuter=!0},r;return t.inherit(n,i.expressionBase),r=n.prototype,r.toBeetleQuery=function(n){return t.jsepToBeetleQuery(this.exp,n)},r.clone=function(){return new n(this.expStr,this.varContext)},r.execute=function(t,i){return n.execute(t,this.exp,i)},n.execute=function(n,i,r){var u=t.jsepToFunction(i,r);return o.queryFuncs.all.impl(n,function(){return n},u)},n}(),anyExp:function(){var n=function(n,t){i.expressionBase.call(this,"exec;any",3,!0,!0);this.expStr=n;n&&(this.exp=h.jsep(n));this.varContext=t;this.isExecuter=!0},r;return t.inherit(n,i.expressionBase),r=n.prototype,r.toBeetleQuery=function(n){return this.exp?t.jsepToBeetleQuery(this.exp,n):""},r.clone=function(){return new n(this.expStr,this.varContext)},r.execute=function(t,i){return n.execute(t,this.exp,i)},n.execute=function(n,i,r){if(i){var u=t.jsepToFunction(i,r);return o.queryFuncs.any.impl(n,function(){return n},u)}return n.length>0},n}(),avgExp:function(){var n=function(n){i.expressionBase.call(this,"exec;avg",3,!0,!0);this.expStr=n;n&&(this.exp=h.jsep(n));this.isExecuter=!0},r;return t.inherit(n,i.expressionBase),r=n.prototype,r.toBeetleQuery=function(n){return this.exp?t.jsepToBeetleQuery(this.exp,n):""},r.clone=function(){return new n(this.expStr)},r.execute=function(t,i){return n.execute(t,this.exp,i)},n.execute=function(n,i,r){var u=i?t.jsepToFunction(i,r):function(n){return n};return o.queryFuncs.avg.impl(n,function(){return n},u)},n}(),maxExp:function(){var n=function(n){i.expressionBase.call(this,"exec;max",3,!0,!0);this.expStr=n;n&&(this.exp=h.jsep(n));this.isExecuter=!0},r;return t.inherit(n,i.expressionBase),r=n.prototype,r.toBeetleQuery=function(n){return this.exp?t.jsepToBeetleQuery(this.exp,n):""},r.clone=function(){return new n(this.expStr)},r.execute=function(t,i){return n.execute(t,this.exp,i)},n.execute=function(n,i,r){var u=i?t.jsepToFunction(i,r):function(n){return n};return o.queryFuncs.max.impl(n,function(){return n},u)},n}(),minExp:function(){var n=function(n){i.expressionBase.call(this,"exec;min",3,!0,!0);this.expStr=n;n&&(this.exp=h.jsep(n));this.isExecuter=!0},r;return t.inherit(n,i.expressionBase),r=n.prototype,r.toBeetleQuery=function(n){return this.exp?t.jsepToBeetleQuery(this.exp,n):""},r.clone=function(){return new n(this.expStr)},r.execute=function(t,i){return n.execute(t,this.exp,i)},n.execute=function(n,i,r){var u=i?t.jsepToFunction(i,r):function(n){return n};return o.queryFuncs.min.impl(n,function(){return n},u)},n}(),sumExp:function(){var n=function(n){i.expressionBase.call(this,"exec;sum",3,!0,!0);this.expStr=n;n&&(this.exp=h.jsep(n));this.isExecuter=!0},r;return t.inherit(n,i.expressionBase),r=n.prototype,r.toBeetleQuery=function(n){return this.exp?t.jsepToBeetleQuery(this.exp,n):""},r.clone=function(){return new n(this.expStr)},r.execute=function(t,i){return n.execute(t,this.exp,i)},n.execute=function(n,i,r){var u=i?t.jsepToFunction(i,r):function(n){return n};return o.queryFuncs.sum.impl(n,function(){return n},u)},n}(),countExp:function(){var n=function(n,t){i.expressionBase.call(this,"exec;count",3,!0,!0);this.expStr=n;n&&(this.exp=h.jsep(n));this.varContext=t;this.isExecuter=!0},r;return t.inherit(n,i.expressionBase),r=n.prototype,r.toBeetleQuery=function(n){return this.exp?t.jsepToBeetleQuery(this.exp,n):""},r.clone=function(){return new n(this.expStr,this.varContext)},r.execute=function(t,i){return n.execute(t,this.exp,i)},n.execute=function(n,i,r){return i&&(n=t.filterArray(n,t.jsepToFunction(i,r))),n.length},n}(),firstExp:function(){var n=function(n,t){i.expressionBase.call(this,"exec;first",3,!0,!1);this.expStr=n;n&&(this.exp=h.jsep(n));this.varContext=t;this.isExecuter=!0},u;return t.inherit(n,i.expressionBase),u=n.prototype,u.toBeetleQuery=function(n){return this.exp?t.jsepToBeetleQuery(this.exp,n):""},u.clone=function(){return new n(this.expStr,this.varContext)},u.execute=function(t,i){return n.execute(t,this.exp,i)},n.execute=function(n,i,u){if(i&&(n=t.filterArray(n,t.jsepToFunction(i,u))),n.length==0)throw t.createError(r.arrayEmpty,{array:n,expression:this});return n[0]},n}(),firstOrDefaultExp:function(){var n=function(n,t){i.expressionBase.call(this,"exec;firstOD",3,!0,!1);this.expStr=n;n&&(this.exp=h.jsep(n));this.varContext=t;this.isExecuter=!0},r;return t.inherit(n,i.expressionBase),r=n.prototype,r.toBeetleQuery=function(n){return this.exp?t.jsepToBeetleQuery(this.exp,n):""},r.clone=function(){return new n(this.expStr,this.varContext)},r.execute=function(t,i){return n.execute(t,this.exp,i)},n.execute=function(n,i,r){return i&&(n=t.filterArray(n,t.jsepToFunction(i,r))),n.length==0?null:n[0]},n}(),singleExp:function(){var n=function(n,t){i.expressionBase.call(this,"exec;single",3,!0,!1);this.expStr=n;n&&(this.exp=h.jsep(n));this.varContext=t;this.isExecuter=!0},u;return t.inherit(n,i.expressionBase),u=n.prototype,u.toBeetleQuery=function(n){return this.exp?t.jsepToBeetleQuery(this.exp,n):""},u.clone=function(){return new n(this.expStr,this.varContext)},u.execute=function(t,i){return n.execute(t,this.exp,i)},n.execute=function(n,i,u){if(i&&(n=t.filterArray(n,t.jsepToFunction(i,u))),n.length!=1)throw t.createError(r.arrayNotSingle,{array:n,expression:this});return n[0]},n}(),singleOrDefaultExp:function(){var n=function(n,t){i.expressionBase.call(this,"exec;singleOD",3,!0,!1);this.expStr=n;n&&(this.exp=h.jsep(n));this.varContext=t;this.isExecuter=!0},u;return t.inherit(n,i.expressionBase),u=n.prototype,u.toBeetleQuery=function(n){return this.exp?t.jsepToBeetleQuery(this.exp,n):""},u.clone=function(){return new n(this.expStr,this.varContext)},u.execute=function(t,i){return n.execute(t,this.exp,i)},n.execute=function(n,i,u){if(i&&(n=t.filterArray(n,t.jsepToFunction(i,u))),n.length>1)throw t.createError(r.arrayNotSingleOrEmpty,{array:n,expression:this});return n.length==0?null:n[0]},n}(),lastExp:function(){var n=function(n,t){i.expressionBase.call(this,"exec;last",3,!0,!1);this.expStr=n;n&&(this.exp=h.jsep(n));this.varContext=t;this.isExecuter=!0},u;return t.inherit(n,i.expressionBase),u=n.prototype,u.toBeetleQuery=function(n){return this.exp?t.jsepToBeetleQuery(this.exp,n):""},u.clone=function(){return new n(this.expStr,this.varContext)},u.execute=function(t,i){return n.execute(t,this.exp,i)},n.execute=function(n,i,u){if(i&&(n=t.filterArray(n,t.jsepToFunction(i,u))),n.length==0)throw t.createError(r.arrayEmpty,{array:n,expression:this});return n[n.length-1]},n}(),lastOrDefaultExp:function(){var n=function(n,t){i.expressionBase.call(this,"exec;lastOD",3,!0,!1);this.expStr=n;n&&(this.exp=h.jsep(n));this.varContext=t;this.isExecuter=!0},r;return t.inherit(n,i.expressionBase),r=n.prototype,r.toBeetleQuery=function(n){return this.exp?t.jsepToBeetleQuery(this.exp,n):""},r.clone=function(){return new n(this.expStr,this.varContext)},r.execute=function(t,i){return n.execute(t,this.exp,i)},n.execute=function(n,i,r){return i&&(n=t.filterArray(n,t.jsepToFunction(i,r))),n.length==0?null:n[n.length-1]},n}()}}(),queryFuncs:function(){var n={};return n.toupper=function(){var n=function(){i.queryFuncBase.call(this,"toupper","ToUpper",1)},r;return t.inherit(n,i.queryFuncBase),r=n.prototype,r.impl=function(n,t){return(t?t(n):n).toUpperCase()},new n}(),n.tolower=function(){var n=function(){i.queryFuncBase.call(this,"tolower","ToLower",1)},r;return t.inherit(n,i.queryFuncBase),r=n.prototype,r.impl=function(n,t){return(t?t(n):n).toLowerCase()},new n}(),n.substring=function(){var n=function(){i.queryFuncBase.call(this,"substring","Substring",3)},r;return t.inherit(n,i.queryFuncBase),r=n.prototype,r.impl=function(n,t,i,r){arguments.length==3?(r=i,i=t,t=n):t=t(n);i=i(n);r=r(n);var u=Number(i)+Number(r);return t&&t.substring(i,u)},new n}(),n.substringof=function(){var n=function(){i.queryFuncBase.call(this,"substringof","Contains",2)},r;return t.inherit(n,i.queryFuncBase),r=n.prototype,r.toBeetleFunction=function(n,t){return t=t?t+".":"",t+"Contains("+n+")"},r.impl=function(n,i,r){return r=r?r(n):n,r=t.handleStrOptions(r,this.varContext),i=t.handleStrOptions(i(n),this.varContext),r&&r.indexOf(i)>=0},new n}(),n.length=function(){var n=function(){i.queryFuncBase.call(this,"length","Length",1)},r;return t.inherit(n,i.queryFuncBase),r=n.prototype,r.toBeetleFunction=function(n){return n=n?n+".":"",n+"Length"},r.impl=function(n,t){return(t?t(n):n).length},new n}(),n.trim=function(){var n=function(){i.queryFuncBase.call(this,"trim","Trim",1)},r;return t.inherit(n,i.queryFuncBase),r=n.prototype,r.impl=function(n,t){return(t?t(n):n).trim()},new n}(),n.concat=function(){var n=function(){i.queryFuncBase.call(this,"concat","Concat",null)},r;return t.inherit(n,i.queryFuncBase),r=n.prototype,r.toBeetleFunction=function(){return"string.Concat("+Array.prototype.slice.call(arguments).join(", ")+")"},r.impl=function(n){for(var i=arguments[1](n).toString(),r=Array.prototype.slice.call(arguments,2),u=[],t=0;t<r.length;t++)u.push(r[t](n));return i.concat.apply(i,u)},new n}(),n.replace=function(){var n=function(){i.queryFuncBase.call(this,"replace","Replace",3)},r;return t.inherit(n,i.queryFuncBase),r=n.prototype,r.impl=function(n,i,r,u){return arguments.length==3?(u=r,r=i,i=n):i=i(n),r=r(n),t.ignoreWhiteSpaces(this.varContext)&&(r=r.trim()),t.isCaseSensitive(this.varContext)||(r=new RegExp(r,"gi")),i.replace(r,u(n))},new n}(),n.startswith=function(){var n=function(){i.queryFuncBase.call(this,"startswith","StartsWith",2)},r;return t.inherit(n,i.queryFuncBase),r=n.prototype,r.impl=function(n,i,r){return arguments.length==2?(r=i,i=n):i=i(n),i=t.handleStrOptions(i,this.varContext),r=t.handleStrOptions(r(n),this.varContext),i&&i.indexOf(r,0)===0},new n}(),n.endswith=function(){var n=function(){i.queryFuncBase.call(this,"endswith","EndsWith",2)},r;return t.inherit(n,i.queryFuncBase),r=n.prototype,r.impl=function(n,i,r){arguments.length==2?(r=i,i=n):i=i(n);i=t.handleStrOptions(i,this.varContext);r=t.handleStrOptions(r(n),this.varContext);var u=i.length-r.length;return i&&i.indexOf(r,u)!==-1},new n}(),n.indexof=function(){var n=function(){i.queryFuncBase.call(this,"indexof","IndexOf",2)},r;return t.inherit(n,i.queryFuncBase),r=n.prototype,r.impl=function(n,i,r){return arguments.length==2?(r=i,i=n):i=i(n),i=t.handleStrOptions(i,this.varContext),r=t.handleStrOptions(r(n),this.varContext),i&&i.indexOf(r)},new n}(),n.contains=function(){var u=function(){i.queryFuncBase.call(this,"contains","Contains",2)},r;return t.inherit(u,i.queryFuncBase),r=u.prototype,r.toODataFunction=function(i,r){if(f.isTypeOf(i,"string"))return n.substringof.toODataFunction(r,i);var u=[];return t.forEach(i,function(n){u.push(r+" eq "+e.dataTypes.toODataValue(n))}),"("+u.join(" or ")+")"},r.toBeetleFunction=function(i,r){if(f.isTypeOf(i,"string"))return n.substringof.toBeetleFunction(r,i);var u=[];return t.forEach(i,function(n){u.push(r+" == "+e.dataTypes.toBeetleValue(n))}),"("+u.join(" || ")+")"},r.impl=function(n,i,r){var u,e;if(arguments.length==1?i=n:arguments.length==2?(r=i,i=n):i=i(n),r=r?r(n):n,f.isArray(i)){for(u=0;u<i.length;u++)if(e=i[u],e==r)return!0;return!1}return i=t.handleStrOptions(i,this.varContext),r=t.handleStrOptions(r,this.varContext),i&&i.indexOf(r)>=0},new u}(),n.round=function(){var n=function(){i.queryFuncBase.call(this,"round","Math.Round",1)},r;return t.inherit(n,i.queryFuncBase),r=n.prototype,r.toBeetleFunction=function(n){return"Math.Round("+n+")"},r.impl=function(n,t){return Math.round(t?t(n):n)},new n}(),n.ceiling=function(){var n=function(){i.queryFuncBase.call(this,"ceiling","Math.Ceiling(%1)",1)},r;return t.inherit(n,i.queryFuncBase),r=n.prototype,r.toBeetleFunction=function(n){return"Math.Ceiling("+n+")"},r.impl=function(n,t){return Math.ceil(t?t(n):n)},new n}(),n.floor=function(){var n=function(){i.queryFuncBase.call(this,"floor","Math.Floor",1)},r;return t.inherit(n,i.queryFuncBase),r=n.prototype,r.toBeetleFunction=function(n){return"Math.Floor("+n+")"},r.impl=function(n,t){return Math.floor(t?t(n):n)},new n}(),n.second=function(){var n=function(){i.queryFuncBase.call(this,"second","Second",1)},r;return t.inherit(n,i.queryFuncBase),r=n.prototype,r.toBeetleFunction=function(n){return n=n?n+".":"",n+"Second"},r.impl=function(n,t){return t=e.dataTypes.date.handle(t?t(n):n),t.getSeconds()},new n}(),n.minute=function(){var n=function(){i.queryFuncBase.call(this,"minute","Minute",1)},r;return t.inherit(n,i.queryFuncBase),r=n.prototype,r.toBeetleFunction=function(n){return n=n?n+".":"",n+"Minute"},r.impl=function(n,t){return t=e.dataTypes.date.handle(t?t(n):n),t.getMinutes()},new n}(),n.hour=function(){var n=function(){i.queryFuncBase.call(this,"hour","Hour",1)},r;return t.inherit(n,i.queryFuncBase),r=n.prototype,r.toBeetleFunction=function(n){return n=n?n+".":"",n+"Hour"},r.impl=function(n,t){return t=e.dataTypes.date.handle(t?t(n):n),t.getHours()},new n}(),n.day=function(){var n=function(){i.queryFuncBase.call(this,"day","Day",1)},r;return t.inherit(n,i.queryFuncBase),r=n.prototype,r.toBeetleFunction=function(n){return n=n?n+".":"",n+"Day"},r.impl=function(n,t){return t=e.dataTypes.date.handle(t?t(n):n),t.getDate()},new n}(),n.month=function(){var n=function(){i.queryFuncBase.call(this,"month","Month",1)},r;return t.inherit(n,i.queryFuncBase),r=n.prototype,r.toBeetleFunction=function(n){return n=n?n+".":"",n+"Month"},r.impl=function(n,t){return t=e.dataTypes.date.handle(t?t(n):n),t.getMonth()+1},new n}(),n.year=function(){var n=function(){i.queryFuncBase.call(this,"year","Year",1)},r;return t.inherit(n,i.queryFuncBase),r=n.prototype,r.toBeetleFunction=function(n){return n=n?n+".":"",n+"Year"},r.impl=function(n,t){return t=e.dataTypes.date.handle(t?t(n):n),t.getFullYear()},new n}(),n.max=function(){var n=function(){i.queryFuncBase.call(this,"max","Max",2)},u;return t.inherit(n,i.queryFuncBase),u=n.prototype,u.toODataFunction=function(){throw t.createError(r.functionNotSupportedForOData,["Max"]);},u.impl=function(n,t,i){var u,r,f;if(arguments.length==1?t=n:arguments.length==2?(i=t,t=n):t=t(n),t.length==0)return null;for(u=i?i(t[0]):t[0],r=1;r<t.length;r++)f=i?i(t[r]):t[r],f>u&&(u=f);return u},new n}(),n.min=function(){var n=function(){i.queryFuncBase.call(this,"min","Min",2)},u;return t.inherit(n,i.queryFuncBase),u=n.prototype,u.toODataFunction=function(){throw t.createError(r.functionNotSupportedForOData,["Min"]);},u.impl=function(n,t,i){var u,r,f;if(arguments.length==1?t=n:arguments.length==2?(i=t,t=n):t=t(n),t.length==0)return null;for(u=i?i(t[0]):t[0],r=1;r<t.length;r++)f=i?i(t[r]):t[r],f<u&&(u=f);return u},new n}(),n.sum=function(){var n=function(){i.queryFuncBase.call(this,"sum","Sum",2)},u;return t.inherit(n,i.queryFuncBase),u=n.prototype,u.toODataFunction=function(){throw t.createError(r.functionNotSupportedForOData,["Sum"]);},u.impl=function(n,t,i){var u,r,f;for(arguments.length==1?t=n:arguments.length==2?(i=t,t=n):t=t(n),u=0,r=0;r<t.length;r++)f=t[r],u+=i?i(f):f;return u},new n}(),n.count=function(){var n=function(){i.queryFuncBase.call(this,"count","Count",1)},u;return t.inherit(n,i.queryFuncBase),u=n.prototype,u.toODataFunction=function(){throw t.createError(r.functionNotSupportedForOData,["Count"]);},u.impl=function(n,t){return(t?t(n):n).length},new n}(),n.avg=function(){var u=function(){i.queryFuncBase.call(this,"avg","Average",2)},f;return t.inherit(u,i.queryFuncBase),f=u.prototype,f.toODataFunction=function(){throw t.createError(r.functionNotSupportedForOData,["Avg"]);},f.impl=function(t,i,r){return(arguments.length==1?i=t:arguments.length==2?(r=i,i=t):i=i(t),i.length==0)?null:n.sum.impl(t,function(){return i},r)/i.length},new u}(),n.any=function(){var n=function(){i.queryFuncBase.call(this,"any","Any",2);this.needsAlias=!0},r;return t.inherit(n,i.queryFuncBase),r=n.prototype,r.toODataFunction=function(n,t,i){return t+"/any("+n+": "+i+")"},r.impl=function(n,t,i){var r,u;if(arguments.length==1?t=n:arguments.length==2?(i=t,t=n):t=t(n),!i)return t.length>0;for(r=0;r<t.length;r++)if(u=t[r],i(u)===!0)return!0;return!1},new n}(),n.all=function(){var n=function(){i.queryFuncBase.call(this,"all","All",2);this.needsAlias=!0},r;return t.inherit(n,i.queryFuncBase),r=n.prototype,r.toODataFunction=function(n,t,i){return t+"/all("+n+": "+i+")"},r.impl=function(n,t,i){var r,u;for(arguments.length==1?t=n:arguments.length==2?(i=t,t=n):t=t(n),r=0;r<t.length;r++)if(u=t[r],i(u)!==!0)return!1;return!0},new n}(),n.getFunc=function(i,u){var f=n[i.toLowerCase()];if(f==null&&u!==!1)throw t.createError(r.unknownFunction,[i]);return f},n}(),arrayQuery:function(){var r,n;return Array.prototype.asQueryable=function(){return new o.arrayQuery(this)},Array.hasOwnProperty("q")||(Array.prototype.q=function(){return this.asQueryable()}),r=function(n){this.array=n;i.queryBase.call(this)},t.inherit(r,i.queryBase),n=r.prototype,n.executeAfterExecuter=!0,n.execute=function(n){return this.options&&(n=t.combine(this.options.varContext,n)),this.toFunction()(this.array,n)},n.clone=function(){var n=new o.arrayQuery(this.array);return this.copy(n),n},n.copy=function(n){i.queryBase.prototype.copy.call(this,n)},r}(),entityQuery:function(){function e(n,i){if(n==null)return null;if(f.isTypeOf(n,"string")){if(i==null)throw t.createError(r.onlyManagerCreatedCanAcceptEntityShortName);return i.getEntityType(n,!0)}return t.assertPrm(n,"type").isInstanceOf(c.entityType).check(),n}var u=function(n,t,r){this.resource=n;this.entityType=e(t,r);this.manager=r;this.parameters=[];i.queryBase.call(this)},n;return t.inherit(u,i.queryBase),n=u.prototype,n.toString=function(){var n=[];return n.push("resource: ("+this.resource+")"),this.entityType&&n.push("entityType: ("+this.entityType.shortName+")"),this.manager&&n.push("manager: ("+this.manager.toString()+")"),n.push(i.queryBase.prototype.toString.call(this)),n.join(", ")},n.expand=function(n){var t=this.clone(),i=t.getExpression(o.expressions.expandExp);return i?i.combine(n):t.addExpression(new o.expressions.expandExp(n)),t},n.include=function(){return this.expand.apply(this,arguments)},n.setParameter=function(n,i){var r=this.clone(),u=t.findInArray(r.parameters,n,"name");return u?u.value=i:r.parameters.push({name:n,value:i}),r},n.setEntityType=function(n){n=e(n,this.manager);var t=this.clone();return t.entityType=n,t},n.execute=function(n,i,u){if(!this.manager)throw t.createError(r.onlyManagerCreatedCanBeExecuted,{query:this,options:n});return this.manager.executeQuery(this,n,i,u)},n.executeLocally=function(n){if(!this.manager)throw t.createError(r.onlyManagerCreatedCanBeExecuted,{query:this,options:options});return this.manager.executeQueryLocally(this,n)},n.clone=function(){var n=new o.entityQuery(this.resource,this.entityType,this.manager);return this.copy(n),n},n.copy=function(n){i.queryBase.prototype.copy.call(this,n);t.forEach(this.parameters,function(t){n.parameters.push(t)})},u}()}}(),e=function(){return{valueNotifyWrapper:function(){return function(n){this.value=n;t.tryFreeze(this)}}(),trackableArray:function(){function u(n,i){n&&t.forEach(n,function(n){Array.prototype.push.call(i,n)})}function r(n,i){var r=i.property;r&&(f.isInstanceOf(r,c.navigationProperty)?t.forEach(n,function(n){r.checkAssign(n)}):f.isInstanceOf(r,c.dataProperty)?t.forEach(n,function(n,t){n[t]=r.handle(n)}):s.handleUnmappedProperties===!0&&t.forEach(n,function(n,t){n[t]=e.dataTypes.handle(n)}))}var i=function(n,t,i,r){this.object=t;this.property=i;this.after=r;this.changing=new e.event(i+"ArrayChanging",this);this.changed=new e.event(i+"ArrayChanged",this);u(n,this)},n;return t.inherit(i,Array),n=i.prototype,n.pop=function(){var n=[this[this.length-1]],t;return this.changing.notify({added:[],removed:n}),t=Array.prototype.pop.call(this),this.after(this.object,this.property,this,n,null),this.changed.notify({added:[],removed:n}),t},n.push=function(){this.changing.notify({added:arguments,removed:[]});r(arguments,this);var n=Array.prototype.push.apply(this,arguments);return this.after(this.object,this.property,this,null,arguments),this.changed.notify({added:arguments,removed:[]}),n},n.unshift=function(){this.changing.notify({added:arguments,removed:[]});r(arguments,this);var n=Array.prototype.unshift.apply(this,arguments);return this.after(this.object,this.property,this,null,arguments),this.changed.notify({added:arguments,removed:[]}),n},n.shift=function(){var n=[this[0]],t;return this.changing.notify({added:[],removed:n}),t=Array.prototype.shift.call(this),this.after(this.object,this.property,this,n,null),this.changed.notify({added:[],removed:n}),t},n.splice=function(n,t){var i,u,f;return t=t||this.length,i=null,arguments.length>2&&(i=Array.prototype.slice.call(arguments).slice(2)),u=this.slice(n,n+t),this.changing.notify({added:i,removed:u}),i&&r(i,this),f=Array.prototype.splice.apply(this,arguments),this.after(this.object,this.property,this,u,i),this.changed.notify({added:i,removed:u}),f},n.remove=function(){var n=[],i=this;return this.changing.notify({added:[],removed:arguments}),t.forEach(arguments,function(r){var u=t.indexOf(i,r);u>=0&&(Array.prototype.splice.call(i,u,1),n.push(r))}),this.after(this.object,this.property,this,n,null),this.changed.notify({added:[],removed:arguments}),n},n.load=function(n,t,i,r,u){return this.entity.$tracker.loadNavigationProperty(this.propertyName,n,t,i,r,u)},i}(),event:function(){var i=function(n,t){this.name=n;this.subscribers=[];this.publisher=t},n=i.prototype;return n.toString=function(){return this.name},n.subscribe=function(n){t.findInArray(this.subscribers,n)||this.subscribers.push(n)},n.unsubscribe=function(n){t.removeFromArray(this.subscribers,n)},n.notify=function(){var n=arguments;t.forEach(this.subscribers,function(t){t.apply(t,n)})},i}(),dataTypes:function(){function u(n,i){throw t.createError(r.assignError,[n.name,i],{dataType:n,value:i});}var e=function(){var r=function(n){i.dataTypeBase.call(this,"dateBase");this.name=n},n;return t.inherit(r,i.dataTypeBase),n=r.prototype,n.defaultValue=function(){return new Date(-6847812e6)},n.isValid=function(n){return Object.prototype.toString.call(n)==="[object Date]"},n.handle=function(n){if(!this.isValid(n)){var t=n;n=this.tryParse(t);n||u(this,t)}return n},n.autoValue=function(){return new Date},n.getRawValue=function(n){return n==null?null:s.getDateConverter().toISOString(n)},n.tryParse=function(n){return s.getDateConverter().parse(n)},n.toODataValue=function(n){return n=this.handle(n),"datetime'"+s.getDateConverter().toISOString(n)+"'"},n.toBeetleValue=function(n){return n=this.handle(n),'"'+s.getDateConverter().toISOString(n)+'"'},r}(),n={};return n.object=function(){var n=function(){i.dataTypeBase.call(this,"object");t.tryFreeze(this)};return t.inherit(n,i.dataTypeBase),new n}(),n.array=function(){var u=function(){i.dataTypeBase.call(this,"array");t.tryFreeze(this)},n;return t.inherit(u,i.dataTypeBase),n=u.prototype,n.isValid=function(n){return n instanceof Array},n.defaultValue=function(){return[]},n.handle=function(n){return this.isValid(n)||(n=n.split(",")),n},n.autoValue=function(){throw t.createError(r.notImplemented,[this.name,"defaultValue"]);},n.toODataValue=function(n){return n},n.toBeetleValue=function(n){return n},new u}(),n.function=function(){var n=function(){i.dataTypeBase.call(this,"function");t.tryFreeze(this)};return t.inherit(n,i.dataTypeBase),new n}(),n.string=function(){var u=0,r=function(){i.dataTypeBase.call(this,"string");t.tryFreeze(this)},n;return t.inherit(r,i.dataTypeBase),n=r.prototype,n.defaultValue=function(){return""},n.handle=function(n){return this.isValid(n)||(n=n.toString()),n},n.autoValue=function(){return"key_"+--u},n.toODataValue=function(n){return"'"+n.replace(/'/g,"''")+"'"},n.toBeetleValue=function(n){return'"'+n.replace(/"/g,'""')+'"'},new r}(),n.guid=function(){var r=function(){i.dataTypeBase.call(this,"guid");t.tryFreeze(this)},n;return t.inherit(r,i.dataTypeBase),n=r.prototype,n.defaultValue=function(){return"00000000-0000-0000-0000-000000000000"},n.isValid=function(n){return typeof n=="string"&&n.match(/^\{?[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}\}?$/i)},n.handle=function(n){return this.isValid(n)||u(this,n),n},n.autoValue=function(){return t.createGuid()},n.toODataValue=function(n){return"guid'"+n+"'"},n.toBeetleValue=function(n){return'"'+n+'"'},new r}(),n.date=function(){var n=function(){e.call(this,"date");t.tryFreeze(this)};return t.inherit(n,e),new n}(),n.dateTimeOffset=function(){var n=function(){e.call(this,"dateTimeOffset");t.tryFreeze(this)},i;return t.inherit(n,e),i=n.prototype,i.toODataValue=function(n){return n=this.handle(n),"datetimeoffset'"+s.getDateConverter().toISOString(n)+"'"},new n}(),n.time=function(){var r=function(){i.dataTypeBase.call(this,"time");t.tryFreeze(this)},n;return t.inherit(r,i.dataTypeBase),n=r.prototype,n.defaultValue=function(){return"00:00:00"},n.isValid=function(n){return/^([01]?\d|2[0-3])(((:[0-5]?\d){2}(\.\d{1,3}){0,1})|(:[0-5]?\d){0,2})?$/.test(n)},n.handle=function(n){return this.isValid(n)||u(this,n),n},n.autoValue=function(){return"00:00:00"},n.toODataValue=function(n){return"time'"+n+"'"},n.toBeetleValue=function(n){return'"'+n+'"'},new r}(),n.boolean=function(){var r=function(){i.dataTypeBase.call(this,"boolean");t.tryFreeze(this)},f;return t.inherit(r,i.dataTypeBase),f=r.prototype,f.defaultValue=function(){return!1},f.handle=function(t){if(!this.isValid(t)){if(n.String.isValid(t)){var i=t.toLowerCase();if(i=="true"||i=="1")return!0;if(i=="false"||i=="0")return!1}throw u(this,t);}return t},new r}(),n.int=function(){var f=0,r=function(){i.dataTypeBase.call(this,"int");t.tryFreeze(this)},n;return t.inherit(r,i.dataTypeBase),n=r.prototype,n.defaultValue=function(){return 0},n.isValid=function(n){return typeof n=="number"&&n%1==0},n.handle=function(n){return typeof n!="number"&&(n=Number(n)),this.isValid(n)||u(this,n),n},n.autoValue=function(){return--f},new r}(),n.number=function(){var f=0,r=function(){i.dataTypeBase.call(this,"number");t.tryFreeze(this)},n;return t.inherit(r,i.dataTypeBase),n=r.prototype,n.defaultValue=function(){return 0},n.isValid=function(n){return!isNaN(n)&&typeof n=="number"},n.handle=function(n){return typeof n!="number"&&(n=Number(n)),this.isValid(n)||u(this,n),n},n.autoValue=function(){return--f},new r}(),n.byte=function(){var f=0,r=function(){i.dataTypeBase.call(this,"byte");t.tryFreeze(this)},n;return t.inherit(r,i.dataTypeBase),n=r.prototype,n.defaultValue=function(){return 0},n.isValid=function(n){return typeof n=="number"&&n%1==0&&n>=0&&n<256},n.handle=function(n){return typeof n!="number"&&(n=Number(n)),this.isValid(n)||u(this,n),n},n.autoValue=function(){return--f},new r}(),n.binary=function(){var r=function(){i.dataTypeBase.call(this,"binary");t.tryFreeze(this)},n;return t.inherit(r,i.dataTypeBase),n=r.prototype,n.defaultValue=function(){return'"AAAAAAAAAAA="'},n.isValid=function(){return!0},n.handle=function(n){return n},n.toODataValue=function(n){return n=this.handle(n),"X'"+s.getDateConverter().toISOString(n)+"'"},n.toBeetleValue=function(n){return'"'+n+'"'},new r}(),n.enum=function(){function e(n,i){var e,r,u,o;if(f.isArray(n))return e=0,t.forEach(n,function(n){e|=n.value}),e;if(f.isTypeOf(n,"string")){if(r=n.split(", "),r.length==1)return i[n];for(u=0;u<r.length;u++)if(i[r[u]]==null)return null;return n}return f.isTypeOf(n,"number")?(o=n,t.forEach(i.symbols(),function(t){if(t.value==n){o=t;return}}),o):f.isEnum(n,i)?n:null}var u=function(n,r,u){i.dataTypeBase.call(this,"enum");this.enumType=n;this.enumTypeName=r;this.displayName=u||r;t.tryFreeze(this)},n;return t.inherit(u,i.dataTypeBase),n=u.prototype,n.defaultValue=function(){},n.isValid=function(n){return e(n,this.enumType)!=null},n.handle=function(n){var i=e(n,this.enumType);if(i==null)throw t.createError(r.invalidEnumValue,[n,this.enumTypeName],{enumType:this.enumType,value:n});return i},n.getRawValue=function(n){return f.isEnum(n,this.enumType)?n.value:n},n.toODataValue=function(n){return this.getRawValue(n)},n.toBeetleValue=function(n){return this.getRawValue(n)},u}(),n.geometry=function(){var r=function(){i.dataTypeBase.call(this,"geometry");this.isComplex=!0;t.tryFreeze(this)},n;return t.inherit(r,i.dataTypeBase),n=r.prototype,n.defaultValue=function(){return{$type:"System.Data.Spatial.DbGeometry",CoordinateSystemId:null,WellKnownText:"",WellKnownBinary:null}},n.isValid=function(n){return n.$tracker&&n.$tracker.getValue("WellKnownText")},n.handle=function(n){return n.$tracker&&(n.$tracker.entityType.isComplexType=!0),n},new r}(),n.geography=function(){var r=function(){i.dataTypeBase.call(this,"geography");this.isComplex=!0;t.tryFreeze(this)},n;return t.inherit(r,i.dataTypeBase),n=r.prototype,n.defaultValue=function(){return{$type:"System.Data.Spatial.DbGeography",CoordinateSystemId:null,WellKnownText:"",WellKnownBinary:null}},n.isValid=function(n){return n.$tracker&&n.$tracker.getValue("WellKnownText")},n.handle=function(n){return n.$tracker&&(n.$tracker.entityType.isComplexType=!0),n},new r}(),n.byName=function(i){var u=n[i];if(!u)throw t.createError(r.unknownDataType,[i]);return u},n.byValue=function(t){return n.string.isValid(t)?n.guid.isValid(t)?n.guid:n.date.tryParse(t)?n.date:n.string:n.date.isValid(t)?n.date:n.boolean.isValid(t)?n.boolean:n.int.isValid(t)?n.int:n.number.isValid(t)?n.number:n.array.isValid(t)?n.array:n.binary},n.handle=function(t){var i=n.date.tryParse(t);return i!=null?i:t},n.toODataValue=function(t){return t==null?"null":n.byValue(t).toODataValue(t)},n.toBeetleValue=function(t){return t==null?"null":n.byValue(t).toBeetleValue(t)},n}(),validator:function(){function i(i,u,f,e){var o=function(n){return n==null?!1:u.test(n)};return f=t.formatString(f||r.invalidValue,e),new n(i,o,f,{pattern:u})}var n=function(n,i,r,u){this.name=n;this.func=i;this.message=r;this.args=u;t.tryFreeze(this)},u=n.prototype;return u.toString=function(){var n=[],t;if(this.args)for(t in this.args)n.push(t+": "+this.args[t]);return n.length>0?this.name+" ("+n.join(", ")+")":this.name},u.validate=function(n,t){return this.func(n,t)==!0?null:this.message},n.byCode=function(i,u,f,e,o,h){var c=s.getLocalizeFunction();c&&(f=e&&c(e)||f,o=h&&c(h)||o);u=u||[];u.push(f);u.push(o);switch(i){case"re":return n.required.apply(null,u);case"sl":return n.stringLength.apply(null,u);case"ma":return n.maxLength.apply(null,u);case"mi":return n.minLength.apply(null,u);case"ra":return n.range.apply(null,u);case"rx":return n.regularExpression.apply(null,u);case"ea":return n.emailAddress.apply(null,u);case"cc":return n.creditCard.apply(null,u);case"ur":return n.url.apply(null,u);case"ph":return n.phone.apply(null,u);case"po":return n.postalCode.apply(null,u);case"ti":return n.time.apply(null,u);case"co":return n.compare.apply(null,u);default:throw t.createError(r.unknownValidator,[i]);}},n.required=function(i,u,e){var o=function(n){return n==null?!1:f.isTypeOf(n,"string")&&!i&&n==""?!1:!0};return u=t.formatString(u||r.requiredError,e),new n("Required",o,u,{allowEmptyStrings:i})},n.stringLength=function(i,u,e,o){var s=function(n){return!i&&!u?!0:f.isNotEmptyString(n)?i&&n.length<i?!1:u&&n.length>u?!1:!0:!1};return e=t.formatString(e||r.stringLengthError,o,i,u),new n("StringLength",s,e,{min:i,max:u})},n.maxLength=function(i,u,f){var e=function(n){return n==null?!0:i&&n.length>i?!1:!0};return u=t.formatString(u||r.maxLenError,f,i),new n("MaxLength",e,u,{length:i})},n.minLength=function(i,u,f){var e=function(n){return n==null?!1:i&&n.length<i?!1:!0};return u=t.formatString(u||r.minLenError,f,i),new n("MinLength",e,u,{length:i})},n.range=function(i,u,f,e){var o=function(n){return!i&&!u?!0:i&&n<i?!1:u&&n>u?!1:!0};return f=t.formatString(f||r.rangeError,e,i,u),new n("Range",o,f,{min:i,max:u})},n.regularExpression=function(n,t,r){return f.isTypeOf(n,"string")&&(n=new RegExp(n)),i("RegularExpression",n,t,r)},n.emailAddress=function(n,t){return i("EmailAddress",/^\w+@[a-zA-Z_]+?\.[a-zA-Z]{2,3}$/,n,t)},n.creditCard=function(n,t){return i("CreditCard",/^((4\d{3})|(5[1-5]\d{2})|(6011)|(3[68]\d{2})|(30[012345]\d))[ -]?(\d{4})[ -]?(\d{4})[ -]?(\d{4}|3[4,7]\d{13})$/,n,t)},n.url=function(n,t){return i("Url",/(http|ftp|https):\/\/[\w-]+(\.[\w-]+)+([\w.,@?^=%&amp;:\/~+#-]*[\w@?^=%&amp;\/~+#-])?/,n,t)},n.phone=function(n,t){return i("Phone",/^(?!.*-.*-.*-)(?=(?:\d{8,10}$)|(?:(?=.{9,11}$)[^-]*-[^-]*$)|(?:(?=.{10,12}$)[^-]*-[^-]*-[^-]*$)  )[\d-]+$/,n,t)},n.postalCode=function(n,t){return i("PostalCode",/^\d{5}([\-]?\d{4})?$/,n,t)},n.time=function(n,t){return i("Time",/^([01]?\d|2[0-3])(((:[0-5]?\d){2}(\.\d{1,3}){0,1})|(:[0-5]?\d){0,2})?$/,n,t)},n.compare=function(i,u,f){var o=function(n,r){var u=t.getValue(r,i);return n==u},e=s.getLocalizeFunction(),h=e&&e(i)||i;return u=t.formatString(u||r.compareError,f,h),new n("Compare",o,u,{property:i})},n}(),entityContainer:function(){function r(n,t){var i=new u(n);return t.push(i),i}var u=function(){function u(n,t){var i=r(n,t);return i>-1?t[i]:null}function r(n,t){var f=t.length,r,u,i;if(f>0)for(r=0,u=f-1;r<=u;){if(i=Math.floor((r+u)/2),t[i].key<n){r=i+1;continue}if(t[i].key>n){u=i-1;continue}return i}return-1}function f(n,t){for(var i=0;i<t.length&&n>t[i].key;)i++;return i}var i=function(n){this.typeName=n.name;this.keyIndex=[];t.tryFreeze(this)},n=i.prototype;return n.toString=function(){return this.typeName+": "+this.keyIndex.length},n.push=function(n,t){var i=f(n,this.keyIndex);this.keyIndex.splice(i,0,{key:n,entity:t})},n.remove=function(n){var t=r(n,this.keyIndex);this.keyIndex.splice(t,1)},n.getEntity=function(n){var t=u(n,this.keyIndex);return t?t.entity:null},n.getRelations=function(n,t){var f=t.inverse,r,i,u;if(!f)return null;for(r=[],i=0;i<this.keyIndex.length;i++)u=this.keyIndex[i],u.entity.$tracker.foreignKey(f)===n&&r.push(u.entity);return r},n.relocateKey=function(n,t,i){this.remove(t);i&&this.push(i,n)},n.getEntities=function(){var n=[];return t.forEach(this.keyIndex,function(t){n.push(t.entity)}),n},i}(),i=function(){this.entitySets=[];this.allEntities=[];t.tryFreeze(this)},n=i.prototype;return n.toString=function(){return this.allEntities.length},n.push=function(n){var i;this.allEntities.push(n);var u=n.$tracker,t=u.entityType,f=u.key;if(f)while(t)i=this.findEntitySet(t),i||(i=r(t,this.entitySets)),i.push(f,n),t=t.baseType},n.remove=function(n){var r;t.removeFromArray(this.allEntities,n);var u=n.$tracker,i=u.entityType,f=u.key;if(f)while(i)r=this.findEntitySet(i),r&&(r.remove(f),i=i.baseType)},n.getEntities=function(){return this.allEntities},n.getEntityByKey=function(n,t){if(!n)return null;var i=this.findEntitySet(t);return i?i.getEntity(n):null},n.getRelations=function(n,t){var f=t.inverse,u,i,r;return f?(u=t.entityType,i=n.$tracker.key,!i)?null:(r=this.findEntitySet(u),r)?r.getRelations(i,t):null:null},n.relocateKey=function(n,t,i){for(var u=n.$tracker.entityType,f;u;)f=this.findEntitySet(u),f?f.relocateKey(n,t,i):(f=r(u,this.entitySets),f.push(i,n)),u=u.baseType},n.getChanges=function(){return t.filterArray(this.allEntities,function(n){return!(n.$tracker.entityType.isComplexType&&n.$tracker.owners.length>0)&&n.$tracker.isChanged()})},n.count=function(){return this.allEntities.length},n.findEntitySet=function(n){return t.findInArray(this.entitySets,n.name,"typeName")},i}(),entityTracker:function(){function y(n,t,i,r){r.entity=n;n.$tracker=r;r.entityType=t;r.entityState=u.entityStates.Detached;r.observableProvider=i;r.forceUpdate=!1;r.originalValues=[];r.changedValues=[];r.manager=null;r.owners=[];r.validationErrors=[];r.validationErrorsChanged=new e.event("validationErrorsChanged",r);r.entityStateChanged=new e.event("entityStateChanged",r);r.propertyChanged=new e.event("propertyChanged",r);r.arrayChanged=new e.event("arrayChanged",r);t.hasMetadata&&(r.key=l(r))}function w(n,t,i){var r={propertyChange:b,arrayChange:k,dataPropertyChange:d,scalarNavigationPropertyChange:g,pluralNavigationPropertyChange:nt,arraySet:tt};return i.observableProvider.toObservable(n,t,r)}function c(n,t){n.baseType&&c(n.baseType,t);n.initializer&&n.initializer.call(t,t)}function l(n,t,i){var e=n.entityType,o,r,u,f;if(e.keys.length==0)return null;for(o=[],r=0;r<e.keys.length;r++)u=e.keys[r],f=u===t?i:n.getValue(u.name),u.dataType.name=="guid"&&(f=f.toLowerCase()),o.push(f);return o.join(",")}function a(n,i,f,e){var o,s;if(!n)throw t.createError(r.propertyNotFound,[i],{propertyName:i,entity:e.entity,manager:e.manager});if(o=n.entityType.createQuery(f,e.manager),n.isScalar)t.forEach(n.foreignKeys,function(t,i){var r=n.entityType.keys[i],f=e.getValue(t.name);o=o.where(r.name,u.filterOps.Equals,f)});else{if(s=n.inverse,!s)throw t.createError(r.pluralNeedsInverse,{property:n});t.forEach(s.foreignKeys,function(n,t){var i=n.name,r=e.getValue(s.entityType.keys[t]);o=o.where(i,u.filterOps.Equals,r)})}return o}function b(n,t,r,u){var f=n.$tracker,o=r();o!=u&&(s.handleUnmappedProperties==!0&&(u=e.dataTypes.handle(u)),r(u),f.manager&&i(n,t,o,f),f.propertyChanged.notify({entity:n,property:t,oldValue:o,newValue:u}))}function k(n,t,r,u,f){var e=n.$tracker;e.manager&&i(n,null,null,e);e.arrayChanged.notify({entity:n,property:t,items:r,removedItems:u,addedItems:f})}function d(n,u,f,h){var a=f(),c,b,v,w,y,p,k,d;if(a!=h){if(c=n.$tracker,h=u.handle(h),b=null,v=null,u.isKeyPart){if(b=c.key,v=l(c,u,h),c.manager&&(w=c.manager.getEntityByKey(v,c.entityType.floorType),w&&w!==n))throw t.createError(r.sameKeyExists,{key:v,entity:w});c.key=v}if(c.manager?i(n,u.name,u.dataType.getRawValue(a),c):c.entityType.isComplexType&&t.forEach(c.owners,function(n){i(n.entity,n.property.name+"."+u.name,h,n.entity.$tracker)}),f(h),s.liveValidate===!0&&o(u.validate(n),c,u),c.propertyChanged.notify({entity:n,property:u,oldValue:a,newValue:h}),u.isKeyPart&&(c.manager&&c.manager.entities.relocateKey(n,b,v),it(n)),u.isComplex){for(y=a.$tracker.owners,p=y.length-1;p>=0;p--)k=y[p],k.entity==n&&k.property==u&&y.splice(p,1);y.length==0&&a.$tracker.manager&&a.$tracker.manager.detachEntity(a);h.$tracker.owners.push({entity:n,property:u})}c.manager&&(d=s.autoFixScalar,t.forEach(u.relatedNavigationProperties,function(n){var t,i,r;if(n.isScalar===!0)if(t=c.foreignKey(n),t){if(i=c.getValue(n.name),i&&i.$tracker.key===t)return;r=null;c.manager&&d&&(r=c.manager.getEntityByKey(t,n.entityType));r?c.setValue(n.name,r):i&&c.setValue(n.name,new e.valueNotifyWrapper(null))}else c.setValue(n.name,null)}))}}function g(n,u,h,c){var y=n.$tracker,d=!1,l,w,p,b,a,k;if(f.isInstanceOf(c,e.valueNotifyWrapper)&&(d=!0,c=c.value),l=h(),l!=c)if(u.checkAssign(c),h(c),s.liveValidate===!0&&o(u.validate(n),y,u),y.propertyChanged.notify({entity:n,property:u,oldValue:l,newValue:c}),v(c,y.manager),u.isComplex){if(c==null)throw t.createError(r.complexCannotBeNull,[u.displayName],{entity:n,property:u});for(w=l.$tracker.owners,p=w.length-1;p>=0;p--)b=w[p],b.entity==n&&b.property==u&&w.splice(p,1);l.$tracker.owners.length==0&&l.$tracker.manager&&l.$tracker.manager.detachEntity(l);c.$tracker.owners.push({entity:n,property:u});i(n,u.name,c.$tracker.toRaw(),y)}else d||(u.triggerOwnerModify&&u.foreignKeys.length==0&&i(n,null,null,y),t.setForeignKeys(n,u,c)),a=u.inverse,a&&(a.isScalar?(l&&l.$tracker.setValue(a.name,null),c&&c.$tracker.setValue(a.name,n)):(l&&l.$tracker.getValue(a.name).remove(n),c&&(k=c.$tracker.getValue(a.name),t.findInArray(k,n)||k.push(n))))}function nt(n,r,u,f,e){var c=n.$tracker,h;s.liveValidate===!0&&o(r.validate(n),c,r);r.triggerOwnerModify&&i(n,null,null,c);c.arrayChanged.notify({entity:n,property:r,items:u,removedItems:f,addedItems:e});h=r.inverse;h&&(f&&t.forEach(f,function(t){t.$tracker.getValue(h.name)==n&&t.$tracker.setValue(h.name,null)}),e&&t.forEach(e,function(t){v(t,c.manager);t.$tracker.setValue(h.name,n)}))}function tt(n,i,f,e){var l=s.getArraySetBehaviour(),h,o,c;if(l==u.arraySetBehaviour.NotAllowed)throw t.createError(r.settingArrayNotAllowed,{entity:n,property:e});if(h=[],o=t.filterArray(f,function(){return!0}),l==u.arraySetBehaviour.Replace&&t.forEach(i,function(n){t.findInArray(o,n)?t.removeFromArray(o,n):h.push(n)}),l==u.arraySetBehaviour.Append&&t.forEach(f,function(n){t.findInArray(i,n)&&t.removeFromArray(o,n)}),h.length>0)for(c=h.length-1;c>=0;c--)i.splice(t.indexOf(i,h[c]),1);o.length>0&&i.push.apply(i,o)}function it(n){var i=n.$tracker;t.forEach(i.entityType.navigationProperties,function(r){var f,e,u;r.inverse&&(f=r.inverse,r.isScalar?(e=i.getValue(r.name),e&&t.setForeignKeys(e,f,n)):(u=i.getValue(r.name),u&&u.length>0&&t.forEach(u,function(i){t.setForeignKeys(i,f,n)})))})}function v(n,i){if(n&&i&&!n.$tracker.entityType.isComplexType&&!i.isInManager(n)){if(n.$tracker.manager)throw t.createError(r.entityAlreadyBeingTracked,null,{entity:n,manager:i});i.addEntity(n)}}function i(n,r,f,e){var o=e.entityState;o==u.entityStates.Unchanged&&(t.forEach(e.entityType.navigationProperties,function(n){var u=n.inverse,r;u&&u.triggerOwnerModify&&(r=e.getValue(n.name),r&&(n.isScalar?i(r,null,null,r.$tracker):t.forEach(r,function(n){i(n,null,null,n.$tracker)})))}),e.toModified());rt(r,f,e.originalValues,e.changedValues)}function rt(n,i,r,u){var f,e;n!=null&&(i==null||i.$tracker==null||i.$tracker.entityType.isComplexType)&&(f=t.findInArray(r,n,"p"),f||r.push({p:n,v:i}),e=t.findInArray(u,n,"p"),e||u.push({p:n,v:i}))}function o(n,i,r){var u=[],f=r?t.filterArray(i.validationErrors,function(n){return n.property===r}):t.filterArray(i.validationErrors,function(){return!0});t.forEach(f,function(r){t.findInArray(n,r.validator,"validator")?t.removeFromArray(n,r.validator,"validator"):(t.removeFromArray(i.validationErrors,r),u.push(r))});i.validationErrors=i.validationErrors.concat(n);(u.length>0||n.length>0)&&i.validationErrorsChanged.notify({errors:i.validationErrors,added:n,removed:u})}var h=function(n,t,i){delete n.$type;delete n.$id;y(n,t,i||s.getObservableProvider(),this);w(n,t,this);c(t,n)},n=h.prototype;return n.toString=function(){return"EntityTracker: "+this.entityType.shortName+", key: "+this.key},n.setManagerInfo=function(n){if(this.manager)throw t.createError(r.entityAlreadyBeingTracked,{otherManager:this.manager});t.assertPrm(n,"manager").isInstanceOf(e.entityManager).check();this.manager=n},n.isChanged=function(){return this.entityState===u.entityStates.Added||this.entityState===u.entityStates.Deleted||this.entityState===u.entityStates.Modified},n.toAdded=function(){if(this.entityState!=u.entityStates.Added){var n={entity:this.entity,oldState:this.entityState,newState:u.entityStates.Added,newChanged:!this.isChanged()};this.entityState=u.entityStates.Added;this.entityStateChanged.notify(n)}},n.toModified=function(){if(this.entityState!=u.entityStates.Modified){var n={entity:this.entity,oldState:this.entityState,newState:u.entityStates.Modified,newChanged:!this.isChanged()};this.entityState=u.entityStates.Modified;this.entityStateChanged.notify(n)}},n.toDeleted=function(){if(this.entityState!=u.entityStates.Deleted){var n={entity:this.entity,oldState:this.entityState,newState:u.entityStates.Deleted,newChanged:!this.isChanged()};this.entityState=u.entityStates.Deleted;this.entityStateChanged.notify(n)}},n.toUnchanged=function(){if(this.entityState!=u.entityStates.Unchanged){var n={entity:this.entity,oldState:this.entityState,newState:u.entityStates.Unchanged,newUnchanged:this.isChanged()};this.originalValues.length=0;this.changedValues.length=0;this.entityState=u.entityStates.Unchanged;this.entityStateChanged.notify(n)}},n.toDetached=function(){if(this.entityState!=u.entityStates.Detached){var n={entity:this.entity,oldState:this.entityState,newState:u.entityStates.Detached,newUnchanged:this.isChanged()};this.entityState=u.entityStates.Detached;this.entityStateChanged.notify(n)}},n.undoChanges=function(){var n=this;t.forEach(this.changedValues,function(t){n.setValue(t.p,t.v)});this.changedValues.length=0},n.acceptChanges=function(){this.changedValues.length=0},n.getValue=function(n){return this.observableProvider.getValue(this.entity,n)},n.setValue=function(n,t){this.observableProvider.setValue(this.entity,n,t)},n.getOriginalValue=function(n){var i=t.findInArray(this.originalValues,n,"p");return i?i.v:this.getValue(n)},n.foreignKey=function(n){var r=n.entityType,u,t,e,f,o,i;if(r.keys.length==0)return null;for(u=[],t=0;t<r.keys.length;t++){if((e=r.keys[t],f=n.foreignKeys[t],f==null)||(o=f.name,i=this.getValue(o),i==null))return null;e.dataType.name=="guid"&&(i=i.toLowerCase());u.push(i)}return u.join(",")},n.createLoadQuery=function(n,i){var r=t.findInArray(this.entityType.navigationProperties,n,"name");return a(r,n,i,this)},n.loadNavigationProperty=function(n,i,f,e,o,s){var c,h,l;if(this.manager==null)throw t.createError(r.entityNotBeingTracked,{entity:this.entity});return c=t.findInArray(this.entityType.navigationProperties,n,"name"),h=a(c,n,f,this),i&&t.forEach(i,function(n){h=h.expand(n)}),l=this,e=e||{},e.merge==null&&(e.merge=u.mergeStrategy.Preserve),e.autoFixScalar==null&&(e.autoFixScalar=!0),e.autoFixPlural==null&&(e.autoFixPlural=!0),this.manager.executeQuery(h,e,function(){c.inverse||l.manager.fixNavigations(entity);o&&o.apply(null,arguments)},s)},n.validate=function(){return this.entityState==u.entityStates.Deleted?this.validationErrors=[]:o(this.entityType.validate(this.entity),this),this.validationErrors},n.toRaw=function(n){var r=this.entityType,i={},u=this;return r.hasMetadata&&(t.forEach(r.dataProperties,function(t){var r=u.getValue(t.name);r!=null&&r.$tracker?(n==!0||r.$tracker.entityType.isComplexType)&&(i[t.name]=r.$tracker.toRaw(n)):i[t.name]=t.dataType.getRawValue(r)}),n==!0&&t.forEach(r.navigationProperties,function(n){var r=u.getValue(n.name);r==null?i[n.name]=null:f.isArray(r)?t.forEach(r,function(n){n!=null&&n.$tracker?i[p].push(n.$tracker.toRaw(!0)):i[p].push(n)}):i[n.name]=r.$tracker.toRaw(!0)})),t.forEach(r.properties,function(r){var e=u.getValue(r);f.isArray(e)?(i[r]=[],t.forEach(e,function(t){t!=null&&t.$tracker?n==!0&&i[r].push(t.$tracker.toRaw(!0)):i[r].push(t)})):e!=null&&e.$tracker?(n==!0||e.$tracker.entityType.isComplexType)&&(i[r]=e.$tracker.toRaw(n)):i[r]=e}),i},h.toEntity=function(n,t,i){return new e.entityTracker(n,t,i).entity},h}(),entityManager:function(){function w(n,t,i,r,e,o){var c=i&&i.async==!1?null:s.getPromiseProvider(),a=null,v,p;return(c&&(a=c.deferred()),v=i&&i.makeObservable,v==null&&(v=!0),p=null,o.dataService.createEntityAsync(n,t,i,function(n,t){try{var i=!1;f.isArray(n)||(n=[n],i=!0);v&&h(n,t,u.mergeStrategy.ThrowError,u.entityStates.Added,o);i&&(n=n[0]);y(r,c,a,n);c||(p=n)}catch(s){l(e,c,a,n,o)}},function(t){t.typeName=n;l(e,c,a,t,o)}),c)?c.getPromise(a):p}function b(n,t,i,r){var f=u.mergeStrategy.ThrowError,e=i,o=null,s=null;t&&(t.merge!=null&&(f=t.merge),t.state!=null&&(e=t.state),t.autoFixScalar!=null&&(o=t.autoFixScalar),t.autoFixPlural!=null&&(s=t.autoFixPlural));h([n],null,f,e,r,o,s)}function ot(n,u){if(n.length<1||n.length>2)throw t.createError(r.managerInvalidArgs,{entityManager:u});var o=n[0],s=n[1];if(f.isInstanceOf(o,i.dataServiceBase))u.dataService=o;else if(f.isTypeOf(o,"string"))u.dataService=s?new v.webApiService(o,s):new v.webApiService(o,!1);else throw t.createError(r.managerInvalidArgs,{entityManager:this});u.pendingChangeCount=0;u.entities=new e.entityContainer;u.validationErrors=[];u.entityStateChanged=new e.event("entityStateChanged",u);u.validationErrorsChanged=new e.event("validationErrorsChanged",u);u.hasChangesChanged=new e.event("hasChangesChanged",u);u.queryExecuting=new e.event("queryExecuting",u);u.queryExecuted=new e.event("queryExecuted",u);u.saving=new e.event("saving",u);u.saved=new e.event("saved",u)}function h(n,i,e,o,h,c,l){e||(e=u.mergeStrategy.Preserve);o&&o!==u.entityStates.Detached||(o=u.entityStates.Added);c==null&&(c=s.autoFixScalar);l==null&&(l=s.autoFixPlural);i=i||h.flatEntities(f.isArray(n)?n:[n]);var y=[],p=[],v=[],w=h.entities.count(),a=h;t.forEach(i,function(n){var f=n.$tracker;if(!f&&n.$type)f=a.toEntity(n,n.$type).$tracker;else if(f.entityType.isComplexType||h.isInManager(n))return;var o=f.entityType,s=f.key,i=null;if(w>0&&s&&(i=a.entities.getEntityByKey(s,o.floorType)),i){if(o.name!==i.$tracker.entityType.name)throw t.createError(r.sameKeyOnDifferentTypesError,[i.$tracker.entityType.shortName,o.shortName],{existingEntity:i,entity:n,manager:a});if(e===u.mergeStrategy.ThrowError)throw t.createError(r.sameKeyExists,{existingEntity:i,entity:n,manager:a});else e===u.mergeStrategy.Preserve?v.push({o:n,n:i}):(v.push({o:n,n:i}),p.push({o:i,n:n}))}else a.entities.push(n),n.$tracker.setManagerInfo(a),y.push(n)});t.forEach(y,function(n){g(n,c,l,a);at(n,a);d(n,o);s.validateOnMerge===!0&&n.$tracker.validate()});t.forEach(p,function(n){st(n.o,n.n);d(n.o,o)});t.forEach(v,function(i){var r=t.indexOf(n,i.o);r>=0&&(n[r]=i.n);ht(i.o,i.n,c,l,a)})}function k(n,i){if(!i.isInManager(n))throw t.createError(r.entityNotBeingTracked,{entity:n,manager:i});}function d(n,i){if(i===u.entityStates.Unchanged)n.$tracker.toUnchanged();else if(i===u.entityStates.Modified)n.$tracker.toModified();else if(i===u.entityStates.Added)n.$tracker.toAdded();else throw t.createError(r.mergeStateError,[i],{entity:n,state:i});}function st(n,i){var r=i.$tracker;t.forEach(r.entityType.dataProperties,function(t){n.$tracker.setValue(t.name,r.getValue(t.name))})}function g(n,i,r,u){if(i==!0||r==!0){var e=n.$tracker,o=e.entityType;t.forEach(o.navigationProperties,function(t){var f=e.getValue(t.name),o,h,s,c;if(t.isComplex){for(o=f.$tracker.owners,h=!1,s=0;s<o.length;s++)if(c=o[s],c.entity==n&&c.property==t){h=!0;break}h||o.push({entity:n,property:t})}else t.isScalar?nt(e,f,t,t.name,i,u):(tt(f,u),r&&rt(n,t,f,u))});t.forEach(o.dataProperties,function(t){var u,i,f,r,o;if(t.isComplex){for(u=e.getValue(t.name),u.$tracker.entityType.isComplexType=!0,i=u.$tracker.owners,f=!1,r=0;r<i.length;r++)if(o=i[r],o.entity==n&&o.property==t){f=!0;break}f||i.push({entity:n,property:t})}});t.forEach(e.entityType.properties,function(n){var t=e.getValue(n);f.isArray(t)?tt(t,u):nt(e,t,null,n,!1,u)})}}function nt(n,i,r,u,f,e){i?(i.$tracker&&i.$tracker.manager!=e&&(i=e.getEntityByKey(i.$tracker.key,i.$tracker.entityType),n.setValue(u,i)),r&&t.setForeignKeys(n.entity,r,i)):r&&f&&it(n,r,e)}function tt(n,t){for(var r,u,i=n.length-1;i>=0;i--)r=n[i],r&&r.$tracker&&r.$tracker.manager!=t&&(u=t.getEntityByKey(r.$tracker.key,r.$tracker.entityType),u?n.splice(i,1,u):n.splice(i,1))}function ht(n,i,r,f,e){var s=i.$tracker,c,o,h,l;s.entityState!=u.entityStates.Deleted&&(c=n.$tracker,l=c.entityType,t.forEach(l.navigationProperties,function(u){var y,p,l,a,v;u.isComplex||(o=c.getValue(u.name),h=s.getValue(u.name),u.isScalar?h||(r==!0?it(s,u,e):r===!0&&u.inverse&&u.inverse.isScalar||f===!0&&u.inverse&&!u.inverse.isScalar||(y=c.foreignKey(u),p=s.foreignKey(u),y==p&&o!=null&&e.isInManager(o)&&(l=u.inverse,l?l.isScalar?o.$tracker.setValue(l.name,i):(a=o.$tracker.getValue(l.name),v=t.indexOf(a,n),v>=0&&a.splice(v,1,i)):s.setValue(u.name,o)))):f?rt(i,u,h,e):r===!0&&u.inverse||t.forEach(o,function(n){e.isInManager(n)&&!t.findInArray(h,n)&&h.push(n)}))}))}function it(n,t,i){var f=n.foreignKey(t),r=i.entities.getEntityByKey(f,t.entityType);r&&r.$tracker.entityState==u.entityStates.Deleted&&(r=null);n.setValue(t.name,r)}function rt(n,i,r,f){var e=f.entities.getRelations(n,i);e&&t.forEach(e,function(n){n.$tracker.entityState==u.entityStates.Deleted||t.findInArray(r,n)||r.push(n)})}function ut(n,i){var r=n.$tracker,u=r.entityType,f=i?new e.valueNotifyWrapper(null):null;u.hasMetadata&&t.forEach(u.navigationProperties,function(n){n.isScalar?r.setValue(n.name,f):r.getValue(n.name).splice(0)})}function ct(n,i,r){t.forEach(n,function(n){n.$tracker.entityState==u.entityStates.Deleted?(n.$tracker.toDetached(),ft(n,r),i.remove(n)):n.$tracker.toUnchanged()})}function lt(n,i,r){if(i.removed.length>0)for(var u=i.removed.length-1;u>=0;u--)r.validationErrors.splice(t.indexOf(r.validationErrors,i.removed[u]),1);i.added.length>0&&r.validationErrors.push.apply(r.validationErrors,i.added);(i.removed.length>0||i.added.length>0)&&r.validationErrorsChanged.notify({errors:r.validationErrors,added:i.added,removed:i.removed})}function at(n,t){n.$tracker.entityStateChanged.subscribe(function(n){var i=t.pendingChangeCount;n.newChanged===!0?t.pendingChangeCount++:n.newUnchanged===!0&&t.pendingChangeCount--;t.entityStateChanged.notify(n);i==0&&t.pendingChangeCount>0?t.hasChangesChanged.notify({hasChanges:!0}):i>0&&t.pendingChangeCount==0&&t.hasChangesChanged.notify({hasChanges:!1})});n.$tracker.validationErrorsChanged.subscribe(function(i){lt(n,i,t)})}function ft(n,i){n.$tracker.entityStateChanged.unsubscribe(i.entityStateChanged.notify);n.$tracker.validationErrorsChanged.unsubscribe(i.validationErrorsChanged.notify);var r=t.filterArray(i.validationErrors,function(t){return t.entity==n});t.removeFromArray(i.validationErrors,n,"entity");i.validationErrorsChanged.notify({errors:i.validationErrors,removed:r,added:[]})}function vt(n,t,i){var r={manager:n,query:t,options:i};return n.queryExecuting.notify(r),a.queryExecuting.notify(r),r}function et(n,t,i,r){var u={manager:n,query:t,options:i,result:r};return n.queryExecuted.notify(u),a.queryExecuted.notify(u),u.result}function yt(n,t,i){var r={manager:n,changes:t,options:i};return n.saving.notify(r),a.saving.notify(r),r.options}function pt(n,t,i){var r={manager:n,changes:t,options:i};n.saved.notify(r);a.saved.notify(r)}function y(n,t,i,r){n&&n(r);t&&t.resolve(i,r)}function l(n,t,i,r,u){if(n&&n(r),t&&t.reject(i,r),r.manager=u,!n&&!t)throw new r;}var p=function(){ot(arguments,this)},n=p.prototype;return n.toString=function(){return this.dataService.toString()+", "+r.pendingChanges+": "+this.pendingChangeCount+", "+r.validationErrors+": "+this.validationErrors.length},n.getEntityType=function(n){return this.dataService.getEntityType(n)},n.createQuery=function(n,t){return this.dataService.createQuery(n,t,this)},n.createEntityQuery=function(n,t){return this.dataService.createEntityQuery(n,t,this)},n.registerCtor=function(n,t,i){this.dataService.registerCtor(n,t,i)},n.createEntity=function(n,t){var i=this.dataService.createEntity(n,t),r=[i];return h(r,null,u.mergeStrategy.ThrowError,u.entityStates.Added,this),i},n.createDetachedEntity=function(n,t){return this.dataService.createEntity(n,t)},n.createRawEntity=function(n,t){return this.dataService.createRawEntity(n,t)},n.createEntityAsync=function(n,t,i,r,u){return w(n,t,i,r,u,this)},n.createRawEntityAsync=function(n,t,i,r,u){return i?i.makeObservable=!1:i={makeObservable:!1},w(n,t,i,r,u,this)},n.executeQuery=function(n,i,e,o){var k,c,p,d,g,b;n.options&&(i=t.combine(n.options,i));k=vt(this,n,i);n=k.query;i=k.options;c=i&&i.async==!1?null:s.getPromiseProvider();p=null;c&&(p=c.deferred());var v=u.mergeStrategy.Preserve,a=u.executionStrategy.Server,w=null,nt,tt;if(f.isEnum(i,u.mergeStrategy)?(v=i,i={makeObservable:v!=u.mergeStrategy.NoTrackingRaw}):f.isEnum(i,u.executionStrategy)?a=i:i&&(i.merge&&(v=i.merge),i.execution&&(a=i.execution),i.autoFixScalar!=null&&(nt=i.autoFixScalar),i.autoFixPlural!=null&&(tt=i.autoFixPlural),i.makeObservable=v!=u.mergeStrategy.NoTrackingRaw),d=v==u.mergeStrategy.NoTracking||v==u.mergeStrategy.NoTrackingRaw,d&&a==u.executionStrategy.Both)throw t.createError(r.executionBothNotAllowedForNoTracking,{executionStrategy:a,mergeStrategy:v});return((a==u.executionStrategy.Local||a==u.executionStrategy.LocalIfEmptyServer)&&(w=this.executeQueryLocally(n,i&&i.varContext)),g=null,a==u.executionStrategy.Local||a==u.executionStrategy.LocalIfEmptyServer&&w&&(w.length==null||w.length>0)?(w=et(this,n,i,w),y(e,c,p,w)):(b=this,this.dataService.executeQuery(n,i,function(t,r,s){try{var k=!1,w=s.getResponseHeader("X-InlineCount");w!=null&&(w=Number(w));t&&(d||(f.isArray(t)||(t=[t],k=!0),h(t,r,v,u.entityStates.Unchanged,b,nt,tt),k&&(t=t[0])));a==u.executionStrategy.Both&&(t=b.executeQueryLocally(n,i&&i.varContext,!0),t.$inlineCountDiff!=null&&(w!=null&&(w+=t.$inlineCountDiff),delete t.$inlineCountDiff));t&&f.isObject(t)&&(n.inlineCountEnabled&&w!=null&&(t.$inlineCount=w),t.$extra={userData:s.getResponseHeader("X-UserData"),xhr:s});t=et(b,n,i,t);y(e,c,p,t);c||(g=t)}catch(it){l(o,c,p,it,b)}},function(t){t.query=n;l(o,c,p,t,b)})),c)?c.getPromise(p):g},n.executeQueryLocally=function(n,i,f){var v=n.entityType,y,h,s,p,w;if(v)if(h=this.entities.findEntitySet(v),h)y=h.getEntities();else return[];else throw t.createError(r.typeRequiredForLocalQueries);f&&n.getExpression(o.expressions.groupByExp,!1)&&(a.warning.notify({message:r.countDiffCantBeCalculatedForGrouped,query:n,options:options}),f=!1);var e=[],c=[],l=[];return t.forEach(y,function(n){n.$tracker.entityState==u.entityStates.Added?(f&&c.push(n),e.push(n)):n.$tracker.entityState==u.entityStates.Deleted?f&&l.push(n):e.push(n)}),s=n.toFunction(),e=s(e,i),f&&e.$inlineCount&&(p=c.length>0?s(c,i).$inlineCount:0,w=l.length>0?s(l,i).$inlineCount:0,e.$inlineCountDiff=p-w),e},n.getEntityByKey=function(n,t){var i=f.isInstanceOf(t,c.entityType)?t:this.getEntityType(t,!0);return this.entities.getEntityByKey(n,i)},n.deleteEntity=function(n){var i,f,e;for(k(n,this),i=this,f=[],t.forEach(n.$tracker.entityType.navigationProperties,function(u){var e,o;if(u.cascadeDelete){if(u.inverse&&u.inverse.cascadeDelete)throw t.createError(r.twoEndCascadeDeleteNotAllowed,{entity:n,property:u});e=n.$tracker.getValue(u.name);e&&(u.isScalar?u.foreignKeys!=null&&u.foreignKeys.length>0?f.push(e):i.deleteEntity(e):(o=t.filterArray(e,function(){return!0}),t.forEach(o,function(n){i.deleteEntity(n)})))}}),n.$tracker.entityState===u.entityStates.Added?this.detachEntity(n):(ut(n,!0),n.$tracker.toDeleted()),e=0;e<f.length;e++)i.deleteEntity(f[e])},n.addEntity=function(n,t){b(n,t,u.entityStates.Added,this)},n.attachEntity=function(n,t){b(n,t,u.entityStates.Unchanged,this)},n.detachEntity=function(n){if(n.$tracker.entityType.isComplexType&&n.$tracker.owners.length>0)throw t.createError(r.cannotDetachComplexTypeWithOwners);k(n,this);ut(n,!0);ft(n,this);n.$tracker.toDetached();n.$tracker.manager=null;this.entities.remove(n)},n.createSavePackage=function(n,t){var f=t&&t.userData||null,i=t&&t.forceUpdate,r,u;return i==null&&(i=s.forceUpdate),r={userData:f,forceUpdate:i},u=this.exportEntities(n||this.getChanges(),t),r.entities=u,r},n.rejectChanges=function(n,i){var e=this,r;f.isArray(n)||(n=[n]);r=i===!0?this.flatEntities(n):n;t.forEach(r,function(n){var t=n.$tracker;t.entityState==u.entityStates.Added?e.detachEntity(n):t.entityState==u.entityStates.Modified&&(t.undoChanges(),t.toUnchanged())})},n.undoChanges=function(n,i){f.isArray(n)||(n=[n]);var r=i===!0?this.flatEntities(n):n;t.forEach(r,function(n){n.$tracker.undoChanges()})},n.acceptChanges=function(n,i){f.isArray(n)||(n=[n]);var r=i===!0?this.flatEntities(n):n;t.forEach(r,function(n){n.$tracker.acceptChanges()})},n.exportEntities=function(n,i){var e=[],r,f;return n=n||this.entities.getEntities(),r=i&&i.forceUpdate,r==null&&(r=s.forceUpdate),f=i&&i.minimizePackage,f==null&&(f=s.minimizePackage),t.forEach(n,function(n,i){var o=n.$tracker,a=o.entityType,h=o.entityState,c,s,l;if(r===!1&&(r=o.forceUpdate),c={},f===!0)if(h==u.entityStates.Modified)if(o.originalValues.length>0)s={},t.forEach(o.originalValues,function(t){var f,r=t.p.split("."),e,u,i;if(r.length>1){for(e=0;e<r.length-1;e++)u=r[e],n=n.$tracker.getValue(u),s[u]==null&&(s[u]={}),s=s[u];f=r[r.length-1]}else f=t.p;i=o.getValue(f);i&&i.$tracker&&(i=i.$tracker.toRaw());s[f]=i}),t.forEach(o.entityType.dataProperties,function(n){(n.isKeyPart===!0||n.useForConcurrency===!0)&&(s[n.name]=o.getValue(n.name))});else if(r===!0)s=o.toRaw(n);else return;else if(h==u.entityStates.Deleted)s={},t.forEach(o.entityType.dataProperties,function(n){(n.isKeyPart===!0||n.useForConcurrency===!0)&&(s[n.name]=o.getValue(n.name))});else if(h==u.entityStates.Added)s=o.toRaw(n);else return;else s=o.toRaw(n);h==u.entityStates.Modified&&t.forEach(o.originalValues,function(n){var t=n.v;t&&t.$tracker&&(t=t.$tracker.toRaw());c[n.p]=t});l={t:a.name,s:h.toString(),o:c,i:i,f:r};s.$t=l;e.push(s)}),e},n.importEntities=function(n,i){var e=this;f.isArray(n)||(n=[n]);t.forEach(n,function(n){var f=n.$t,s,o,c,l;switch(f.s){case"Unchanged":s=u.entityStates.Unchanged;break;case"Added":s=u.entityStates.Added;break;case"Deleted":s=u.entityStates.Deleted;break;case"Modified":s=u.entityStates.Modified;break;default:throw t.createError(r.unsoppertedState,[f.s],{entity:n});}if(o=e.toEntity(n,f.t),h(o,[o],i||u.mergeStrategy.Preserve,s,e,!0,!0),f.o)for(c in f.o)l=f.o[c],o.$tracker.originalValues.push({p:c,v:l});o.$tracker.forceUpdate=f.forceUpdate;delete o.$t})},n.hasChanges=function(){return this.pendingChangeCount>0},n.getChanges=function(){return this.entities.getChanges()},n.saveChanges=function(n,i,e){var o=n&&n.entities||this.getChanges(),c,a,p,w,v;n=yt(this,o,n);c=n&&n.async==!1?null:s.getPromiseProvider();a=null;c&&(a=c.deferred());var b=n&&n.autoFixScalar,k=n&&n.autoFixPlural,d=null;return(f.isArray(o)||(o=[o]),o&&o.length>0?(p=[],s.validateOnSave===!0&&t.forEach(o,function(n){if(n.$tracker.entityState!=u.entityStates.Deleted){var t=n.$tracker.validate();t&&t.length>0&&p.push({entity:n,validationErrors:t})}}),p.length>0?(w=new t.createError(r.validationFailed,{entities:o,validationErrors:p}),w.entitiesInError=p,l(e,c,a,w,this)):(v=this,this.dataService.saveChanges(this.createSavePackage(o,n),n,function(r){try{r.GeneratedEntities!=null&&r.GeneratedEntities.length>0&&h(r.GeneratedEntities,null,u.mergeStrategy.Preserve,u.entityStates.Unchanged,v,b,k);r.GeneratedValues&&t.forEach(r.GeneratedValues,function(n){var r=o[n.Index],f,t=n.Property.split("."),i,s,e;if(t.length>1){for(i=0;i<t.length-1;i++)r=r.$tracker.getValue(t[i]);f=t[t.length-1]}else f=n.Property;s=r.$tracker;n.Value!=null&&n.Value.$type&&(e=[n.Value],h(e,null,u.mergeStrategy.Preserve,u.entityStates.Unchanged,v,b,k),n.Value=e[0]);s.setValue(f,n.Value)});ct(o,v.entities,v);pt(v,o,n);y(i,c,a,r);c||(d=r)}catch(f){f.changes=o;l(e,c,a,f,v)}},function(n){n.changes=o;l(e,c,a,n,v)}))):y(i,c,a,{AffectedCount:0,GeneratedValues:[]}),c)?c.getPromise(a):d},n.toEntity=function(n,t){return n.$type&&!t&&(t=n.$type),this.dataService.toEntity(n,t)},n.fixNavigations=function(n){if(!this.isInManager(n))throw t.createError(r.entityNotBeingTracked,null,{entity:n});g(n,!0,!0,this)},n.isInManager=function(n){return n.$tracker.manager==this},n.flatEntities=function(n){var r=this,i=arguments[1]||[];return f.isArray(n)||(n=[n]),t.forEach(n,function(n){var u,s,o,e;if(n!=null){if(f.isArray(n)){r.flatEntities(n,i);return}if(!t.findInArray(i,n))if(u=n.$tracker,s=n.$type,u)i.push(n),u.entityType.hasMetadata?(t.forEach(u.entityType.dataProperties,function(n){if(n.isComplex){var t=u.getValue(n.name);t&&(f.isArray(t)?r.flatEntities(t,i):(t.$tracker||t.$type)&&r.flatEntities([t],i))}}),t.forEach(u.entityType.navigationProperties,function(n){var t=u.getValue(n.name);t&&(f.isArray(t)?r.flatEntities(t,i):(t.$tracker||t.$type)&&r.flatEntities([t],i))})):t.forEach(u.entityType.properties,function(n){var t=u.getValue(n);t&&(f.isArray(t)?r.flatEntities(t,i):(t.$tracker||t.$type)&&r.flatEntities([t],i))});else if(s){i.push(n);for(o in n)o!=="$type"&&(e=n[o],e&&(f.isArray(e)?r.flatEntities(e,i):(e.$tracker||e.$type)&&r.flatEntities([e],i)))}}}),i},p}()}}(),v=function(){var n={};return n.mvcService=function(){var r=function(n,t,r){i.dataServiceBase.call(this,n,t,r)},n;return t.inherit(r,i.dataServiceBase),n=r.prototype,n.fetchMetadata=function(n){var t=null,i=this,r=n&&n.async||!1,u=n&&n.timeout||s.ajaxTimeout,f=n&&n.extra;return this.ajaxProvider.doAjax(this.uri+"Metadata","GET",this.dataType,this.contentType,null,r,u,f,function(n){t=i.serializationService.deserialize(n)},function(n){n.service=i;throw new n;}),t},n.createEntityAsync=function(n,t,i,r,u){var f=this,o=i&&i.makeObservable,e;o==null&&(o=!0);e=i&&i.async;e==null&&(e=s.workAsync);var c=i&&i.timeout||s.ajaxTimeout,l=i&&i.extra,h=f.uri+"CreateType?typeName="+n+"&initialValues=";t!=null&&(h+=f.serializationService.serialize(t));this.ajaxProvider.doAjax(h,"GET",this.dataType,this.contentType,null,e,c,l,function(n){n=f.serializationService.deserialize(n);var t=f.fixResults(n,o);r(n,t)},function(n){u(n)})},n.executeQuery=function(n,t,i,r){var u=this.toBeetleQueryParams(n,t&&t.varContext);return this.executeQueryParams(n.resource,u,t,i,r)},n.executeQueryParams=function(n,i,r,u,f){var y=r&&r.makeObservable,p=r&&r.handleUnmappedProperties,w=r&&r.usePost||!1,b=r&&r.dataType||this.dataType,k=r&&r.contentType||this.contentType,o=r&&r.async,c,l,a;o==null&&(o=s.workAsync);var d=r&&r.timeout||s.ajaxTimeout,g=r&&r.extra,h,v=null,e=r&&r.uri||this.uri||"";e&&e[e.length-1]!="/"&&(e+="/");e=e+n;w===!0?(c={},t.forEach(i,function(n){c[n.name]=n.value}),v=this.serializationService.serialize(c),h="POST"):(l=[],t.forEach(i,function(n){l.push(n.name+"="+encodeURIComponent(n.value))}),e+="?"+l.join("&"),h="GET");a=this;this.ajaxProvider.doAjax(e,h,b,k,v,o,d,g,function(n,t){try{n=a.serializationService.deserialize(n)}catch(r){}var i=null;n&&(i=a.fixResults(n,y,p));u(n,i,t)},function(n){f(n)})},n.saveChanges=function(n,t,i,r){var e=this,f=t&&t.async,o;f==null&&(f=s.workAsync);var h=t&&t.timeout||s.ajaxTimeout,c=t&&t.extra,u=t&&t.uri||this.uri||"";u&&u[u.length-1]!="/"&&(u+="/");o=t&&t.saveAction||"SaveChanges";u=u+o;this.ajaxProvider.doAjax(u,"POST",this.dataType,this.contentType,this.serializationService.serialize(n),f,h,c,function(n){try{n=e.serializationService.deserialize(n)}catch(t){}n&&(e.fixResults(n,!1,null),delete n.$id,delete n.$type);i(n)},function(n){r(n)})},n.fixResults=function(n,i,r){function h(n){var l=n.$id,s,t,c;delete n.$id;u[l-1]=n;for(s in n)s!=="$type"&&(t=n[s],t&&(t.$ref?n[s]=u[t.$ref-1]:t.$id?h(t):f.isArray(t)?o.fixResults(t,i,r,u):r!==!1&&(n[s]=e.dataTypes.handle(t))));i!==!1&&(c=n.$type,o.toEntity(n,c))}var o=this,u=arguments[3]||[];return f.isArray(n)||(n=[n]),r==null&&(r=s.handleUnmappedProperties),t.forEach(n,function(t,e){t!=null&&(t.$ref?n[e]=u[t.$ref-1]:t.$id?h(t):f.isArray(t)&&o.fixResults(t,i,r,u))}),u},r}(),n.webApiService=function(){var i=function(n,t,i){v.mvcService.call(this,n,t,i);this.useBeetleQueryStrings=!1},u;return t.inherit(i,n.mvcService),u=i.prototype,u.executeQuery=function(n,t,i,u){var f,e=t&&t.varContext,o;return o=t&&t.useBeetleQueryStrings!=null?t.useBeetleQueryStrings:this.useBeetleQueryStrings,o===!0?f=this.toBeetleQueryParams(n,e):n.isMultiTyped===!0?(f=this.toBeetleQueryParams(n,e),a.warning.notify({message:r.beetleQueryChosenMultiTyped,query:n,options:t})):t&&t.usePost?(f=this.toBeetleQueryParams(n,e),a.warning.notify({message:r.beetleQueryChosenPost,query:n,options:t})):f=this.toODataQueryParams(n,e),this.executeQueryParams(n.resource,f,t,i,u)},i}(),n}(),u=function(){return{observableProviders:new h.enums({Knockout:{code:"ko",instance:l.koObservableProviderInstance},Property:{code:"prop",instance:l.propertyObservableProviderInstance},Backbone:{code:"backbone",instance:l.backboneObservableProviderInstance}}),promiseProviders:new h.enums({Q:{code:"Q",instance:l.qPromiseProviderInstance},jQuery:{code:"jQuery",instance:l.jQueryPromiseProviderInstance}}),entityStates:new h.enums("Detached","Unchanged","Added","Deleted","Modified"),langOperators:function(){var n=function(n,t,i,r,u){this.name=n;this.code=t;this.asFunc=i;this.oData=r;this.js=u||t},i=[];return i.push(new n("Not","!",function(n){return!n()},"not ")),i.push(new n("Negative","-",function(n){return-1*n()})),i.push(new n("And","&&",function(n,t){return n()&&t()},"and")),i.push(new n("Or","||",function(n,t){return n()||t()},"or")),i.push(new n("Equals","==",function(n,i){return t.equals(n(),i(),!1,this)},"eq")),i.push(new n("StrictEquals","==",function(n,i){return t.equals(n(),i(),!0,this)},"eq","===")),i.push(new n("NotEqual","!=",function(n,i){return!t.equals(n(),i(),!1,this)},"ne")),i.push(new n("StrictNotEqual","!=",function(n,i){return!t.equals(n(),i(),!0,this)},"ne","!==")),i.push(new n("Greater",">",function(n,t){return n()>t()},"gt")),i.push(new n("Lesser","<",function(n,t){return n()<t()},"lt")),i.push(new n("GreaterEqual",">=",function(n,t){var i=n(),r=t();return i==r||i>r},"ge")),i.push(new n("LesserEqual","<=",function(n,t){var i=n(),r=t();return i==r||i<r},"le")),i.push(new n("Sum","+",function(n,t){return n()+t()},"add")),i.push(new n("Subtract","-",function(n,t){return n()-t()},"sub")),i.push(new n("Multiply","*",function(n,t){return n()*t()},"mul")),i.push(new n("Divide","/",function(n,t){return n()/t()},"div")),i.push(new n("Modulo","%",function(n,t){return n()%t()},"mod")),i.push(new n("BitAnd","&",function(n,t){return n()&t()})),i.push(new n("BitOr","|",function(n,t){return n()|t()})),i.push(new n("BitShiftLeft","<<",function(n,t){return n()<<t()})),i.push(new n("BitShiftRight",">>",function(n,t){return n()>>t()})),n.find=function(n){var r=t.filterArray(i,function(t){return t.code==n||t.oData==n||t.js==n});return r.length>0?r[0]:null},n}(),filterOps:new h.enums({Equals:{oData:"eq",code:"=="},NotEqual:{oData:"ne",code:"!="},Greater:{oData:"gt",code:">"},Lesser:{oData:"lt",code:"<"},GreaterEqual:{oData:"ge",code:">="},LesserEqual:{oData:"le",code:"<="},Contains:{oData:"substringof",code:"contains",isFunc:!0},StartsWith:{oData:"startswith",code:"startswith",isFunc:!0},EndsWith:{oData:"endswith",code:"endswith",isFunc:!0}}),mergeStrategy:new h.enums("Preserve","Overwrite","ThrowError","NoTracking","NoTrackingRaw"),executionStrategy:new h.enums("Server","Local","Both","LocalIfEmptyServer"),generationPattern:new h.enums("Identity","Computed"),arraySetBehaviour:new h.enums("NotAllowed","Replace","Append")}}(),a=function(){return{queryExecuting:new e.event("beetleQueryExecuting",this),queryExecuted:new e.event("beetleQueryExecuted",this),saving:new e.event("beetleSaving",this),saved:new e.event("beetleSaved",this),info:new e.event("beetleInfo",this),warning:new e.event("beetleWarning",this),error:new e.event("beetleError",this)}}(),s=function(){var s,o;s=n.ko?l.koObservableProviderInstance:n.Backbone?l.backboneObservableProviderInstance:l.propertyObservableProviderInstance;n.Q?o=l.qPromiseProviderInstance:n.jQuery&&(o=l.jQueryPromiseProviderInstance);var h=u.arraySetBehaviour.NotAllowed,c=l.defaultDateConverterInstance,a,e={};return e.autoFixScalar=!0,e.autoFixPlural=!1,e.validateOnMerge=!0,e.validateOnSave=!0,e.liveValidate=!0,e.handleUnmappedProperties=!0,e.isCaseSensitive=!1,e.ignoreWhiteSpaces=!1,e.forceUpdate=!1,e.workAsync=!0,e.ajaxTimeout=null,e.minimizePackage=!1,e.getObservableProvider=function(){return s},e.setObservableProvider=function(n){var h,e,o;if(f.isInstanceOf(n,i.observableProviderBase))s=n;else{if(f.isNotEmptyString(n))for(h=u.observableProviders.symbols(),e=0;e<h.length;e++)if(o=h[e],o.name==n||o.code==n){n=o;break}if(f.isEnum(n,u.observableProviders))s=n.instance;else throw t.createError(r.couldNotLocateNavFixer,{args:arguments});}},e.getPromiseProvider=function(){return o},e.setPromiseProvider=function(n){var h,e,s;if(n==null||f.isInstanceOf(n,i.promiseProviderBase))o=n;else{if(f.isNotEmptyString(n))for(h=u.promiseProviders.symbols(),e=0;e<h.length;e++)if(s=h[e],s.name==n||s.code==n){n=s;break}if(f.isEnum(n,u.promiseProviders))o=n.instance;else throw t.createError(r.couldNotLocatePromiseProvider,{args:arguments});}},e.getArraySetBehaviour=function(){return h},e.setArraySetBehaviour=function(n){t.assertPrm(n,"behaviour").isEnum(u.arraySetBehaviour).check();h=n},e.getDateConverter=function(){return c},e.setDateConverter=function(n){t.assertPrm(n,"converter").isInstanceOf(n,i.dateConverterBase).check();c=n},e.getLocalizeFunction=function(){return a},e.setLocalizeFunction=function(n){t.assertPrm(n,"func").isFunction().check();a=n},e}(),r=function(){return n.beetleI18N==null&&(n.beetleI18N={argCountMismatch:'Argument count mismatch for "%0".',arrayEmpty:"The array does not contain any element.",arrayNotSingle:"The array does not contain exactly one element.",arrayNotSingleOrEmpty:"The array does not contain zero or one element.",assignError:"Cannot set %0 property with %1.",assignErrorNotEntity:"Cannot set %0 property, value is not an entity.",autoGeneratedCannotBeModified:"Auto generated properties cannot be modified.",beetleQueryChosenMultiTyped:"Beetle query string is used because query is multi-typed.",beetleQueryChosenPost:"Beetle query string is used because query method is POST.",beetleQueryNotSupported:"Beetle queries are not supported, you may use only OData query parameters (where, orderBy, select, expand, top, skip).",cannotBeEmptyString:"%0 value can not be empty string.",cannotCheckInstanceOnNull:"Cannot check instance on null value.",cannotDetachComplexTypeWithOwners:"Complex types with owners cannot be detached.",compareError:"%0 property value must be equal with %1.",complexCannotBeNull:"%0 complex property can not be null.",couldNotLocateNavFixer:"Could not locate any observable provider.",couldNotLocatePromiseProvider:"Could not locate any promise provider.",couldNotParseToken:"Could not parse %0.",countDiffCantBeCalculatedForGrouped:'In-line count difference can not be calculated when query contains a "groupBy" expression',dataPropertyAlreadyExists:"Data property already exists: %0.",entityAlreadyBeingTracked:"Entity is already being tracked by another manager.",entityNotBeingTracked:"Entity is not being tracked by a manager.",executionBothNotAllowedForNoTracking:"Execution strategy cannot be Both when merge strategy is NoTracking or NoTrackingRaw.",expressionCouldNotBeFound:"Expression could not be found.",functionNeedsAlias:"%0 function needs alias to work properly. You can set alias like Linq, p => p.Name.",functionNotSupportedForOData:"OData does not support %0 function.",instanceError:"%0 is not an instance of %1.",invalidArguments:"Invalid arguments.",invalidDefaultValue:"%0 is not a valid default value for %0.",invalidEnumValue:"Invalid enum value, %0 cannot be found in %1.",invalidExpression:"%0 can only have %1 type expressions.",invalidPropertyAlias:"Invalid property alias.",invalidStatement:"Invalid statement.",invalidValue:"Invalid value for %0 property.",managerInvalidArgs:"Invalid arguments. Valid args are: {DataService} or {Uri, [MetadataManager]} or {Uri, [metadataString (string)]} or {Uri, [doNotUseMetadata (bool)]}.",maxLenError:"%0 property length cannot exceed %1.",maxPrecisionError:"Value %0 exceeded maximum precision of %1.",mergeStateError:"Cannot merge entities with %0 state.",minLenError:"%0 property length must be greater than %1.",noMetadataEntityQuery:"Cannot create entity query when no metadata is available.",noMetadataRegisterCtor:"Cannot register constructor when no metadata is available.",noOpenGroup:"Could not find any open group.",notFoundInMetadata:"Could not find %0 in metadata.",notImplemented:"%0 %1 is not implemented.",notNullable:"Cannot set %0 with null, property is not nullable.",oDataNotSupportMultiTyped:"Multi-Typed queries cannot be used for OData services.",odataDoesNotSupportAlias:"OData services does not support query alias and primitive typed resources.",onlyManagerCreatedCanBeExecuted:"Only queries which are created from a manager can be directly executed.",onlyManagerCreatedCanAcceptEntityShortName:"Only queries which are created from a manager can accept entity type short name parameter.",pendingChanges:"Pending changes",pluralNeedsInverse:"To load plural relations, navigation property must have inverse.",projectionsMustHaveAlias:"All projected values must have a property name or alias.",propertyNotFound:"Could not find property: %0.",queryClosed:"Query is closed, expression cannot be added. Queries must be executed after some expressions like first, single, any, all etc..",rangeError:"%0 property value must be between %1 and %2.",requiredError:"%0 property is required.",sameKeyExists:"There is already an entity with same key in the manager.",sameKeyOnDifferentTypesError:"Two different types of entities cannot have same keys when they are from same inheritance root (%0, %1).",settingArrayNotAllowed:"Setting array property is not allowed, you may change this via beetle.settings.setArraySetBehaviour(behavior).",stringLengthError:"%0 property length must be between %1 and %2.",twoEndCascadeDeleteNotAllowed:"Two-end cascade deletes are not supported.",typeError:"%0 type is not %1.",typeMismatch:"%0 value type mismatch. expected type: %1, given type: %2, value: %3",typeRequiredForLocalQueries:'To execute queries locally, entity type must be provided (createQuery("Entities", "Entity") or createEntityQuery("Entity")).',unclosedQuote:'Unclosed quote in "%0".',unclosedToken:'Unclosed "%0".',unexpectedProperty:'Unexpected property "%0".',unexpectedToken:"Unexpected %0.",unknownDataType:"Unknown data type: %0.",unknownExpression:"Unknown expression.",unknownFunction:"Unknown function: %0.",unknownParameter:"Unknown parameter: %0.",unknownValidator:"Unknown validator type: %0.",unsoppertedState:"Unsupported entity state: %0.",validationErrors:"Validation errors",validationFailed:"Validation failed.",valueCannotBeNull:"Value cannot be null: %0.",operatorNotSupportedForOData:"Operator is not supported for OData: %0."}),n.beetleI18N}(),y=function(){return{version:"1.0",i18N:r,helper:t,assert:f,libs:h,baseTypes:i,impls:l,metadata:c,querying:o,core:e,services:v,enums:u,events:a,settings:s,MetadataManager:c.metadataManager,entityManager:e.entityManager,EntityManager:e.entityManager,WebApiService:v.webApiService,MvcService:v.mvcService,EntityStates:u.entityStates,FilterOps:u.filterOps,MergeStrategy:u.mergeStrategy}}();return t.tryFreeze(y),n.beetle=y,y})(window);
/*
//# sourceMappingURL=beetle.min.js.map
*/